import{r as g,u as te,k as se,l as ne,j as f,B as ie}from"./index-CaMCbIyF.js";import{w as re,u as ae,a as oe,c as ce,I as le,b as z,i as C,s as ue,d as fe,U as T,e as k,f as de,m as he}from"./Sidebar-CMEvfNQy.js";import{L as G,E as pe,C as me}from"./LoadingSpinner-Cy7tfWfw.js";import"./BaseDialog-CHTt4x64.js";import"./Link-DOsHlPBe.js";import"./formatDistanceToNowStrict-B7etE4jS.js";import"./en-US-DK8Z8mF7.js";const ge=()=>{},Re=ge(),B=Object,X=e=>e===Re,Se=e=>typeof e=="function",L=new WeakMap,U=(e,o)=>B.prototype.toString.call(e)===`[object ${o}]`;let Ee=0;const J=e=>{const o=typeof e,n=U(e,"Date"),R=U(e,"RegExp"),y=U(e,"Object");let t,a;if(B(e)===e&&!n&&!R){if(t=L.get(e),t)return t;if(t=++Ee+"~",L.set(e,t),Array.isArray(e)){for(t="@",a=0;a<e.length;a++)t+=J(e[a])+",";L.set(e,t)}if(y){t="#";const _=B.keys(e).sort();for(;!X(a=_.pop());)X(e[a])||(t+=a+":"+J(e[a])+",");L.set(e,t)}}else t=n?e.toJSON():o=="symbol"?e.toString():o=="string"?JSON.stringify(e):""+e;return t},be=e=>{if(Se(e))try{e=e()}catch{e=""}const o=e;return e=typeof e=="string"?e:(Array.isArray(e)?e.length:e)?J(e):"",[e,o]},ye=e=>be(e?e(0,null):null)[0],q=Promise.resolve(),xe=e=>(o,n,R)=>{const y=g.useRef(!1),{cache:t,initialSize:a=1,revalidateAll:_=!1,persistSize:i=!1,revalidateFirstPage:S=!0,revalidateOnMount:I=!1,parallel:x=!1}=R,[,,,P]=oe.get(ce);let s;try{s=ye(o),s&&(s=le+s)}catch{}const[E,j,V]=z(t,s),w=g.useCallback(()=>C(E()._l)?a:E()._l,[t,s,a]);ue.useSyncExternalStore(g.useCallback(r=>s?V(s,()=>{r()}):()=>{},[t,s]),w,w);const d=g.useCallback(()=>{const r=E()._l;return C(r)?a:r},[s,a]),$=g.useRef(d());fe(()=>{if(!y.current){y.current=!0;return}s&&j({_l:i?$.current:d()})},[s,t]);const M=I&&!y.current,h=e(s,async r=>{const v=E()._i,c=E()._r;j({_r:T});const p=[],W=d(),[N]=z(t,r),b=N().data,F=[];let A=null;for(let l=0;l<W;++l){const[O,D]=k(o(l,x?null:A));if(!O)break;const[Y,Q]=z(t,O);let m=Y().data;const Z=_||v||C(m)||S&&!l&&!C(b)||M||b&&!C(b[l])&&!R.compare(b[l],m);if(n&&(typeof c=="function"?c(m,D):Z)){const K=async()=>{if(!(O in P))m=await n(D);else{const ee=P[O];delete P[O],m=await ee}Q({data:m,_k:D}),p[l]=m};x?F.push(K):await K()}else p[l]=m;x||(A=m)}return x&&await Promise.all(F.map(l=>l())),j({_i:T}),p},R),u=g.useCallback(function(r,v){const c=typeof v=="boolean"?{revalidate:v}:v||{},p=c.revalidate!==!1;return s?(p&&(C(r)?j({_i:!0,_r:c.revalidate}):j({_i:!1,_r:c.revalidate})),arguments.length?h.mutate(r,{...c,revalidate:p}):h.mutate()):q},[s,t]),H=g.useCallback(r=>{if(!s)return q;const[,v]=z(t,s);let c;if(de(r)?c=r(d()):typeof r=="number"&&(c=r),typeof c!="number")return q;v({_l:c}),$.current=c;const p=[],[W]=z(t,s);let N=null;for(let b=0;b<c;++b){const[F]=k(o(b,N)),[A]=z(t,F),l=F?A().data:T;if(C(l))return u(W().data);p.push(l),N=l}return u(p)},[s,t,u,d]);return{size:d(),setSize:H,mutate:u,get data(){return h.data},get error(){return h.error},get isValidating(){return h.isValidating},get isLoading(){return h.isLoading}}},je=re(ae,xe);function ve(e){return(o,n)=>n&&!n.after?null:o===0?`${e}${e.includes("?")?"&":"?"}limit=25`:`${e}${e.includes("?")?"&":"?"}after=${n==null?void 0:n.after}&limit=25`}function Oe(){var $,M,h;const e=te(),{mode:o,val:n}=e,{isIntersecting:R,ref:y}=se({threshold:.9}),t=g.useRef(!1),a=($=ne.get(o))==null?void 0:$.url,_=`https://www.reddit.com/${n.startsWith("/")?n.slice(1):n}${a??""}`,{data:i,size:S,setSize:I,error:x,isValidating:P,isLoading:s}=je(ve(_),async u=>(await he(u)).data),E=i==null?void 0:i.flatMap(u=>u.children).map(u=>u.data),j=s||S>0&&(i==null?void 0:i[S-1])===void 0,w=(((M=i==null?void 0:i[0])==null?void 0:M.children.length)??0)===0||(((h=i==null?void 0:i.at(-1))==null?void 0:h.children.length)??0)<25,d=P&&i&&i.length===S;return g.useEffect(()=>{R&&!t.current&&!s&&!d&&!w&&(t.current=!0,setTimeout(()=>{I(S+1).then(()=>{t.current=!1}).catch(u=>{console.error(u)})},400))},[R,I,S,w,d,s]),f.jsx("div",{children:s?f.jsx("div",{className:"flex justify-center",children:f.jsx(G,{})}):x?f.jsx(pe,{error:x}):E?f.jsxs(f.Fragment,{children:[f.jsx(me,{posts:E}),f.jsx("div",{ref:y,style:{height:400},className:"flex justify-center mt-10",children:j?f.jsx(G,{}):w?"End of feed!":f.jsxs("div",{children:["Scroll all the way down or"," ",f.jsx(ie,{onClick:()=>{I(S+1).then(()=>{t.current=!1})},children:"Click here"})," ","to load more"]})})]}):null})}export{Oe as default};
//# sourceMappingURL=RedditPostFeed-DlHGPxrG.js.map
