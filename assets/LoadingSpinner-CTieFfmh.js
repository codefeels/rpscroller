const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./AddToFeedDialog-fGO9UhlC.js","./index-cTNH9UGo.js","./index-DlnRQRWh.css","./BaseDialog-Zrczv-7L.js","./RedGifsCard-CU7JL6vi.js","./GalleryCard-BTx9kYYb.js","./Sidebar-BHi5t4IJ.js","./Link-EbHxVfYO.js","./formatDistanceToNowStrict-B7etE4jS.js","./en-US-DK8Z8mF7.js"])))=>i.map(i=>d[i]);
import{G as J,j as r,u as j,l as k,r as h,L as B,o as f,p as D,_ as w,M as Q,q as X,B as Y,s as Z}from"./index-cTNH9UGo.js";import{g as G}from"./Sidebar-BHi5t4IJ.js";import{a as $}from"./BaseDialog-Zrczv-7L.js";import{L as v}from"./Link-EbHxVfYO.js";import{f as q}from"./formatDistanceToNowStrict-B7etE4jS.js";function ee(e){return J({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M4 14h4v7a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-7h4a1.001 1.001 0 0 0 .781-1.625l-8-10c-.381-.475-1.181-.475-1.562 0l-8 10A1.001 1.001 0 0 0 4 14z"},child:[]}]})(e)}function te({error:e}){return r.jsxs("div",{className:"text-red-600 m-20",children:[r.jsx("div",{children:`${e}`}),r.jsxs("div",{children:[`${e}`=="TypeError: NetworkError when attempting to fetch resource."?"If you are on firefox then you can disable 'Enhanced Tracking Protection' (at your own risk) to fix this error":""," "]})]})}const I=(e,t)=>t.some(n=>e instanceof n);let L,M;function ne(){return L||(L=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function re(){return M||(M=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const C=new WeakMap,F=new WeakMap,b=new WeakMap;function se(e){const t=new Promise((n,o)=>{const s=()=>{e.removeEventListener("success",l),e.removeEventListener("error",d)},l=()=>{n(x(e.result)),s()},d=()=>{o(e.error),s()};e.addEventListener("success",l),e.addEventListener("error",d)});return b.set(t,e),t}function ie(e){if(C.has(e))return;const t=new Promise((n,o)=>{const s=()=>{e.removeEventListener("complete",l),e.removeEventListener("error",d),e.removeEventListener("abort",d)},l=()=>{n(),s()},d=()=>{o(e.error||new DOMException("AbortError","AbortError")),s()};e.addEventListener("complete",l),e.addEventListener("error",d),e.addEventListener("abort",d)});C.set(e,t)}let _={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return C.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return x(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function V(e){_=e(_)}function oe(e){return re().includes(e)?function(...t){return e.apply(E(this),t),x(this.request)}:function(...t){return x(e.apply(E(this),t))}}function de(e){return typeof e=="function"?oe(e):(e instanceof IDBTransaction&&ie(e),I(e,ne())?new Proxy(e,_):e)}function x(e){if(e instanceof IDBRequest)return se(e);if(F.has(e))return F.get(e);const t=de(e);return t!==e&&(F.set(e,t),b.set(t,e)),t}const E=e=>b.get(e);function ae(e,t,{blocked:n,upgrade:o,blocking:s,terminated:l}={}){const d=indexedDB.open(e,t),u=x(d);return o&&d.addEventListener("upgradeneeded",i=>{o(x(d.result),i.oldVersion,i.newVersion,x(d.transaction),i)}),n&&d.addEventListener("blocked",i=>n(i.oldVersion,i.newVersion,i)),u.then(i=>{l&&i.addEventListener("close",()=>l()),s&&i.addEventListener("versionchange",c=>s(c.oldVersion,c.newVersion,c))}).catch(()=>{}),u}const le=["get","getKey","getAll","getAllKeys","count"],ce=["put","add","delete","clear"],P=new Map;function R(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(P.get(t))return P.get(t);const n=t.replace(/FromIndex$/,""),o=t!==n,s=ce.includes(n);if(!(n in(o?IDBIndex:IDBObjectStore).prototype)||!(s||le.includes(n)))return;const l=async function(d,...u){const i=this.transaction(d,s?"readwrite":"readonly");let c=i.store;return o&&(c=c.index(u.shift())),(await Promise.all([c[n](...u),s&&i.done]))[0]};return P.set(t,l),l}V(e=>({...e,get:(t,n,o)=>R(t,n)||e.get(t,n,o),has:(t,n)=>!!R(t,n)||e.has(t,n)}));const ue=["continue","continuePrimaryKey","advance"],W={},T=new WeakMap,z=new WeakMap,fe={get(e,t){if(!ue.includes(t))return e[t];let n=W[t];return n||(n=W[t]=function(...o){T.set(this,z.get(this)[t](...o))}),n}};async function*he(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;t=t;const n=new Proxy(t,fe);for(z.set(n,t),b.set(n,E(t));t;)yield n,t=await(T.get(n)||t.continue()),T.delete(n)}function A(e,t){return t===Symbol.asyncIterator&&I(e,[IDBIndex,IDBObjectStore,IDBCursor])||t==="iterate"&&I(e,[IDBIndex,IDBObjectStore])}V(e=>({...e,get(t,n,o){return A(t,n)?he:e.get(t,n,o)},has(t,n){return A(t,n)||e.has(t,n)}}));const K=ae("test",2,{upgrade(e){e.createObjectStore("savedPosts")}}),me=h.lazy(()=>w(()=>import("./AddToFeedDialog-fGO9UhlC.js"),__vite__mapDeps([0,1,2,3]),import.meta.url));async function xe(e){await(await K).put("savedPosts",e,e.id)}async function ge(e){await(await K).delete("savedPosts",e.id)}function je({post:e}){var O;const t=j(),{author:n,subreddit:o,subreddit_name_prefixed:s,crosspost_parent_list:l}=e,{val:d}=t,u=((O=l==null?void 0:l[0])==null?void 0:O.subreddit_name_prefixed)??"",i=s,c=k(s,t.favorites),m=k(s,t.favorites),[y,a]=h.useState(!1),[S,p]=h.useState(),[U,N]=h.useState(!1),H=`/u/${n}`;return r.jsxs("div",{children:[S?r.jsx(te,{error:S}):null,u?r.jsxs(r.Fragment,{children:[r.jsx(B,{to:u,children:r.jsxs(f,{children:["Browse ",u]})}),c?null:r.jsxs(f,{onClick:()=>{t.addFavorite(u)},children:[r.jsx(D,{className:"inline"})," ",u]})]}):null,i===H?null:r.jsxs(r.Fragment,{children:[r.jsx(B,{to:i,children:r.jsxs(f,{children:["Browse ",i]})}),m?null:r.jsxs(f,{onClick:()=>{t.addFavorite(i)},children:[r.jsx(D,{className:"inline"})," ",i]})]}),d==="savedposts"?r.jsxs(f,{onClick:()=>{(async()=>{try{p(void 0),await ge(e),t.forceRerender()}catch(g){p(g),console.error(g)}})()},children:[r.jsx(G,{className:"inline"})," Remove from saved"]}):r.jsxs(f,{onClick:()=>{(async()=>{try{p(void 0),await xe(e)}catch(g){p(g),console.error(g)}})(),a(!0),setTimeout(()=>{a(!1)},400)},children:[r.jsx(G,{className:"inline"})," ",y?"Saved!":"Save post"]}),r.jsxs(f,{onClick:()=>{N(!0)},children:[r.jsx($,{className:"inline"})," Add ",s," to feed"]}),U?r.jsx(h.Suspense,{fallback:null,children:r.jsx(me,{subreddit:o,onClose:()=>{N(!1)}})}):null]})}const ye=h.lazy(()=>w(()=>import("./AddToFeedDialog-fGO9UhlC.js"),__vite__mapDeps([0,1,2,3]),import.meta.url));function pe({post:e}){const t=j(),{author:n}=e,{favorites:o,blocked:s}=t,[l,d]=h.useState(!1),u=k(`/user/${n}`,o),i=`/u/${n}`;return r.jsxs("div",{children:[r.jsx(B,{to:`/user/${n}`,children:r.jsxs(f,{children:["Browse ",`/u/${n}`]})}),u?null:r.jsxs(f,{onClick:()=>{t.addFavorite(`/user/${n}`)},children:[r.jsx(D,{className:"inline"})," ",i]}),u||s.includes(n)?null:r.jsxs(f,{onClick:()=>{t.setBlocked(n)},children:[r.jsx(Q,{className:"inline"})," Block ",i]}),r.jsxs(f,{onClick:()=>{d(!0)},children:[r.jsx($,{className:"inline"})," Add ",i," to feed"]}),l?r.jsx(h.Suspense,{fallback:null,children:r.jsx(ye,{subreddit:`u_${n}`,onClose:()=>{d(!1)}})}):null]})}function ve({post:e}){const{subreddit_name_prefixed:t,author:n}=e,o=`u/${n}`;return r.jsxs("div",{children:[r.jsx(pe,{post:e}),o===t?null:r.jsx(je,{post:e})]})}function we({post:e}){const{hideButtons:t}=j(),{author:n,subreddit_name_prefixed:o,title:s,permalink:l,url:d}=e;return r.jsxs("div",{children:[r.jsxs("h4",{className:"inline",children:[X(s)," (",q(new Date(e.created*1e3),{addSuffix:!0}),") [",e.score," ",r.jsx(ee,{className:"inline"}),"]"]})," ","(",r.jsx(v,{href:`https://reddit.com/u/${n}`,target:"_blank",rel:"noreferrer",children:"user"}),") (",r.jsx(v,{href:d,target:"_blank",rel:"noreferrer",children:"url"}),") (",r.jsx(v,{href:`https://reddit.com/${o}`,target:"_blank",rel:"noreferrer",children:"subreddit"}),") (",r.jsx(v,{href:`https://reddit.com${l}`,target:"_blank",rel:"noreferrer",children:"comments"}),")",t?null:r.jsx(ve,{post:e})]})}function be({title:e,url:t}){const[n,o]=h.useState(!1);return r.jsx("img",{alt:e,loading:"lazy",onClick:()=>{o(!n)},className:n?"m-auto":"w-full max-h-[80vh] object-contain",src:t})}const Fe=h.lazy(()=>w(()=>import("./RedGifsCard-CU7JL6vi.js"),__vite__mapDeps([4,1,2]),import.meta.url)),Pe=h.lazy(()=>w(()=>import("./GalleryCard-BTx9kYYb.js"),__vite__mapDeps([5,1,2,6,3,7,8,9]),import.meta.url));function ke(e){return!e.includes("redgifs")&&(e.endsWith(".jpg")||e.endsWith(".jpeg")||e.endsWith(".webp")||e.endsWith(".png")||e.endsWith(".gif")||e.endsWith(".webp"))}function Be({post:e}){const{title:t,url:n}=e;return r.jsxs("div",{children:[r.jsx(we,{post:e}),n.startsWith("https://www.reddit.com/gallery")?r.jsx(Pe,{post:e}):n.includes("redgifs")?r.jsx(Fe,{post:e}):ke(n)?r.jsx(be,{title:t,url:n}):r.jsxs("div",{children:["We do not know how to embed this post type yet!"," ",r.jsxs("a",{href:n,children:[n," ",t]})]})]})}function De({totalFiltered:e}){const t=j(),{redGifsOnly:n}=t;return r.jsxs(r.Fragment,{children:[r.jsx("h1",{children:"Check your filters in the settings or this may just have been a page of comments if you are browsing a user page"}),n?r.jsxs("div",{children:["Note: RedGifs only is on.",r.jsx(Y,{onClick:()=>{t.setRedGifsOnly(!n)},children:"Turn off RedGifs only"})]}):null,r.jsx("div",{children:e?r.jsxs("div",{children:["Total posts filtered out (non-image posts, not matching filters, etc): ",e]}):null}),r.jsx("div",{children:"Note that we are not able to embed v.redd.it videos from e.g. popular SFW reddits"})]})}function Ie(e,t){let n=e;const s={totalPosts:e.length,commentTypeFiltered:0,urlTypeFiltered:0,gifFiltered:0,redGifsOnlyFiltered:0,noRedGifsFiltered:0,pinnedFiltered:0,blockedFiltered:0,remainingPosts:0},l=n.filter(a=>!("comment_type"in a));s.commentTypeFiltered=n.length-l.length,n=l;const d=n.filter(({url:a})=>a.includes("redgifs")||a.endsWith(".jpg")||a.endsWith(".webp")||a.endsWith(".jpeg")||a.endsWith(".png")||a.endsWith(".gif")||a.endsWith(".webp")||a.startsWith("https://www.reddit.com/gallery"));s.urlTypeFiltered=n.length-d.length,n=d;const u=n.filter(a=>t.noGifs?!a.url.endsWith(".gif"):!0);s.gifFiltered=n.length-u.length,n=u;const i=n.filter(a=>t.redGifsOnly?a.url.includes("redgifs"):!0);s.redGifsOnlyFiltered=n.length-i.length,n=i;const c=n.filter(a=>t.noRedGifs?!a.url.includes("redgifs"):!0);s.noRedGifsFiltered=n.length-c.length,n=c;const m=n.filter(a=>t.skipPinned?!a.pinned:!0);s.pinnedFiltered=n.length-m.length,n=m;const y=n.filter(a=>!t.blocked.includes(a.author));return s.blockedFiltered=n.length-y.length,n=y,t.dedupe&&(n=Z(n,a=>a.url)),s.remainingPosts=n.length,{filteredPosts:n,stats:s}}function Ne({posts:e}){const{noGifs:t,blocked:n,skipPinned:o,dedupe:s,fullscreen:l,noRedGifs:d,redGifsOnly:u}=j(),{filteredPosts:i,stats:c}=Ie(e,{noGifs:t,blocked:n,skipPinned:o,dedupe:s,noRedGifs:d,redGifsOnly:u});return r.jsx("div",{className:"flex justify-center overflow-hidden",children:r.jsx("div",{className:l?"lg:w-11/12":"lg:w-1/2",children:r.jsx("div",{className:"flex flex-col space-y-20",children:i.length>0?i.map(m=>r.jsx(Be,{post:m},m.id)):r.jsx(De,{totalPosts:c.totalPosts,commentTypeFiltered:c.commentTypeFiltered,urlTypeFiltered:c.urlTypeFiltered,gifFiltered:c.gifFiltered,redGifsOnlyFiltered:c.redGifsOnlyFiltered,noRedGifsFiltered:c.noRedGifsFiltered,pinnedFiltered:c.pinnedFiltered,blockedFiltered:c.blockedFiltered,remainingPosts:c.remainingPosts,totalFiltered:c.totalPosts-c.remainingPosts})})})})}function Oe(){return r.jsx("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",style:{width:100,height:100},viewBox:"0 0 24 24",children:r.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})})}export{Ne as C,te as E,be as I,Oe as L,K as d};
//# sourceMappingURL=LoadingSpinner-CTieFfmh.js.map
