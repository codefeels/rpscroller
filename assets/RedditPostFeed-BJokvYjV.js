import{r as S,l as se,u as K,c as ne,m as re,j as g,B as ie,a as le,o as ae}from"./index-Bbcb9Gcc.js";import{w as oe,u as ce,a as de,c as fe,I as ue,b as _,i as C,s as he,d as pe,U as L,e as V,f as ge,m as me}from"./Sidebar-CJqzpluS.js";import{C as ye,L as X,E as Fe}from"./LoadingSpinner-D1SAlHz3.js";import"./BaseDialog-BuJ6DJ0j.js";import"./Link-BEn99Lo_.js";import"./formatDistanceToNowStrict-BGM-HUpS.js";import"./en-US-A-7Ux56e.js";const Re=()=>{},Pe=Re(),B=Object,H=e=>e===Pe,be=e=>typeof e=="function",M=new WeakMap,k=(e,r)=>B.prototype.toString.call(e)===`[object ${r}]`;let Se=0;const q=e=>{const r=typeof e,t=k(e,"Date"),f=k(e,"RegExp"),l=k(e,"Object");let s,a;if(B(e)===e&&!t&&!f){if(s=M.get(e),s)return s;if(s=++Se+"~",M.set(e,s),Array.isArray(e)){for(s="@",a=0;a<e.length;a++)s+=q(e[a])+",";M.set(e,s)}if(l){s="#";const m=B.keys(e).sort();for(;!H(a=m.pop());)H(e[a])||(s+=a+":"+q(e[a])+",");M.set(e,s)}}else s=t?e.toJSON():r=="symbol"?e.toString():r=="string"?JSON.stringify(e):""+e;return s},ve=e=>{if(be(e))try{e=e()}catch{e=""}const r=e;return e=typeof e=="string"?e:(Array.isArray(e)?e.length:e)?q(e):"",[e,r]},je=e=>ve(e?e(0,null):null)[0],U=Promise.resolve(),Ee=e=>(r,t,f)=>{const l=S.useRef(!1),{cache:s,initialSize:a=1,revalidateAll:m=!1,persistSize:v=!1,revalidateFirstPage:F=!0,revalidateOnMount:j=!1,parallel:u=!1}=f,[,,,n]=de.get(fe);let i;try{i=je(r),i&&(i=ue+i)}catch{}const[h,E,N]=_(s,i),T=S.useCallback(()=>C(h()._l)?a:h()._l,[s,i,a]);he.useSyncExternalStore(S.useCallback(o=>i?N(i,()=>{o()}):()=>{},[s,i]),T,T);const y=S.useCallback(()=>{const o=h()._l;return C(o)?a:o},[i,a]),O=S.useRef(y());pe(()=>{if(!l.current){l.current=!0;return}i&&E({_l:v?O.current:y()})},[i,s]);const D=j&&!l.current,R=e(i,async o=>{const x=h()._i,c=h()._r;E({_r:L});const P=[],z=y(),[I]=_(s,o),w=I().data,W=[];let $=null;for(let d=0;d<z;++d){const[G,A]=V(r(d,u?null:$));if(!G)break;const[Q,Z]=_(s,G);let b=Q().data;const ee=m||x||C(b)||F&&!d&&!C(w)||D||w&&!C(w[d])&&!f.compare(w[d],b);if(t&&(typeof c=="function"?c(b,A):ee)){const J=async()=>{if(!(G in n))b=await t(A);else{const te=n[G];delete n[G],b=await te}Z({data:b,_k:A}),P[d]=b};u?W.push(J):await J()}else P[d]=b;u||($=b)}return u&&await Promise.all(W.map(d=>d())),E({_i:L}),P},f),p=S.useCallback(function(o,x){const c=typeof x=="boolean"?{revalidate:x}:x||{},P=c.revalidate!==!1;return i?(P&&(C(o)?E({_i:!0,_r:c.revalidate}):E({_i:!1,_r:c.revalidate})),arguments.length?R.mutate(o,{...c,revalidate:P}):R.mutate()):U},[i,s]),Y=S.useCallback(o=>{if(!i)return U;const[,x]=_(s,i);let c;if(ge(o)?c=o(y()):typeof o=="number"&&(c=o),typeof c!="number")return U;x({_l:c}),O.current=c;const P=[],[z]=_(s,i);let I=null;for(let w=0;w<c;++w){const[W]=V(r(w,I)),[$]=_(s,W),d=W?$().data:L;if(C(d))return p(z().data);P.push(d),I=d}return p(P)},[i,s,p,y]);return{size:y(),setSize:Y,mutate:p,get data(){return R.data},get error(){return R.error},get isValidating(){return R.isValidating},get isLoading(){return R.isLoading}}},we=oe(ce,Ee);function xe(e,r){let t=e;const l={totalPosts:e.length,commentTypeFiltered:0,urlTypeFiltered:0,gifFiltered:0,redGifsOnlyFiltered:0,noRedGifsFiltered:0,pinnedFiltered:0,blockedFiltered:0,remainingPosts:0},s=t.filter(n=>!("comment_type"in n));l.commentTypeFiltered=t.length-s.length,t=s;const a=t.filter(({url:n})=>n.includes("redgifs")||n.endsWith(".jpg")||n.endsWith(".webp")||n.endsWith(".jpeg")||n.endsWith(".png")||n.endsWith(".gif")||n.endsWith(".webp")||n.startsWith("https://www.reddit.com/gallery"));l.urlTypeFiltered=t.length-a.length,t=a;const m=t.filter(n=>r.noGifs?!n.url.endsWith(".gif"):!0);l.gifFiltered=t.length-m.length,t=m;const v=t.filter(n=>r.redGifsOnly?n.url.includes("redgifs"):!0);l.redGifsOnlyFiltered=t.length-v.length,t=v;const F=t.filter(n=>r.noRedGifs?!n.url.includes("redgifs"):!0);l.noRedGifsFiltered=t.length-F.length,t=F;const j=t.filter(n=>r.skipPinned?!n.pinned:!0);l.pinnedFiltered=t.length-j.length,t=j;const u=t.filter(n=>!r.blocked.includes(n.author));return l.blockedFiltered=t.length-u.length,t=u,r.dedupe&&(t=se(t,n=>n.url)),l.remainingPosts=t.length,{filteredPosts:t,stats:l}}function Ce({data:e,setSize:r,size:t,isValidating:f,isLoading:l}){const{noGifs:s,blocked:a,skipPinned:m,dedupe:v,noRedGifs:F,redGifsOnly:j}=K(),u=ne(),{isIntersecting:n,ref:i}=re({threshold:u?.5:.8}),h=S.useRef(!1),E=e.flatMap(p=>p.children).map(p=>p.data),N=l||t>0&&e[t-1]===void 0,y=(e[0]?.children.length??0)===0||(e.at(-1)?.children.length??0)<25,O=f&&e.length===t;S.useEffect(()=>{n&&!h.current&&!l&&!O&&!y&&(h.current=!0,setTimeout(()=>{r(t+1).then(()=>{h.current=!1}).catch(p=>{console.error(p)})},400))},[n,r,t,y,O,l]);const{filteredPosts:D,stats:R}=xe(E,{noGifs:s,blocked:a,skipPinned:m,dedupe:v,noRedGifs:F,redGifsOnly:j});return g.jsxs("div",{children:[g.jsx(ye,{posts:D,stats:R}),g.jsx("div",{ref:i,style:{height:400},className:"flex justify-center mt-10",children:N?g.jsx(X,{}):y?"End of feed!":g.jsxs("div",{children:["(Loaded ",E.length," posts ",R.commentTypeFiltered," of those were comments) ... Scroll all the way down or"," ",g.jsx(ie,{onClick:()=>{!h.current&&!O&&(h.current=!0,setTimeout(()=>{r(t+1).then(()=>{h.current=!1}).catch(p=>{console.error(p)})},400))},children:"Click here"})," ","to load more"]})})]})}function Oe(e){return(r,t)=>t&&!t.after?null:r===0?`${e}${e.includes("?")?"&":"?"}limit=25`:`${e}${e.includes("?")?"&":"?"}after=${t?.after}&limit=25`}function De(){const e=K(),{defaultPage:r,mode:t}=e,f=le(r),l=ae.get(t)?.url,s=`https://www.reddit.com/${f.startsWith("/")?f.slice(1):f}${l??""}`,{data:a,size:m,setSize:v,error:F,isValidating:j,isLoading:u}=we(Oe(s),async n=>(await me(n)).data);return g.jsx("div",{children:u?g.jsx("div",{className:"flex justify-center",children:g.jsx(X,{})}):F?g.jsx(Fe,{error:F}):a?g.jsx(Ce,{data:a,setSize:v,size:m,isValidating:j,isLoading:u}):null})}export{De as default};
//# sourceMappingURL=RedditPostFeed-BJokvYjV.js.map
