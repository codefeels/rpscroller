import{r as d,u as te,k as se,l as ne,j as f,B as ie}from"./index-CuTVbqaZ.js";import{w as re,u as ae,a as oe,c as ce,I as le,b as _,i as C,s as ue,d as fe,U,e as K,f as de}from"./Sidebar-Ds4ydn1i.js";import{L as G,E as he,C as pe}from"./LoadingSpinner-1GQTKJMm.js";import"./BaseDialog-DQlc5Ewm.js";import"./Link-B2qykyNn.js";import"./formatDistanceToNowStrict-B7etE4jS.js";import"./en-US-DK8Z8mF7.js";const me=()=>{},ge=me(),B=Object,X=e=>e===ge,Ee=e=>typeof e=="function",T=new WeakMap,V=(e,c)=>B.prototype.toString.call(e)===`[object ${c}]`;let Se=0;const H=e=>{const c=typeof e,i=V(e,"Date"),S=V(e,"RegExp"),v=V(e,"Object");let t,o;if(B(e)===e&&!i&&!S){if(t=T.get(e),t)return t;if(t=++Se+"~",T.set(e,t),Array.isArray(e)){for(t="@",o=0;o<e.length;o++)t+=H(e[o])+",";T.set(e,t)}if(v){t="#";const $=B.keys(e).sort();for(;!X(o=$.pop());)X(e[o])||(t+=o+":"+H(e[o])+",");T.set(e,t)}}else t=i?e.toJSON():c=="symbol"?e.toString():c=="string"?JSON.stringify(e):""+e;return t},Re=e=>{if(Ee(e))try{e=e()}catch{e=""}const c=e;return e=typeof e=="string"?e:(Array.isArray(e)?e.length:e)?H(e):"",[e,c]},we=e=>Re(e?e(0,null):null)[0],q=Promise.resolve(),be=e=>(c,i,S)=>{const v=d.useRef(!1),{cache:t,initialSize:o=1,revalidateAll:$=!1,persistSize:r=!1,revalidateFirstPage:R=!0,revalidateOnMount:P=!1,parallel:x=!1}=S,[,,,I]=oe.get(ce);let s;try{s=we(c),s&&(s=le+s)}catch{}const[w,y,J]=_(t,s),z=d.useCallback(()=>C(w()._l)?o:w()._l,[t,s,o]);ue.useSyncExternalStore(d.useCallback(n=>s?J(s,()=>{n()}):()=>{},[t,s]),z,z);const h=d.useCallback(()=>{const n=w()._l;return C(n)?o:n},[s,o]),O=d.useRef(h());fe(()=>{if(!v.current){v.current=!0;return}s&&y({_l:r?O.current:h()})},[s,t]);const M=P&&!v.current,p=e(s,async n=>{const j=w()._i,l=w()._r;y({_r:U});const g=[],W=h(),[N]=_(t,n),b=N().data,F=[];let A=null;for(let u=0;u<W;++u){const[L,D]=K(c(u,x?null:A));if(!L)break;const[Y,Q]=_(t,L);let E=Y().data;const Z=$||j||C(E)||R&&!u&&!C(b)||M||b&&!C(b[u])&&!S.compare(b[u],E);if(i&&(typeof l=="function"?l(E,D):Z)){const k=async()=>{if(!(L in I))E=await i(D);else{const ee=I[L];delete I[L],E=await ee}Q({data:E,_k:D}),g[u]=E};x?F.push(k):await k()}else g[u]=E;x||(A=E)}return x&&await Promise.all(F.map(u=>u())),y({_i:U}),g},S),a=d.useCallback(function(n,j){const l=typeof j=="boolean"?{revalidate:j}:j||{},g=l.revalidate!==!1;return s?(g&&(C(n)?y({_i:!0,_r:l.revalidate}):y({_i:!1,_r:l.revalidate})),arguments.length?p.mutate(n,{...l,revalidate:g}):p.mutate()):q},[s,t]),m=d.useCallback(n=>{if(!s)return q;const[,j]=_(t,s);let l;if(de(n)?l=n(h()):typeof n=="number"&&(l=n),typeof l!="number")return q;j({_l:l}),O.current=l;const g=[],[W]=_(t,s);let N=null;for(let b=0;b<l;++b){const[F]=K(c(b,N)),[A]=_(t,F),u=F?A().data:U;if(C(u))return a(W().data);g.push(u),N=u}return a(g)},[s,t,a,h]);return{size:h(),setSize:m,mutate:a,get data(){return p.data},get error(){return p.error},get isValidating(){return p.isValidating},get isLoading(){return p.isLoading}}},ve=re(ae,be),xe=e=>(c,i)=>i&&!i.after?null:c===0?`${e}${e.includes("?")?"&":"?"}limit=25`:`${e}${e.includes("?")?"&":"?"}after=${i==null?void 0:i.after}&limit=25`;function Oe(){var O,M,p;const e=te(),{mode:c,val:i}=e,{isIntersecting:S,ref:v}=se({threshold:.9});d.useEffect(()=>{function a(m){m.state&&e.setVal(m.state.val)}return window.addEventListener("popstate",a),()=>{window.removeEventListener("popstate",a)}},[e]);const t=d.useRef(!1),o=(O=ne.get(c))==null?void 0:O.url,$=`https://www.reddit.com/${i.startsWith("/")?i.slice(1):i}${o??""}`,{data:r,size:R,setSize:P,error:x,isValidating:I,isLoading:s}=ve(xe($),async a=>{const m=await fetch(a);if(!m.ok)throw new Error(`HTTP ${m.status} fetching ${a} ${await m.text()}`);return(await m.json()).data}),w=r==null?void 0:r.flatMap(a=>a.children).map(a=>a.data),y=s||R>0&&(r==null?void 0:r[R-1])===void 0,z=(((M=r==null?void 0:r[0])==null?void 0:M.children.length)??0)===0||(((p=r==null?void 0:r.at(-1))==null?void 0:p.children.length)??0)<25,h=I&&r&&r.length===R;return d.useEffect(()=>{S&&!t.current&&!s&&!h&&!z&&(t.current=!0,setTimeout(()=>{P(R+1).then(()=>{t.current=!1}).catch(a=>{console.error(a)})},400))},[S,P,R,z,h,s]),f.jsx("div",{children:s?f.jsx("div",{className:"flex justify-center",children:f.jsx(G,{})}):x?f.jsx(he,{error:x}):w?f.jsxs(f.Fragment,{children:[f.jsx(pe,{posts:w}),f.jsx("div",{ref:v,style:{height:400},className:"flex justify-center mt-10",children:y?f.jsx(G,{}):z?"End of feed!":f.jsxs("div",{children:["Scroll all the way down or"," ",f.jsx(ie,{onClick:()=>{P(R+1).then(()=>{t.current=!1})},children:"Click here"})," ","to load more"]})})]}):null})}export{Oe as default};
//# sourceMappingURL=RedditPostFeed-Wojrep4t.js.map
