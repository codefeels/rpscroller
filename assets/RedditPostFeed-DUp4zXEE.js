import{r as S,l as se,u as K,c as ne,m as re,j as m,B as ie,a as ae,o as le}from"./index-C1s5DeBg.js";import{w as oe,u as ce,a as de,c as fe,I as ue,b as I,i as C,s as he,d as pe,U as L,e as V,f as ge,m as me}from"./Sidebar-BA6op2f1.js";import{C as ye,L as X,E as Fe}from"./LoadingSpinner-RF7yDYtJ.js";import"./BaseDialog-Cd5yuH4g.js";import"./Link-vvH2DA8r.js";import"./formatDistanceToNowStrict-BGM-HUpS.js";import"./en-US-A-7Ux56e.js";const Re=()=>{},ve=Re(),B=Object,H=e=>e===ve,Pe=e=>typeof e=="function",T=new WeakMap,be=e=>B.prototype.toString.call(e),k=(e,r)=>e===`[object ${r}]`;let Se=0;const q=e=>{const r=typeof e,t=be(e),u=k(t,"Date"),a=k(t,"RegExp"),l=k(t,"Object");let n,o;if(B(e)===e&&!u&&!a){if(n=T.get(e),n)return n;if(n=++Se+"~",T.set(e,n),Array.isArray(e)){for(n="@",o=0;o<e.length;o++)n+=q(e[o])+",";T.set(e,n)}if(l){n="#";const y=B.keys(e).sort();for(;!H(o=y.pop());)H(e[o])||(n+=o+":"+q(e[o])+",");T.set(e,n)}}else n=u?e.toJSON():r=="symbol"?e.toString():r=="string"?JSON.stringify(e):""+e;return n},je=e=>{if(Pe(e))try{e=e()}catch{e=""}const r=e;return e=typeof e=="string"?e:(Array.isArray(e)?e.length:e)?q(e):"",[e,r]},Ee=e=>je(e?e(0,null):null)[0],U=Promise.resolve(),we=e=>(r,t,u)=>{const a=S.useRef(!1),{cache:l,initialSize:n=1,revalidateAll:o=!1,persistSize:y=!1,revalidateFirstPage:R=!0,revalidateOnMount:j=!1,parallel:h=!1}=u,[,,,s]=de.get(fe);let i;try{i=Ee(r),i&&(i=ue+i)}catch{}const[p,E,$]=I(l,i),M=S.useCallback(()=>C(p()._l)?n:p()._l,[l,i,n]);he.useSyncExternalStore(S.useCallback(c=>i?$(i,()=>{c()}):()=>{},[l,i]),M,M);const F=S.useCallback(()=>{const c=p()._l;return C(c)?n:c},[i,n]),O=S.useRef(F());pe(()=>{if(!a.current){a.current=!0;return}i&&E({_l:y?O.current:F()})},[i,l]);const D=j&&!a.current,v=e(i,async c=>{const x=p()._i,d=p()._r;E({_r:L});const P=[],z=F(),[G]=I(l,c),w=G().data,_=[];let N=null;for(let f=0;f<z;++f){const[W,A]=V(r(f,h?null:N));if(!W)break;const[Q,Z]=I(l,W);let b=Q().data;const ee=o||x||C(b)||R&&!f&&!C(w)||D||w&&!C(w[f])&&!u.compare(w[f],b);if(t&&(typeof d=="function"?d(b,A):ee)){const J=async()=>{if(!(W in s))b=await t(A);else{const te=s[W];delete s[W],b=await te}Z({data:b,_k:A}),P[f]=b};h?_.push(J):await J()}else P[f]=b;h||(N=b)}return h&&await Promise.all(_.map(f=>f())),E({_i:L}),P},u),g=S.useCallback(function(c,x){const d=typeof x=="boolean"?{revalidate:x}:x||{},P=d.revalidate!==!1;return i?(P&&(C(c)?E({_i:!0,_r:d.revalidate}):E({_i:!1,_r:d.revalidate})),arguments.length?v.mutate(c,{...d,revalidate:P}):v.mutate()):U},[i,l]),Y=S.useCallback(c=>{if(!i)return U;const[,x]=I(l,i);let d;if(ge(c)?d=c(F()):typeof c=="number"&&(d=c),typeof d!="number")return U;x({_l:d}),O.current=d;const P=[],[z]=I(l,i);let G=null;for(let w=0;w<d;++w){const[_]=V(r(w,G)),[N]=I(l,_),f=_?N().data:L;if(C(f))return g(z().data);P.push(f),G=f}return g(P)},[i,l,g,F]);return{size:F(),setSize:Y,mutate:g,get data(){return v.data},get error(){return v.error},get isValidating(){return v.isValidating},get isLoading(){return v.isLoading}}},xe=oe(ce,we);function Ce(e,r){let t=e;const a={totalPosts:e.length,commentTypeFiltered:0,urlTypeFiltered:0,gifFiltered:0,redGifsOnlyFiltered:0,noRedGifsFiltered:0,pinnedFiltered:0,blockedFiltered:0,remainingPosts:0},l=t.filter(s=>!("comment_type"in s));a.commentTypeFiltered=t.length-l.length,t=l;const n=t.filter(({url:s})=>s.includes("redgifs")||s.endsWith(".jpg")||s.endsWith(".webp")||s.endsWith(".jpeg")||s.endsWith(".png")||s.endsWith(".gif")||s.endsWith(".webp")||s.startsWith("https://www.reddit.com/gallery"));a.urlTypeFiltered=t.length-n.length,t=n;const o=t.filter(s=>r.noGifs?!s.url.endsWith(".gif"):!0);a.gifFiltered=t.length-o.length,t=o;const y=t.filter(s=>r.redGifsOnly?s.url.includes("redgifs"):!0);a.redGifsOnlyFiltered=t.length-y.length,t=y;const R=t.filter(s=>r.noRedGifs?!s.url.includes("redgifs"):!0);a.noRedGifsFiltered=t.length-R.length,t=R;const j=t.filter(s=>r.skipPinned?!s.pinned:!0);a.pinnedFiltered=t.length-j.length,t=j;const h=t.filter(s=>!r.blocked.includes(s.author));return a.blockedFiltered=t.length-h.length,t=h,r.dedupe&&(t=se(t,s=>s.url)),a.remainingPosts=t.length,{filteredPosts:t,stats:a}}function Oe({data:e,setSize:r,size:t,isValidating:u,isLoading:a}){const{noGifs:l,blocked:n,skipPinned:o,dedupe:y,noRedGifs:R,redGifsOnly:j}=K(),h=ne(),{isIntersecting:s,ref:i}=re({threshold:h?.5:.8}),p=S.useRef(!1),E=e.flatMap(g=>g.children).map(g=>g.data),$=a||t>0&&e[t-1]===void 0,F=(e[0]?.children.length??0)===0||(e.at(-1)?.children.length??0)<25,O=u&&e.length===t;S.useEffect(()=>{s&&!p.current&&!a&&!O&&!F&&(p.current=!0,setTimeout(()=>{r(t+1).then(()=>{p.current=!1}).catch(g=>{console.error(g)})},400))},[s,r,t,F,O,a]);const{filteredPosts:D,stats:v}=Ce(E,{noGifs:l,blocked:n,skipPinned:o,dedupe:y,noRedGifs:R,redGifsOnly:j});return m.jsxs("div",{children:[m.jsx(ye,{posts:D,stats:v}),m.jsx("div",{ref:i,style:{height:400},className:"flex justify-center mt-10",children:$?m.jsx(X,{}):F?"End of feed!":m.jsxs("div",{children:["(Loaded ",E.length," posts ",v.commentTypeFiltered," of those were comments) ... Scroll all the way down or"," ",m.jsx(ie,{onClick:()=>{!p.current&&!O&&(p.current=!0,setTimeout(()=>{r(t+1).then(()=>{p.current=!1}).catch(g=>{console.error(g)})},400))},children:"Click here"})," ","to load more"]})})]})}function Ie(e){return(r,t)=>t&&!t.after?null:r===0?`${e}${e.includes("?")?"&":"?"}limit=25`:`${e}${e.includes("?")?"&":"?"}after=${t?.after}&limit=25`}function ze(){const e=K(),{defaultPage:r,mode:t}=e,u=ae(r),a=le.get(t)?.url,l=`https://www.reddit.com/${u.startsWith("/")?u.slice(1):u}${a??""}`,{data:n,size:o,setSize:y,error:R,isValidating:j,isLoading:h}=xe(Ie(l),async s=>(await me(s)).data,{revalidateOnFocus:!1,revalidateOnReconnect:!1,revalidateIfStale:!1,dedupingInterval:6e4,focusThrottleInterval:5e3});return m.jsx("div",{children:h?m.jsx("div",{className:"flex justify-center",children:m.jsx(X,{})}):R?m.jsx(Fe,{error:R}):n?m.jsx(Oe,{data:n,setSize:y,size:o,isValidating:j,isLoading:h}):null})}export{ze as default};
//# sourceMappingURL=RedditPostFeed-DUp4zXEE.js.map
