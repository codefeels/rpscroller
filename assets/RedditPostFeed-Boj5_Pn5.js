import{r as j,k as se,u as X,d as ne,l as ie,j as h,B as re,m as le}from"./index-CePIQKfj.js";import{w as oe,u as ae,a as ce,c as de,I as fe,b as _,i as C,s as ue,d as he,U as D,e as H,f as pe,m as me}from"./Sidebar-YrqOXZqj.js";import{C as ge,L as Y,E as ye}from"./LoadingSpinner-DOCaJD4s.js";import"./BaseDialog-8vpOqQ0n.js";import"./Link-Be-H5cDg.js";import"./formatDistanceToNowStrict-B7etE4jS.js";import"./en-US-DK8Z8mF7.js";const Fe=()=>{},Re=Fe(),q=Object,K=e=>e===Re,be=e=>typeof e=="function",N=new WeakMap,U=(e,i)=>q.prototype.toString.call(e)===`[object ${i}]`;let Se=0;const J=e=>{const i=typeof e,t=U(e,"Date"),p=U(e,"RegExp"),o=U(e,"Object");let s,a;if(q(e)===e&&!t&&!p){if(s=N.get(e),s)return s;if(s=++Se+"~",N.set(e,s),Array.isArray(e)){for(s="@",a=0;a<e.length;a++)s+=J(e[a])+",";N.set(e,s)}if(o){s="#";const m=q.keys(e).sort();for(;!K(a=m.pop());)K(e[a])||(s+=a+":"+J(e[a])+",");N.set(e,s)}}else s=t?e.toJSON():i=="symbol"?e.toString():i=="string"?JSON.stringify(e):""+e;return s},je=e=>{if(be(e))try{e=e()}catch{e=""}const i=e;return e=typeof e=="string"?e:(Array.isArray(e)?e.length:e)?J(e):"",[e,i]},Ee=e=>je(e?e(0,null):null)[0],B=Promise.resolve(),Pe=e=>(i,t,p)=>{const o=j.useRef(!1),{cache:s,initialSize:a=1,revalidateAll:m=!1,persistSize:y=!1,revalidateFirstPage:E=!0,revalidateOnMount:F=!1,parallel:f=!1}=p,[,,,n]=ce.get(de);let l;try{l=Ee(i),l&&(l=fe+l)}catch{}const[u,P,T]=_(s,l),z=j.useCallback(()=>C(u()._l)?a:u()._l,[s,l,a]);ue.useSyncExternalStore(j.useCallback(r=>l?T(l,()=>{r()}):()=>{},[s,l]),z,z);const g=j.useCallback(()=>{const r=u()._l;return C(r)?a:r},[l,a]),O=j.useRef(g());he(()=>{if(!o.current){o.current=!0;return}l&&P({_l:y?O.current:g()})},[l,s]);const A=F&&!o.current,R=e(l,async r=>{const v=u()._i,c=u()._r;P({_r:D});const b=[],L=g(),[$]=_(s,r),w=$().data,W=[];let M=null;for(let d=0;d<L;++d){const[G,k]=H(i(d,f?null:M));if(!G)break;const[Q,Z]=_(s,G);let S=Q().data;const ee=m||v||C(S)||E&&!d&&!C(w)||A||w&&!C(w[d])&&!p.compare(w[d],S);if(t&&(typeof c=="function"?c(S,k):ee)){const V=async()=>{if(!(G in n))S=await t(k);else{const te=n[G];delete n[G],S=await te}Z({data:S,_k:k}),b[d]=S};f?W.push(V):await V()}else b[d]=S;f||(M=S)}return f&&await Promise.all(W.map(d=>d())),P({_i:D}),b},p),x=j.useCallback(function(r,v){const c=typeof v=="boolean"?{revalidate:v}:v||{},b=c.revalidate!==!1;return l?(b&&(C(r)?P({_i:!0,_r:c.revalidate}):P({_i:!1,_r:c.revalidate})),arguments.length?R.mutate(r,{...c,revalidate:b}):R.mutate()):B},[l,s]),I=j.useCallback(r=>{if(!l)return B;const[,v]=_(s,l);let c;if(pe(r)?c=r(g()):typeof r=="number"&&(c=r),typeof c!="number")return B;v({_l:c}),O.current=c;const b=[],[L]=_(s,l);let $=null;for(let w=0;w<c;++w){const[W]=H(i(w,$)),[M]=_(s,W),d=W?M().data:D;if(C(d))return x(L().data);b.push(d),$=d}return x(b)},[l,s,x,g]);return{size:g(),setSize:I,mutate:x,get data(){return R.data},get error(){return R.error},get isValidating(){return R.isValidating},get isLoading(){return R.isLoading}}},we=oe(ae,Pe);function xe(e,i){let t=e;const o={totalPosts:e.length,commentTypeFiltered:0,urlTypeFiltered:0,gifFiltered:0,redGifsOnlyFiltered:0,noRedGifsFiltered:0,pinnedFiltered:0,blockedFiltered:0,remainingPosts:0},s=t.filter(n=>!("comment_type"in n));o.commentTypeFiltered=t.length-s.length,t=s;const a=t.filter(({url:n})=>n.includes("redgifs")||n.endsWith(".jpg")||n.endsWith(".webp")||n.endsWith(".jpeg")||n.endsWith(".png")||n.endsWith(".gif")||n.endsWith(".webp")||n.startsWith("https://www.reddit.com/gallery"));o.urlTypeFiltered=t.length-a.length,t=a;const m=t.filter(n=>i.noGifs?!n.url.endsWith(".gif"):!0);o.gifFiltered=t.length-m.length,t=m;const y=t.filter(n=>i.redGifsOnly?n.url.includes("redgifs"):!0);o.redGifsOnlyFiltered=t.length-y.length,t=y;const E=t.filter(n=>i.noRedGifs?!n.url.includes("redgifs"):!0);o.noRedGifsFiltered=t.length-E.length,t=E;const F=t.filter(n=>i.skipPinned?!n.pinned:!0);o.pinnedFiltered=t.length-F.length,t=F;const f=t.filter(n=>!i.blocked.includes(n.author));return o.blockedFiltered=t.length-f.length,t=f,i.dedupe&&(t=se(t,n=>n.url)),o.remainingPosts=t.length,{filteredPosts:t,stats:o}}function ve({data:e,setSize:i,size:t,isValidating:p,isLoading:o}){var x,I;const{noGifs:s,blocked:a,skipPinned:m,dedupe:y,noRedGifs:E,redGifsOnly:F}=X(),f=ne(),{isIntersecting:n,ref:l}=ie({threshold:f?.5:.8}),u=j.useRef(!1),P=e.flatMap(r=>r.children).map(r=>r.data),T=o||t>0&&e[t-1]===void 0,g=(((x=e[0])==null?void 0:x.children.length)??0)===0||(((I=e.at(-1))==null?void 0:I.children.length)??0)<25,O=p&&e.length===t;j.useEffect(()=>{n&&!u.current&&!o&&!O&&!g&&(u.current=!0,setTimeout(()=>{i(t+1).then(()=>{u.current=!1}).catch(r=>{console.error(r)})},400))},[n,i,t,g,O,o]);const{filteredPosts:A,stats:R}=xe(P,{noGifs:s,blocked:a,skipPinned:m,dedupe:y,noRedGifs:E,redGifsOnly:F});return h.jsxs("div",{children:[h.jsx(ge,{posts:A,stats:R}),h.jsx("div",{ref:l,style:{height:400},className:"flex justify-center mt-10",children:T?h.jsx(Y,{}):g?"End of feed!":h.jsxs("div",{children:["(Loaded ",P.length," posts ",R.commentTypeFiltered," of those were comments) ... Scroll all the way down or"," ",h.jsx(re,{onClick:()=>{!u.current&&!O&&(u.current=!0,setTimeout(()=>{i(t+1).then(()=>{u.current=!1}).catch(r=>{console.error(r)})},400))},children:"Click here"})," ","to load more"]})})]})}function Ce(e){return(i,t)=>t&&!t.after?null:i===0?`${e}${e.includes("?")?"&":"?"}limit=25`:`${e}${e.includes("?")?"&":"?"}after=${t==null?void 0:t.after}&limit=25`}function Te(){var f;const e=X(),{mode:i,val:t}=e,p=(f=le.get(i))==null?void 0:f.url,o=`https://www.reddit.com/${t.startsWith("/")?t.slice(1):t}${p??""}`,{data:s,size:a,setSize:m,error:y,isValidating:E,isLoading:F}=we(Ce(o),async n=>(await me(n)).data);return h.jsx("div",{children:F?h.jsx("div",{className:"flex justify-center",children:h.jsx(Y,{})}):y?h.jsx(ye,{error:y}):s?h.jsx(ve,{data:s,setSize:m,size:a,isValidating:E,isLoading:F}):null})}export{Te as default};
//# sourceMappingURL=RedditPostFeed-Boj5_Pn5.js.map
