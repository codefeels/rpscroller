const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./AddToFeedDialog-B1Hg4k0E.js","./index-C7KzZpav.js","./index-BCk88LzG.css","./RedGifsCard-BuLEMZa4.js","./GalleryCard-CwN9EtSw.js","./Link-vn-viLm4.js","./formatDistanceToNowStrict-DGPDrA_T.js","./en-US-Ckk-QizZ.js"])))=>i.map(i=>d[i]);
import{j as s,r as u,u as g,h as b,B as l,M as D,F as L,b as O,_ as w,c as H,G as J,d as Q,e as X}from"./index-C7KzZpav.js";import{L as j}from"./Link-vn-viLm4.js";import{f as Y}from"./formatDistanceToNowStrict-DGPDrA_T.js";function _e(){return s.jsx("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",style:{width:100,height:100},viewBox:"0 0 24 24",children:s.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})})}function Z({error:e}){return s.jsxs("div",{className:"text-red-600 m-20",children:[s.jsx("div",{children:`${e}`}),s.jsxs("div",{children:[`${e}`=="TypeError: NetworkError when attempting to fetch resource."?"If you are on firefox then you can disable 'Enhanced Tracking Protection' (at your own risk) to fix this error":""," "]})]})}function q({title:e,url:t}){const[n,i]=u.useState(!1);return s.jsx("img",{alt:e,loading:"lazy",onClick:()=>{i(!n)},className:n?"m-auto":"w-full max-h-[80vh] object-contain",src:t})}const I=(e,t)=>t.some(n=>e instanceof n);let N,T;function ee(){return N||(N=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function te(){return T||(T=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const B=new WeakMap,y=new WeakMap,v=new WeakMap;function ne(e){const t=new Promise((n,i)=>{const a=()=>{e.removeEventListener("success",c),e.removeEventListener("error",o)},c=()=>{n(f(e.result)),a()},o=()=>{i(e.error),a()};e.addEventListener("success",c),e.addEventListener("error",o)});return v.set(t,e),t}function se(e){if(B.has(e))return;const t=new Promise((n,i)=>{const a=()=>{e.removeEventListener("complete",c),e.removeEventListener("error",o),e.removeEventListener("abort",o)},c=()=>{n(),a()},o=()=>{i(e.error||new DOMException("AbortError","AbortError")),a()};e.addEventListener("complete",c),e.addEventListener("error",o),e.addEventListener("abort",o)});B.set(e,t)}let C={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return B.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return f(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function V(e){C=e(C)}function re(e){return te().includes(e)?function(...t){return e.apply(k(this),t),f(this.request)}:function(...t){return f(e.apply(k(this),t))}}function ie(e){return typeof e=="function"?re(e):(e instanceof IDBTransaction&&se(e),I(e,ee())?new Proxy(e,C):e)}function f(e){if(e instanceof IDBRequest)return ne(e);if(y.has(e))return y.get(e);const t=ie(e);return t!==e&&(y.set(e,t),v.set(t,e)),t}const k=e=>v.get(e);function oe(e,t,{blocked:n,upgrade:i,blocking:a,terminated:c}={}){const o=indexedDB.open(e,t),d=f(o);return i&&o.addEventListener("upgradeneeded",r=>{i(f(o.result),r.oldVersion,r.newVersion,f(o.transaction),r)}),n&&o.addEventListener("blocked",r=>n(r.oldVersion,r.newVersion,r)),d.then(r=>{c&&r.addEventListener("close",()=>c()),a&&r.addEventListener("versionchange",h=>a(h.oldVersion,h.newVersion,h))}).catch(()=>{}),d}const ae=["get","getKey","getAll","getAllKeys","count"],ce=["put","add","delete","clear"],p=new Map;function M(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(p.get(t))return p.get(t);const n=t.replace(/FromIndex$/,""),i=t!==n,a=ce.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!(a||ae.includes(n)))return;const c=async function(o,...d){const r=this.transaction(o,a?"readwrite":"readonly");let h=r.store;return i&&(h=h.index(d.shift())),(await Promise.all([h[n](...d),a&&r.done]))[0]};return p.set(t,c),c}V(e=>({...e,get:(t,n,i)=>M(t,n)||e.get(t,n,i),has:(t,n)=>!!M(t,n)||e.has(t,n)}));const de=["continue","continuePrimaryKey","advance"],W={},_=new WeakMap,$=new WeakMap,le={get(e,t){if(!de.includes(t))return e[t];let n=W[t];return n||(n=W[t]=function(...i){_.set(this,$.get(this)[t](...i))}),n}};async function*ue(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;t=t;const n=new Proxy(t,le);for($.set(n,t),v.set(n,k(t));t;)yield n,t=await(_.get(n)||t.continue()),_.delete(n)}function A(e,t){return t===Symbol.asyncIterator&&I(e,[IDBIndex,IDBObjectStore,IDBCursor])||t==="iterate"&&I(e,[IDBIndex,IDBObjectStore])}V(e=>({...e,get(t,n,i){return A(t,n)?ue:e.get(t,n,i)},has(t,n){return A(t,n)||e.has(t,n)}}));const R=oe("test",2,{upgrade(e){e.createObjectStore("savedPosts")}}),he=u.lazy(()=>w(()=>import("./AddToFeedDialog-B1Hg4k0E.js"),__vite__mapDeps([0,1,2]),import.meta.url));async function fe(e){await(await R).put("savedPosts",e,e.id)}async function me(e){await(await R).delete("savedPosts",e.id)}function xe({post:e}){var F;const t=g(),{author:n,subreddit:i,subreddit_name_prefixed:a,crosspost_parent_list:c}=e,{val:o}=t,d=((F=c==null?void 0:c[0])==null?void 0:F.subreddit_name_prefixed)??"",r=a,h=b(a,t.favorites),z=b(a,t.favorites),[G,E]=u.useState(!1),[P,x]=u.useState(),[K,S]=u.useState(!1),U=`/u/${n}`;return s.jsxs("div",{children:[P?s.jsx(Z,{error:P}):null,d?s.jsxs(s.Fragment,{children:[s.jsxs(l,{onClick:()=>{t.setVal(d)},children:["Browse ",d]}),h?null:s.jsxs(l,{onClick:()=>{t.addFavorite(d)},children:[s.jsx(D,{className:"inline"})," ",d]})]}):null,r===U?null:s.jsxs(s.Fragment,{children:[s.jsxs(l,{onClick:()=>{t.setVal(r)},children:["Browse ",r]}),z?null:s.jsxs(l,{onClick:()=>{t.addFavorite(r)},children:[s.jsx(D,{className:"inline"})," ",r]})]}),o==="savedposts"?s.jsxs(l,{onClick:()=>{(async()=>{try{x(void 0),await me(e),t.forceRerender()}catch(m){x(m),console.error(m)}})()},children:[s.jsx(L,{className:"inline"})," Remove from saved"]}):s.jsxs(l,{onClick:()=>{(async()=>{try{x(void 0),await fe(e)}catch(m){x(m),console.error(m)}})(),E(!0),setTimeout(()=>{E(!1)},400)},children:[s.jsx(L,{className:"inline"})," ",G?"Saved!":"Save post"]}),s.jsxs(l,{onClick:()=>{S(!0)},children:[s.jsx(O,{className:"inline"})," Add ",a," to feed"]}),K?s.jsx(u.Suspense,{fallback:null,children:s.jsx(he,{subreddit:i,onClose:()=>{S(!1)}})}):null]})}const je=u.lazy(()=>w(()=>import("./AddToFeedDialog-B1Hg4k0E.js"),__vite__mapDeps([0,1,2]),import.meta.url));function ge({post:e}){const t=g(),{author:n}=e,{favorites:i,blocked:a}=t,[c,o]=u.useState(!1),d=b(`/user/${n}`,i),r=`/u/${n}`;return s.jsxs("div",{children:[s.jsxs(l,{onClick:()=>{t.setVal(`/user/${n}`)},children:["Browse ",`/u/${n}`]}),d?null:s.jsxs(l,{onClick:()=>{t.addFavorite(`/user/${n}`)},children:[s.jsx(D,{className:"inline"})," ",r]}),d||a.includes(n)?null:s.jsxs(l,{onClick:()=>{t.setBlocked(n)},children:[s.jsx(H,{className:"inline"})," Block ",r]}),s.jsxs(l,{onClick:()=>{o(!0)},children:[s.jsx(O,{className:"inline"})," Add ",r," to feed"]}),c?s.jsx(u.Suspense,{fallback:null,children:s.jsx(je,{subreddit:`u_${n}`,onClose:()=>{o(!1)}})}):null]})}function we({post:e}){const{subreddit_name_prefixed:t,author:n}=e,i=`u/${n}`;return s.jsxs("div",{children:[s.jsx(ge,{post:e}),i===t?null:s.jsx(xe,{post:e})]})}function ve(e){return J({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M4 14h4v7a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-7h4a1.001 1.001 0 0 0 .781-1.625l-8-10c-.381-.475-1.181-.475-1.562 0l-8 10A1.001 1.001 0 0 0 4 14z"},child:[]}]})(e)}function ye({post:e}){const{hideButtons:t}=g(),{author:n,subreddit_name_prefixed:i,title:a,permalink:c,url:o}=e;return s.jsxs("div",{children:[s.jsxs("h4",{className:"inline",children:[Q(a)," (",Y(new Date(e.created*1e3),{addSuffix:!0}),") [",e.score," ",s.jsx(ve,{className:"inline"}),"]"]})," ","(",s.jsx(j,{href:`https://reddit.com/u/${n}`,target:"_blank",rel:"noreferrer",children:"user"}),") (",s.jsx(j,{href:o,target:"_blank",rel:"noreferrer",children:"url"}),") (",s.jsx(j,{href:`https://reddit.com/${i}`,target:"_blank",rel:"noreferrer",children:"subreddit"}),") (",s.jsx(j,{href:`https://reddit.com${c}`,target:"_blank",rel:"noreferrer",children:"comments"}),")",t?null:s.jsx(we,{post:e})]})}const pe=u.lazy(()=>w(()=>import("./RedGifsCard-BuLEMZa4.js"),__vite__mapDeps([3,1,2]),import.meta.url)),be=u.lazy(()=>w(()=>import("./GalleryCard-CwN9EtSw.js"),__vite__mapDeps([4,1,2,5,6,7]),import.meta.url));function De(e){return!e.includes("redgifs")&&(e.endsWith(".jpg")||e.endsWith(".jpeg")||e.endsWith(".webp")||e.endsWith(".png")||e.endsWith(".gif")||e.endsWith(".webp"))}function Ie({post:e}){const{title:t,url:n}=e;return s.jsxs("div",{children:[s.jsx(ye,{post:e}),n.startsWith("https://www.reddit.com/gallery")?s.jsx(be,{post:e}):n.includes("redgifs")?s.jsx(pe,{post:e}):De(n)?s.jsx(q,{title:t,url:n}):s.jsxs("div",{children:["We do not know how to embed this post type yet!"," ",s.jsxs("a",{href:n,children:[n," ",t]})]})]})}function Ee({posts:e}){const{noGifs:t,blocked:n,skipPinned:i,dedupe:a,fullscreen:c,redGifsOnly:o}=g();let d=e.filter(r=>!("comment_type"in r)).filter(({url:r})=>r.includes("redgifs")||r.endsWith(".jpg")||r.endsWith(".webp")||r.endsWith(".jpeg")||r.endsWith(".png")||r.endsWith(".gif")||r.endsWith(".webp")||r.startsWith("https://www.reddit.com/gallery")).filter(r=>t?!r.url.endsWith(".gif"):!0).filter(r=>o?r.url.includes("redgifs"):!0).filter(r=>i?!r.pinned:!0).filter(r=>!n.includes(r.author));return a&&(d=X(d,r=>r.url)),s.jsx("div",{className:"flex justify-center overflow-hidden",children:s.jsx("div",{className:c?"lg:w-11/12":"lg:w-1/2",children:s.jsx("div",{className:"flex flex-col space-y-20",children:d.length>0?d.map(r=>s.jsx(Ie,{post:r},r.id)):s.jsx("h1",{children:"No results on this page, check your filters in the settings or this may just have been a page of comments if you are browsing a user page"})})})})}export{Ee as C,Z as E,q as I,_e as L,R as d};
//# sourceMappingURL=CardList-BrRTeOC_.js.map
