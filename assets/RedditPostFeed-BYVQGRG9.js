import{r as E,R as It,u as re,a as oe,j as J}from"./index-OviC5k9U.js";import{L as zt,E as ie,C as ae}from"./CardList-BM7Uy7WD.js";import"./Link-9TAySftR.js";import"./formatDistanceToNowStrict-DGPDrA_T.js";import"./en-US-Ckk-QizZ.js";var Ht={exports:{}},Kt={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ot=E;function ce(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var ue=typeof Object.is=="function"?Object.is:ce,le=ot.useState,fe=ot.useEffect,de=ot.useLayoutEffect,Ee=ot.useDebugValue;function he(t,e){var n=e(),i=le({inst:{value:n,getSnapshot:e}}),s=i[0].inst,r=i[1];return de(function(){s.value=n,s.getSnapshot=e,wt(s)&&r({inst:s})},[t,n,e]),fe(function(){return wt(s)&&r({inst:s}),t(function(){wt(s)&&r({inst:s})})},[t]),Ee(n),n}function wt(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!ue(t,n)}catch{return!0}}function Re(t,e){return e()}var pe=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?Re:he;Kt.useSyncExternalStore=ot.useSyncExternalStore!==void 0?ot.useSyncExternalStore:pe;Ht.exports=Kt;var Bt=Ht.exports;const X=()=>{},D=X(),_t=Object,c=t=>t===D,$=t=>typeof t=="function",Q=(t,e)=>({...t,...e}),ge=t=>$(t.then),ht=new WeakMap;let me=0;const ft=t=>{const e=typeof t,n=t&&t.constructor,i=n==Date;let s,r;if(_t(t)===t&&!i&&n!=RegExp){if(s=ht.get(t),s)return s;if(s=++me+"~",ht.set(t,s),n==Array){for(s="@",r=0;r<t.length;r++)s+=ft(t[r])+",";ht.set(t,s)}if(n==_t){s="#";const u=_t.keys(t).sort();for(;!c(r=u.pop());)c(t[r])||(s+=r+":"+ft(t[r])+",");ht.set(t,s)}}else s=i?t.toJSON():e=="symbol"?t.toString():e=="string"?JSON.stringify(t):""+t;return s},k=new WeakMap,Tt={},Rt={},xt="undefined",gt=typeof window!=xt,bt=typeof document!=xt,ve=()=>gt&&typeof window.requestAnimationFrame!=xt,G=(t,e)=>{const n=k.get(t);return[()=>!c(e)&&t.get(e)||Tt,i=>{if(!c(e)){const s=t.get(e);e in Rt||(Rt[e]=s),n[5](e,Q(s,i),s||Tt)}},n[6],()=>!c(e)&&e in Rt?Rt[e]:!c(e)&&t.get(e)||Tt]};let Dt=!0;const Se=()=>Dt,[At,Lt]=gt&&window.addEventListener?[window.addEventListener.bind(window),window.removeEventListener.bind(window)]:[X,X],we=()=>{const t=bt&&document.visibilityState;return c(t)||t!=="hidden"},_e=t=>(bt&&document.addEventListener("visibilitychange",t),At("focus",t),()=>{bt&&document.removeEventListener("visibilitychange",t),Lt("focus",t)}),Te=t=>{const e=()=>{Dt=!0,t()},n=()=>{Dt=!1};return At("online",e),At("offline",n),()=>{Lt("online",e),Lt("offline",n)}},Ce={isOnline:Se,isVisible:we},ye={initFocus:_e,initReconnect:Te},Ut=!It.useId,dt=!gt||"Deno"in window,Oe=t=>ve()?window.requestAnimationFrame(t):setTimeout(t,1),pt=dt?E.useEffect:E.useLayoutEffect,Ct=typeof navigator<"u"&&navigator.connection,$t=!dt&&Ct&&(["slow-2g","2g"].includes(Ct.effectiveType)||Ct.saveData),it=t=>{if($(t))try{t=t()}catch{t=""}const e=t;return t=typeof t=="string"?t:(Array.isArray(t)?t.length:t)?ft(t):"",[t,e]};let be=0;const Vt=()=>++be,Jt=0,Yt=1,Gt=2,De=3;var lt={__proto__:null,ERROR_REVALIDATE_EVENT:De,FOCUS_EVENT:Jt,MUTATE_EVENT:Gt,RECONNECT_EVENT:Yt};async function Xt(...t){const[e,n,i,s]=t,r=Q({populateCache:!0,throwOnError:!0},typeof s=="boolean"?{revalidate:s}:s||{});let u=r.populateCache;const S=r.rollbackOnError;let l=r.optimisticData;const C=_=>typeof S=="function"?S(_):S!==!1,w=r.throwOnError;if($(n)){const _=n,a=[],y=e.keys();for(const p of y)!/^\$(inf|sub)\$/.test(p)&&_(e.get(p)._k)&&a.push(p);return Promise.all(a.map(R))}return R(n);async function R(_){const[a]=it(_);if(!a)return;const[y,p]=G(e,a),[et,o,F,z]=k.get(e),M=()=>{const L=et[a];return($(r.revalidate)?r.revalidate(y().data,_):r.revalidate!==!1)&&(delete F[a],delete z[a],L&&L[0])?L[0](Gt).then(()=>y().data):y().data};if(t.length<3)return M();let d=i,h;const H=Vt();o[a]=[H,0];const f=!c(l),P=y(),g=P.data,A=P._c,U=c(A)?g:A;if(f&&(l=$(l)?l(U,g):l,p({data:l,_c:U})),$(d))try{d=d(U)}catch(L){h=L}if(d&&ge(d))if(d=await d.catch(L=>{h=L}),H!==o[a][0]){if(h)throw h;return d}else h&&f&&C(h)&&(u=!0,p({data:U,_c:D}));if(u&&!h)if($(u)){const L=u(d,U);p({data:L,error:D,_c:D})}else p({data:d,error:D,_c:D});if(o[a][1]=Vt(),Promise.resolve(M()).then(()=>{p({_c:D})}),h){if(w)throw h;return}return d}}const qt=(t,e)=>{for(const n in t)t[n][0]&&t[n][0](e)},Ae=(t,e)=>{if(!k.has(t)){const n=Q(ye,e),i={},s=Xt.bind(D,t);let r=X;const u={},S=(w,R)=>{const _=u[w]||[];return u[w]=_,_.push(R),()=>_.splice(_.indexOf(R),1)},l=(w,R,_)=>{t.set(w,R);const a=u[w];if(a)for(const y of a)y(R,_)},C=()=>{if(!k.has(t)&&(k.set(t,[i,{},{},{},s,l,S]),!dt)){const w=n.initFocus(setTimeout.bind(D,qt.bind(D,i,Jt))),R=n.initReconnect(setTimeout.bind(D,qt.bind(D,i,Yt)));r=()=>{w&&w(),R&&R(),k.delete(t)}}};return C(),[t,s,C,r]}return[t,k.get(t)[4]]},Le=(t,e,n,i,s)=>{const r=n.errorRetryCount,u=s.retryCount,S=~~((Math.random()+.5)*(1<<(u<8?u:8)))*n.errorRetryInterval;!c(r)&&u>r||setTimeout(i,S,s)},Ve=(t,e)=>ft(t)==ft(e),[Nt,Ie]=Ae(new Map),xe=Q({onLoadingSlow:X,onSuccess:X,onError:X,onErrorRetry:Le,onDiscarded:X,revalidateOnFocus:!0,revalidateOnReconnect:!0,revalidateIfStale:!0,shouldRetryOnError:!0,errorRetryInterval:$t?1e4:5e3,focusThrottleInterval:5*1e3,dedupingInterval:2*1e3,loadingTimeout:$t?5e3:3e3,compare:Ve,isPaused:()=>!1,cache:Nt,mutate:Ie,fallback:{}},Ce),Ne=(t,e)=>{const n=Q(t,e);if(e){const{use:i,fallback:s}=t,{use:r,fallback:u}=e;i&&r&&(n.use=i.concat(r)),s&&u&&(n.fallback=Q(s,u))}return n},Fe=E.createContext({}),Qt="$inf$",Zt=gt&&window.__SWR_DEVTOOLS_USE__,Pe=Zt?window.__SWR_DEVTOOLS_USE__:[],Me=()=>{Zt&&(window.__SWR_DEVTOOLS_REACT__=It)},te=t=>$(t[1])?[t[0],t[1],t[2]||{}]:[t[0],null,(t[1]===null?t[2]:t[1])||{}],je=()=>Q(xe,E.useContext(Fe)),We=t=>(e,n,i)=>t(e,n&&((...r)=>{const[u]=it(e),[,,,S]=k.get(Nt);if(u.startsWith(Qt))return n(...r);const l=S[u];return c(l)?n(...r):(delete S[u],l)}),i),ze=Pe.concat(We),Ue=t=>function(...n){const i=je(),[s,r,u]=te(n),S=Ne(i,u);let l=t;const{use:C}=S,w=(C||[]).concat(ze);for(let R=w.length;R--;)l=w[R](l);return l(s,r||S.fetcher||null,S)},$e=(t,e,n)=>{const i=e[t]||(e[t]=[]);return i.push(n),()=>{const s=i.indexOf(n);s>=0&&(i[s]=i[i.length-1],i.pop())}},qe=(t,e)=>(...n)=>{const[i,s,r]=te(n),u=(r.use||[]).concat(e);return t(i,s,{...r,use:u})};Me();const kt=It.use||(t=>{if(t.status==="pending")throw t;if(t.status==="fulfilled")return t.value;throw t.status==="rejected"?t.reason:(t.status="pending",t.then(e=>{t.status="fulfilled",t.value=e},e=>{t.status="rejected",t.reason=e}),t)}),yt={dedupe:!0},ke=(t,e,n)=>{const{cache:i,compare:s,suspense:r,fallbackData:u,revalidateOnMount:S,revalidateIfStale:l,refreshInterval:C,refreshWhenHidden:w,refreshWhenOffline:R,keepPreviousData:_}=n,[a,y,p,et]=k.get(i),[o,F]=it(t),z=E.useRef(!1),M=E.useRef(!1),d=E.useRef(o),h=E.useRef(e),H=E.useRef(n),f=()=>H.current,P=()=>f().isVisible()&&f().isOnline(),[g,A,U,L]=G(i,o),x=E.useRef({}).current,Z=c(u)?n.fallback[o]:u,tt=(m,v)=>{for(const I in x){const T=I;if(T==="data"){if(!s(m[T],v[T])&&(!c(m[T])||!s(ct,v[T])))return!1}else if(v[T]!==m[T])return!1}return!0},O=E.useMemo(()=>{const m=!o||!e?!1:c(S)?f().isPaused()||r?!1:c(l)?!0:l:S,v=N=>{const K=Q(N);return delete K._k,m?{isValidating:!0,isLoading:!0,...K}:K},I=g(),T=L(),q=v(I),rt=I===T?q:v(T);let b=q;return[()=>{const N=v(g());return tt(N,b)?(b.data=N.data,b.isLoading=N.isLoading,b.isValidating=N.isValidating,b.error=N.error,b):(b=N,N)},()=>rt]},[i,o]),j=Bt.useSyncExternalStore(E.useCallback(m=>U(o,(v,I)=>{tt(I,v)||m()}),[i,o]),O[0],O[1]),nt=!z.current,mt=a[o]&&a[o].length>0,Y=j.data,V=c(Y)?Z:Y,st=j.error,at=E.useRef(V),ct=_?c(Y)?at.current:Y:V,Et=mt&&!c(st)?!1:nt&&!c(S)?S:f().isPaused()?!1:r?c(V)?!1:l:c(V)||l,Ft=!!(o&&e&&nt&&Et),ee=c(j.isValidating)?Ft:j.isValidating,ne=c(j.isLoading)?Ft:j.isLoading,ut=E.useCallback(async m=>{const v=h.current;if(!o||!v||M.current||f().isPaused())return!1;let I,T,q=!0;const rt=m||{},b=!p[o]||!rt.dedupe,N=()=>Ut?!M.current&&o===d.current&&z.current:o===d.current,K={isValidating:!1,isLoading:!1},Mt=()=>{A(K)},jt=()=>{const W=p[o];W&&W[1]===T&&delete p[o]},Wt={isValidating:!0};c(g().data)&&(Wt.isLoading=!0);try{if(b&&(A(Wt),n.loadingTimeout&&c(g().data)&&setTimeout(()=>{q&&N()&&f().onLoadingSlow(o,n)},n.loadingTimeout),p[o]=[v(F),Vt()]),[I,T]=p[o],I=await I,b&&setTimeout(jt,n.dedupingInterval),!p[o]||p[o][1]!==T)return b&&N()&&f().onDiscarded(o),!1;K.error=D;const W=y[o];if(!c(W)&&(T<=W[0]||T<=W[1]||W[1]===0))return Mt(),b&&N()&&f().onDiscarded(o),!1;const B=g().data;K.data=s(B,I)?B:I,b&&N()&&f().onSuccess(I,o,n)}catch(W){jt();const B=f(),{shouldRetryOnError:vt}=B;B.isPaused()||(K.error=W,b&&N()&&(B.onError(W,o,B),(vt===!0||$(vt)&&vt(W))&&(!f().revalidateOnFocus||!f().revalidateOnReconnect||P())&&B.onErrorRetry(W,o,B,se=>{const St=a[o];St&&St[0]&&St[0](lt.ERROR_REVALIDATE_EVENT,se)},{retryCount:(rt.retryCount||0)+1,dedupe:!0})))}return q=!1,Mt(),!0},[o,i]),Pt=E.useCallback((...m)=>Xt(i,d.current,...m),[]);if(pt(()=>{h.current=e,H.current=n,c(Y)||(at.current=Y)}),pt(()=>{if(!o)return;const m=ut.bind(D,yt);let v=0;const T=$e(o,a,(q,rt={})=>{if(q==lt.FOCUS_EVENT){const b=Date.now();f().revalidateOnFocus&&b>v&&P()&&(v=b+f().focusThrottleInterval,m())}else if(q==lt.RECONNECT_EVENT)f().revalidateOnReconnect&&P()&&m();else{if(q==lt.MUTATE_EVENT)return ut();if(q==lt.ERROR_REVALIDATE_EVENT)return ut(rt)}});return M.current=!1,d.current=o,z.current=!0,A({_k:F}),Et&&(c(V)||dt?m():Oe(m)),()=>{M.current=!0,T()}},[o]),pt(()=>{let m;function v(){const T=$(C)?C(g().data):C;T&&m!==-1&&(m=setTimeout(I,T))}function I(){!g().error&&(w||f().isVisible())&&(R||f().isOnline())?ut(yt).then(v):v()}return v(),()=>{m&&(clearTimeout(m),m=-1)}},[C,w,R,o]),E.useDebugValue(ct),r&&c(V)&&o){if(!Ut&&dt)throw new Error("Fallback data is required when using suspense in SSR.");h.current=e,H.current=n,M.current=!1;const m=et[o];if(!c(m)){const v=Pt(m);kt(v)}if(c(st)){const v=ut(yt);c(ct)||(v.status="fulfilled",v.value=!0),kt(v)}else throw st}return{mutate:Pt,get data(){return x.data=!0,ct},get error(){return x.error=!0,st},get isValidating(){return x.isValidating=!0,ee},get isLoading(){return x.isLoading=!0,ne}}},He=Ue(ke),Ke=t=>it(t?t(0,null):null)[0],Ot=Promise.resolve(),Be=t=>(e,n,i)=>{const s=E.useRef(!1),{cache:r,initialSize:u=1,revalidateAll:S=!1,persistSize:l=!1,revalidateFirstPage:C=!0,revalidateOnMount:w=!1,parallel:R=!1}=i,[,,,_]=k.get(Nt);let a;try{a=Ke(e),a&&(a=Qt+a)}catch{}const[y,p,et]=G(r,a),o=E.useCallback(()=>c(y()._l)?u:y()._l,[r,a,u]);Bt.useSyncExternalStore(E.useCallback(f=>a?et(a,()=>{f()}):()=>{},[r,a]),o,o);const F=E.useCallback(()=>{const f=y()._l;return c(f)?u:f},[a,u]),z=E.useRef(F());pt(()=>{if(!s.current){s.current=!0;return}a&&p({_l:l?z.current:F()})},[a,r]);const M=w&&!s.current,d=t(a,async f=>{const P=y()._i,g=y()._r;p({_r:D});const A=[],U=F(),[L]=G(r,f),x=L().data,Z=[];let tt=null;for(let O=0;O<U;++O){const[j,nt]=it(e(O,R?null:tt));if(!j)break;const[mt,Y]=G(r,j);let V=mt().data;const st=S||P||c(V)||C&&!O&&!c(x)||M||x&&!c(x[O])&&!i.compare(x[O],V);if(n&&(typeof g=="function"?g(V,nt):st)){const at=async()=>{if(!(j in _))V=await n(nt);else{const Et=_[j];delete _[j],V=await Et}Y({data:V,_k:nt}),A[O]=V};R?Z.push(at):await at()}else A[O]=V;R||(tt=V)}return R&&await Promise.all(Z.map(O=>O())),p({_i:D}),A},i),h=E.useCallback(function(f,P){const g=typeof P=="boolean"?{revalidate:P}:P||{},A=g.revalidate!==!1;return a?(A&&(c(f)?p({_i:!0,_r:g.revalidate}):p({_i:!1,_r:g.revalidate})),arguments.length?d.mutate(f,{...g,revalidate:A}):d.mutate()):Ot},[a,r]),H=E.useCallback(f=>{if(!a)return Ot;const[,P]=G(r,a);let g;if($(f)?g=f(F()):typeof f=="number"&&(g=f),typeof g!="number")return Ot;P({_l:g}),z.current=g;const A=[],[U]=G(r,a);let L=null;for(let x=0;x<g;++x){const[Z]=it(e(x,L)),[tt]=G(r,Z),O=Z?tt().data:D;if(c(O))return h(U().data);A.push(O),L=O}return h(A)},[a,r,h,F]);return{size:F(),setSize:H,mutate:h,get data(){return d.data},get error(){return d.error},get isValidating(){return d.isValidating},get isLoading(){return d.isLoading}}},Je=qe(He,Be),Ye=t=>(e,n)=>n&&!n.after?null:e===0?`${t}${t.includes("?")?"&":"?"}limit=25`:`${t}${t.includes("?")?"&":"?"}after=${n==null?void 0:n.after}&limit=25`;function en(){var z,M;const t=re(),{mode:e,val:n}=t,{isIntersecting:i,ref:s}=oe({threshold:.9});E.useEffect(()=>{function d(h){h.state&&t.setVal(h.state.val)}return window.addEventListener("popstate",d),()=>{window.removeEventListener("popstate",d)}},[t]);const r={topall:"/top.json?t=all",topmonth:"/top.json?t=month",topday:"/top.json?t=day",topyear:"/top.json?t=year",hot:".json",new:"/new.json"},u=E.useRef(!1),S=`https://www.reddit.com/${n.startsWith("/")?n.slice(1):n}${r[e]??""}`,{data:l,size:C,setSize:w,error:R,isValidating:_,isLoading:a}=Je(Ye(S),async d=>{const h=await fetch(d);if(!h.ok)throw new Error(`HTTP ${h.status} fetching ${d} ${await h.text()}`);return(await h.json()).data}),y=l==null?void 0:l.flatMap(d=>d.children).map(d=>d.data),p=a||C>0&&(l==null?void 0:l[C-1])===void 0,o=(((z=l==null?void 0:l[0])==null?void 0:z.children.length)??0)===0||(((M=l==null?void 0:l.at(-1))==null?void 0:M.children.length)??0)<25,F=_&&l&&l.length===C;return E.useEffect(()=>{i&&!u.current&&!a&&!F&&!o&&(u.current=!0,setTimeout(()=>{w(C+1).then(()=>{u.current=!1}).catch(d=>{console.error(d)})},400))},[i,w,C,o,F,a]),J.jsx("div",{children:a?J.jsx("div",{className:"flex justify-center",children:J.jsx(zt,{})}):R?J.jsx(ie,{error:R}):y?J.jsxs(J.Fragment,{children:[J.jsx(ae,{posts:y}),J.jsx("div",{ref:s,style:{height:400},className:"flex justify-center mt-10",children:p?J.jsx(zt,{}):o?"End of feed!":"Scroll all the way down to load more..."})]}):null})}export{en as default};
//# sourceMappingURL=RedditPostFeed-BYVQGRG9.js.map
