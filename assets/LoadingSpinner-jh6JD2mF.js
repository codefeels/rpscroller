const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./AddToFeedDialog-BfRc8vOE.js","./index-CtXPi8iy.js","./index-4Dlsw4Xn.css","./BaseDialog-DMAPSbwp.js","./RedGifsCard-S293SzBO.js","./GalleryCard-BwdrqYUl.js","./Sidebar-DmTG1qm_.js","./Link-DGsGiNCV.js","./formatDistanceToNowStrict-B7etE4jS.js","./en-US-DK8Z8mF7.js"])))=>i.map(i=>d[i]);
import{G as re,j as t,u as v,a as ie,p as y,r as u,q as W,L as p,s as b,t as oe,v as F,M as ae,_ as E,w as de,B as ce}from"./index-CtXPi8iy.js";import{g as z,h as G}from"./Sidebar-DmTG1qm_.js";import{d as D,a as V}from"./BaseDialog-DMAPSbwp.js";import{L as g}from"./Link-DGsGiNCV.js";import{f as le}from"./formatDistanceToNowStrict-B7etE4jS.js";function ue(e){return re({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M4 14h4v7a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-7h4a1.001 1.001 0 0 0 .781-1.625l-8-10c-.381-.475-1.181-.475-1.562 0l-8 10A1.001 1.001 0 0 0 4 14z"},child:[]}]})(e)}function he({error:e}){return t.jsxs("div",{className:"text-red-600 m-20",children:[t.jsx("div",{children:`${e}`}),t.jsxs("div",{children:[`${e}`=="TypeError: NetworkError when attempting to fetch resource."?"If you are on firefox then you can disable 'Enhanced Tracking Protection' (at your own risk) to fix this error":""," "]})]})}const I=(e,n)=>n.some(s=>e instanceof s);let $,H;function fe(){return $||($=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function me(){return H||(H=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const B=new WeakMap,P=new WeakMap,w=new WeakMap;function xe(e){const n=new Promise((s,r)=>{const o=()=>{e.removeEventListener("success",a),e.removeEventListener("error",i)},a=()=>{s(x(e.result)),o()},i=()=>{r(e.error),o()};e.addEventListener("success",a),e.addEventListener("error",i)});return w.set(n,e),n}function je(e){if(B.has(e))return;const n=new Promise((s,r)=>{const o=()=>{e.removeEventListener("complete",a),e.removeEventListener("error",i),e.removeEventListener("abort",i)},a=()=>{s(),o()},i=()=>{r(e.error||new DOMException("AbortError","AbortError")),o()};e.addEventListener("complete",a),e.addEventListener("error",i),e.addEventListener("abort",i)});B.set(e,n)}let N={get(e,n,s){if(e instanceof IDBTransaction){if(n==="done")return B.get(e);if(n==="store")return s.objectStoreNames[1]?void 0:s.objectStore(s.objectStoreNames[0])}return x(e[n])},set(e,n,s){return e[n]=s,!0},has(e,n){return e instanceof IDBTransaction&&(n==="done"||n==="store")?!0:n in e}};function Q(e){N=e(N)}function be(e){return me().includes(e)?function(...n){return e.apply(S(this),n),x(this.request)}:function(...n){return x(e.apply(S(this),n))}}function ge(e){return typeof e=="function"?be(e):(e instanceof IDBTransaction&&je(e),I(e,fe())?new Proxy(e,N):e)}function x(e){if(e instanceof IDBRequest)return xe(e);if(P.has(e))return P.get(e);const n=ge(e);return n!==e&&(P.set(e,n),w.set(n,e)),n}const S=e=>w.get(e);function ve(e,n,{blocked:s,upgrade:r,blocking:o,terminated:a}={}){const i=indexedDB.open(e,n),f=x(i);return r&&i.addEventListener("upgradeneeded",d=>{r(x(i.result),d.oldVersion,d.newVersion,x(i.transaction),d)}),s&&i.addEventListener("blocked",d=>s(d.oldVersion,d.newVersion,d)),f.then(d=>{a&&d.addEventListener("close",()=>a()),o&&d.addEventListener("versionchange",c=>o(c.oldVersion,c.newVersion,c))}).catch(()=>{}),f}const we=["get","getKey","getAll","getAllKeys","count"],ye=["put","add","delete","clear"],C=new Map;function K(e,n){if(!(e instanceof IDBDatabase&&!(n in e)&&typeof n=="string"))return;if(C.get(n))return C.get(n);const s=n.replace(/FromIndex$/,""),r=n!==s,o=ye.includes(s);if(!(s in(r?IDBIndex:IDBObjectStore).prototype)||!(o||we.includes(s)))return;const a=async function(i,...f){const d=this.transaction(i,o?"readwrite":"readonly");let c=d.store;return r&&(c=c.index(f.shift())),(await Promise.all([c[s](...f),o&&d.done]))[0]};return C.set(n,a),a}Q(e=>({...e,get:(n,s,r)=>K(n,s)||e.get(n,s,r),has:(n,s)=>!!K(n,s)||e.has(n,s)}));const pe=["continue","continuePrimaryKey","advance"],U={},k=new WeakMap,X=new WeakMap,Fe={get(e,n){if(!pe.includes(n))return e[n];let s=U[n];return s||(s=U[n]=function(...r){k.set(this,X.get(this)[n](...r))}),s}};async function*De(...e){let n=this;if(n instanceof IDBCursor||(n=await n.openCursor(...e)),!n)return;n=n;const s=new Proxy(n,Fe);for(X.set(s,n),w.set(s,S(n));n;)yield s,n=await(k.get(s)||n.continue()),k.delete(s)}function J(e,n){return n===Symbol.asyncIterator&&I(e,[IDBIndex,IDBObjectStore,IDBCursor])||n==="iterate"&&I(e,[IDBIndex,IDBObjectStore])}Q(e=>({...e,get(n,s,r){return J(n,s)?De:e.get(n,s,r)},has(n,s){return J(n,s)||e.has(n,s)}}));const Y=ve("test",2,{upgrade(e){e.createObjectStore("savedPosts")}}),Pe=u.lazy(()=>E(()=>import("./AddToFeedDialog-BfRc8vOE.js"),__vite__mapDeps([0,1,2,3]),import.meta.url));async function Ce(e){await(await Y).put("savedPosts",e,e.id)}async function Ie(e){await(await Y).delete("savedPosts",e.id)}function Be({post:e}){var R;const n=v(),{author:s,subreddit:r,subreddit_name_prefixed:o,crosspost_parent_list:a}=e,{favorites:i,blocked:f}=n,d=ie(),c=`/u/${s}`,T=y(`/user/${s}`,i),h=((R=a==null?void 0:a[0])==null?void 0:R.subreddit_name_prefixed)??"",l=o,Z=y(h,i),q=y(l,i),[ee,M]=u.useState(!1),[_,j]=u.useState(),[ne,L]=u.useState(!1),[te,se]=u.useState(""),A=m=>{se(m),L(!0)},O=W(c)===W(o);return t.jsxs("div",{className:"inline",children:[t.jsx(p,{to:c,children:t.jsxs(b,{children:[t.jsx(D,{className:"inline"})," Browse ",c]})}),h?t.jsx(p,{to:h,children:t.jsxs(b,{children:[t.jsx(D,{className:"inline"})," Browse ",h]})}):null,O?null:t.jsx(p,{to:l,children:t.jsxs(b,{children:[t.jsx(D,{className:"inline"})," Browse ",l]})}),t.jsxs("div",{className:"dropdown",children:[_?t.jsx(he,{error:_}):null,t.jsxs(b,{className:"inline",children:["More options ",t.jsx(oe,{})]}),t.jsxs("ul",{tabIndex:0,className:"dropdown-content menu bg-base-300 z-1 w-80 shadow-sm",children:[t.jsxs("li",{className:"menu-title",children:["User (",c,")"]}),!T&&t.jsx("li",{children:t.jsxs("button",{onClick:()=>n.addFavorite(`/user/${s}`),children:[t.jsx(F,{className:"inline"})," Favorite user"]})}),!T&&!f.includes(s)&&t.jsx("li",{children:t.jsxs("button",{onClick:()=>n.setBlocked(s),children:[t.jsx(ae,{className:"inline"})," Block user"]})}),t.jsx("li",{children:t.jsxs("button",{onClick:()=>A(`u_${s}`),children:[t.jsx(V,{className:"inline"})," Add user to feed"]})}),t.jsx("li",{children:t.jsxs("button",{onClick:()=>n.setDefaultPage(c),children:[t.jsx(z,{className:"inline"})," Set user as home"]})}),O?null:t.jsxs(t.Fragment,{children:[t.jsxs("li",{className:"menu-title",children:["Subreddit ",h]}),h&&t.jsx(t.Fragment,{children:!Z&&t.jsx("li",{children:t.jsxs("button",{onClick:()=>n.addFavorite(h),children:[t.jsx(F,{className:"inline"})," Favorite"," ",h]})})}),l!==c&&t.jsxs(t.Fragment,{children:[!q&&t.jsx("li",{children:t.jsxs("button",{onClick:()=>n.addFavorite(l),children:[t.jsx(F,{className:"inline"})," Favorite"," ",l]})}),t.jsx("li",{children:t.jsxs("button",{onClick:()=>A(r),children:[t.jsx(V,{className:"inline"})," Add ",l," to feed"]})}),t.jsx("li",{children:t.jsxs("button",{onClick:()=>n.setDefaultPage(l),children:[t.jsx(z,{className:"inline"})," Set ",l," as home"]})})]})]}),t.jsx("li",{children:d==="savedposts"?t.jsxs("button",{onClick:()=>{(async()=>{try{j(void 0),await Ie(e),n.forceRerender()}catch(m){j(m),console.error(m)}})()},children:[t.jsx(G,{className:"inline"})," Remove from saved"]}):t.jsxs("button",{onClick:()=>{(async()=>{try{j(void 0),await Ce(e)}catch(m){j(m),console.error(m)}})(),M(!0),setTimeout(()=>{M(!1)},400)},children:[t.jsx(G,{className:"inline"})," ",ee?"Saved!":"Save post"]})})]}),ne?t.jsx(u.Suspense,{fallback:null,children:t.jsx(Pe,{subreddit:te,onClose:()=>{L(!1)}})}):null]})]})}function Ne({post:e}){return t.jsx("div",{children:t.jsx(Be,{post:e})})}function Se({post:e}){const{hideButtons:n}=v(),{author:s,subreddit_name_prefixed:r,title:o,permalink:a,url:i}=e;return t.jsxs("div",{children:[t.jsxs("h4",{className:"inline",children:[de(o)," (",le(new Date(e.created*1e3),{addSuffix:!0}),") [",e.score," ",t.jsx(ue,{className:"inline"}),"]"]})," ","(",t.jsx(g,{href:`https://reddit.com/u/${s}`,target:"_blank",rel:"noreferrer",children:"user"}),") (",t.jsx(g,{href:i,target:"_blank",rel:"noreferrer",children:"url"}),") (",t.jsx(g,{href:`https://reddit.com/${r}`,target:"_blank",rel:"noreferrer",children:"subreddit"}),") (",t.jsx(g,{href:`https://reddit.com${a}`,target:"_blank",rel:"noreferrer",children:"comments"}),")",n?null:t.jsx(Ne,{post:e})]})}function ke({title:e,url:n}){const[s,r]=u.useState(!1);return t.jsx("img",{alt:e,loading:"lazy",onClick:()=>{r(!s)},className:s?"m-auto":"w-full max-h-[80vh] object-contain",src:n})}const Ee=u.lazy(()=>E(()=>import("./RedGifsCard-S293SzBO.js"),__vite__mapDeps([4,1,2]),import.meta.url)),Te=u.lazy(()=>E(()=>import("./GalleryCard-BwdrqYUl.js"),__vite__mapDeps([5,1,2,6,3,7,8,9]),import.meta.url));function Me(e){return!e.includes("redgifs")&&(e.endsWith(".jpg")||e.endsWith(".jpeg")||e.endsWith(".webp")||e.endsWith(".png")||e.endsWith(".gif")||e.endsWith(".webp"))}function _e({post:e}){const{title:n,url:s}=e;return t.jsxs("div",{children:[t.jsx(Se,{post:e}),s.startsWith("https://www.reddit.com/gallery")?t.jsx(Te,{post:e}):s.includes("redgifs")?t.jsx(Ee,{post:e}):Me(s)?t.jsx(ke,{title:n,url:s}):t.jsxs("div",{children:["We do not know how to embed this post type yet!"," ",t.jsxs("a",{href:s,children:[s," ",n]})]})]})}function Le({totalFiltered:e}){const n=v(),{redGifsOnly:s}=n;return t.jsxs(t.Fragment,{children:[t.jsx("h1",{children:"Check your filters in the settings or this may just have been a page of comments if you are browsing a user page"}),s?t.jsxs("div",{children:["Note: RedGifs only is on.",t.jsx(ce,{onClick:()=>{n.setRedGifsOnly(!s)},children:"Turn off RedGifs only"})]}):null,t.jsx("div",{children:e?t.jsxs("div",{children:["Total posts filtered out (non-image posts, not matching filters, etc): ",e]}):null}),t.jsx("div",{children:"Note that we are not able to embed v.redd.it videos from e.g. popular SFW reddits"})]})}function Ge({posts:e,stats:n}){const{fullscreen:s}=v();return t.jsx("div",{className:"flex justify-center overflow-hidden",children:t.jsx("div",{className:s?"lg:w-11/12":"lg:w-1/2",children:t.jsx("div",{className:"flex flex-col space-y-20",children:e.length>0?e.map(r=>t.jsx(_e,{post:r},r.id)):n?t.jsx(Le,{totalPosts:n.totalPosts,commentTypeFiltered:n.commentTypeFiltered,urlTypeFiltered:n.urlTypeFiltered,gifFiltered:n.gifFiltered,redGifsOnlyFiltered:n.redGifsOnlyFiltered,noRedGifsFiltered:n.noRedGifsFiltered,pinnedFiltered:n.pinnedFiltered,blockedFiltered:n.blockedFiltered,remainingPosts:n.remainingPosts,totalFiltered:n.totalPosts-n.remainingPosts}):null})})})}function Ve(){return t.jsx("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",style:{width:100,height:100},viewBox:"0 0 24 24",children:t.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})})}export{Ge as C,he as E,ke as I,Ve as L,Y as d};
//# sourceMappingURL=LoadingSpinner-jh6JD2mF.js.map
