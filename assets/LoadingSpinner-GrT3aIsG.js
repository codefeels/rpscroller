const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./AddToFeedDialog-Cn73b5rp.js","./index-CuM5DBy1.js","./index-KJdjx5-e.css","./BaseDialog-BDARILpV.js","./RedGifsCard-DMN9mzWW.js","./GalleryCard-DFHjdTsD.js","./Sidebar-B294I6pp.js","./Link-D6gY-XmS.js","./formatDistanceToNowStrict-BGM-HUpS.js","./en-US-A-7Ux56e.js"])))=>i.map(i=>d[i]);
import{G as re,j as t,u as w,a as ie,p,r as h,q as W,L as F,s as b,t as oe,v as P,M as ae,_,w as de,B as ce}from"./index-CuM5DBy1.js";import{g as z,h as G}from"./Sidebar-B294I6pp.js";import{d as D,a as V}from"./BaseDialog-BDARILpV.js";import{L as v}from"./Link-D6gY-XmS.js";import{f as le}from"./formatDistanceToNowStrict-BGM-HUpS.js";function ue(e){return re({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M4 14h4v7a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-7h4a1.001 1.001 0 0 0 .781-1.625l-8-10c-.381-.475-1.181-.475-1.562 0l-8 10A1.001 1.001 0 0 0 4 14z"},child:[]}]})(e)}function he({error:e}){return t.jsxs("div",{className:"text-red-600 m-20",children:[t.jsx("div",{children:`${e}`}),t.jsxs("div",{children:[`${e}`=="TypeError: NetworkError when attempting to fetch resource."?"If you are on firefox then you can disable 'Enhanced Tracking Protection' (at your own risk) to fix this error":""," "]})]})}const B=(e,n)=>n.some(s=>e instanceof s);let $,H;function fe(){return $||($=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function me(){return H||(H=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const N=new WeakMap,C=new WeakMap,y=new WeakMap;function xe(e){const n=new Promise((s,r)=>{const o=()=>{e.removeEventListener("success",a),e.removeEventListener("error",i)},a=()=>{s(x(e.result)),o()},i=()=>{r(e.error),o()};e.addEventListener("success",a),e.addEventListener("error",i)});return y.set(n,e),n}function je(e){if(N.has(e))return;const n=new Promise((s,r)=>{const o=()=>{e.removeEventListener("complete",a),e.removeEventListener("error",i),e.removeEventListener("abort",i)},a=()=>{s(),o()},i=()=>{r(e.error||new DOMException("AbortError","AbortError")),o()};e.addEventListener("complete",a),e.addEventListener("error",i),e.addEventListener("abort",i)});N.set(e,n)}let S={get(e,n,s){if(e instanceof IDBTransaction){if(n==="done")return N.get(e);if(n==="store")return s.objectStoreNames[1]?void 0:s.objectStore(s.objectStoreNames[0])}return x(e[n])},set(e,n,s){return e[n]=s,!0},has(e,n){return e instanceof IDBTransaction&&(n==="done"||n==="store")?!0:n in e}};function Q(e){S=e(S)}function ge(e){return me().includes(e)?function(...n){return e.apply(k(this),n),x(this.request)}:function(...n){return x(e.apply(k(this),n))}}function be(e){return typeof e=="function"?ge(e):(e instanceof IDBTransaction&&je(e),B(e,fe())?new Proxy(e,S):e)}function x(e){if(e instanceof IDBRequest)return xe(e);if(C.has(e))return C.get(e);const n=be(e);return n!==e&&(C.set(e,n),y.set(n,e)),n}const k=e=>y.get(e);function ve(e,n,{blocked:s,upgrade:r,blocking:o,terminated:a}={}){const i=indexedDB.open(e,n),c=x(i);return r&&i.addEventListener("upgradeneeded",d=>{r(x(i.result),d.oldVersion,d.newVersion,x(i.transaction),d)}),s&&i.addEventListener("blocked",d=>s(d.oldVersion,d.newVersion,d)),c.then(d=>{a&&d.addEventListener("close",()=>a()),o&&d.addEventListener("versionchange",l=>o(l.oldVersion,l.newVersion,l))}).catch(()=>{}),c}const we=["get","getKey","getAll","getAllKeys","count"],ye=["put","add","delete","clear"],I=new Map;function K(e,n){if(!(e instanceof IDBDatabase&&!(n in e)&&typeof n=="string"))return;if(I.get(n))return I.get(n);const s=n.replace(/FromIndex$/,""),r=n!==s,o=ye.includes(s);if(!(s in(r?IDBIndex:IDBObjectStore).prototype)||!(o||we.includes(s)))return;const a=async function(i,...c){const d=this.transaction(i,o?"readwrite":"readonly");let l=d.store;return r&&(l=l.index(c.shift())),(await Promise.all([l[s](...c),o&&d.done]))[0]};return I.set(n,a),a}Q(e=>({...e,get:(n,s,r)=>K(n,s)||e.get(n,s,r),has:(n,s)=>!!K(n,s)||e.has(n,s)}));const pe=["continue","continuePrimaryKey","advance"],U={},E=new WeakMap,X=new WeakMap,Fe={get(e,n){if(!pe.includes(n))return e[n];let s=U[n];return s||(s=U[n]=function(...r){E.set(this,X.get(this)[n](...r))}),s}};async function*Pe(...e){let n=this;if(n instanceof IDBCursor||(n=await n.openCursor(...e)),!n)return;n=n;const s=new Proxy(n,Fe);for(X.set(s,n),y.set(s,k(n));n;)yield s,n=await(E.get(s)||n.continue()),E.delete(s)}function J(e,n){return n===Symbol.asyncIterator&&B(e,[IDBIndex,IDBObjectStore,IDBCursor])||n==="iterate"&&B(e,[IDBIndex,IDBObjectStore])}Q(e=>({...e,get(n,s,r){return J(n,s)?Pe:e.get(n,s,r)},has(n,s){return J(n,s)||e.has(n,s)}}));const Y=ve("test",2,{upgrade(e){e.createObjectStore("savedPosts")}}),De=h.lazy(()=>_(()=>import("./AddToFeedDialog-Cn73b5rp.js"),__vite__mapDeps([0,1,2,3]),import.meta.url));async function Ce(e){await(await Y).put("savedPosts",e,e.id)}async function Ie(e){await(await Y).delete("savedPosts",e.id)}function Be({post:e}){const n=w(),{author:s,subreddit:r,subreddit_name_prefixed:o,crosspost_parent_list:a}=e,{defaultPage:i,favorites:c,blocked:d}=n,l=ie(i),j=`/u/${s}`,T=p(`/user/${s}`,c),f=a?.[0]?.subreddit_name_prefixed??"",u=o,Z=p(f,c),q=p(u,c),[ee,M]=h.useState(!1),[L,g]=h.useState(),[ne,A]=h.useState(!1),[te,se]=h.useState(""),O=m=>{se(m),A(!0)},R=W(j)===W(o);return t.jsxs("div",{className:"inline",children:[t.jsx(F,{to:j,children:t.jsxs(b,{children:[t.jsx(D,{className:"inline"})," Browse ",j]})}),f?t.jsx(F,{to:f,children:t.jsxs(b,{children:[t.jsx(D,{className:"inline"})," Browse ",f]})}):null,R?null:t.jsx(F,{to:u,children:t.jsxs(b,{children:[t.jsx(D,{className:"inline"})," Browse ",u]})}),t.jsxs("div",{className:"dropdown",children:[L?t.jsx(he,{error:L}):null,t.jsxs(b,{className:"inline",children:["More options ",t.jsx(oe,{})]}),t.jsxs("ul",{tabIndex:0,className:"dropdown-content menu bg-base-300 z-1 w-80 shadow-sm",children:[t.jsxs("li",{className:"menu-title",children:["User (",j,")"]}),!T&&t.jsx("li",{children:t.jsxs("button",{onClick:()=>{n.addFavorite(`/user/${s}`)},children:[t.jsx(P,{className:"inline"})," Favorite user"]})}),!T&&!d.includes(s)&&t.jsx("li",{children:t.jsxs("button",{onClick:()=>{n.setBlocked(s)},children:[t.jsx(ae,{className:"inline"})," Block user"]})}),t.jsx("li",{children:t.jsxs("button",{onClick:()=>{O(`u_${s}`)},children:[t.jsx(V,{className:"inline"})," Add user to feed"]})}),t.jsx("li",{children:t.jsxs("button",{onClick:()=>{n.setDefaultPage(j)},children:[t.jsx(z,{className:"inline"})," Set user as home"]})}),R?null:t.jsxs(t.Fragment,{children:[t.jsxs("li",{className:"menu-title",children:["Subreddit ",f]}),f&&t.jsx(t.Fragment,{children:!Z&&t.jsx("li",{children:t.jsxs("button",{onClick:()=>{n.addFavorite(f)},children:[t.jsx(P,{className:"inline"})," Favorite"," ",f]})})}),u!==j&&t.jsxs(t.Fragment,{children:[!q&&t.jsx("li",{children:t.jsxs("button",{onClick:()=>{n.addFavorite(u)},children:[t.jsx(P,{className:"inline"})," Favorite"," ",u]})}),t.jsx("li",{children:t.jsxs("button",{onClick:()=>{O(r)},children:[t.jsx(V,{className:"inline"})," Add ",u," to feed"]})}),t.jsx("li",{children:t.jsxs("button",{onClick:()=>{n.setDefaultPage(u)},children:[t.jsx(z,{className:"inline"})," Set ",u," as home"]})})]})]}),t.jsx("li",{children:l==="savedposts"?t.jsxs("button",{onClick:()=>{(async()=>{try{g(void 0),await Ie(e),n.forceRerender()}catch(m){g(m),console.error(m)}})()},children:[t.jsx(G,{className:"inline"})," Remove from saved"]}):t.jsxs("button",{onClick:()=>{(async()=>{try{g(void 0),await Ce(e)}catch(m){g(m),console.error(m)}})(),M(!0),setTimeout(()=>{M(!1)},400)},children:[t.jsx(G,{className:"inline"})," ",ee?"Saved!":"Save post"]})})]}),ne?t.jsx(h.Suspense,{fallback:null,children:t.jsx(De,{subreddit:te,onClose:()=>{A(!1)}})}):null]})]})}function Ne({post:e}){return t.jsx("div",{children:t.jsx(Be,{post:e})})}function Se({post:e}){const{hideButtons:n}=w(),{author:s,subreddit_name_prefixed:r,title:o,permalink:a,url:i}=e;return t.jsxs("div",{children:[t.jsxs("h4",{className:"inline",children:[de(o)," (",le(new Date(e.created*1e3),{addSuffix:!0}),") [",e.score," ",t.jsx(ue,{className:"inline"}),"]"]})," ","(",t.jsx(v,{href:`https://reddit.com/u/${s}`,target:"_blank",rel:"noreferrer",children:"user"}),") (",t.jsx(v,{href:i,target:"_blank",rel:"noreferrer",children:"url"}),") (",t.jsx(v,{href:`https://reddit.com/${r}`,target:"_blank",rel:"noreferrer",children:"subreddit"}),") (",t.jsx(v,{href:`https://reddit.com${a}`,target:"_blank",rel:"noreferrer",children:"comments"}),")",n?null:t.jsx(Ne,{post:e})]})}function ke({title:e,url:n}){const[s,r]=h.useState(!1);return t.jsx("img",{alt:e,loading:"lazy",onClick:()=>{r(!s)},className:s?"m-auto":"w-full max-h-[80vh] object-contain",src:n})}const Ee=h.lazy(()=>_(()=>import("./RedGifsCard-DMN9mzWW.js"),__vite__mapDeps([4,1,2]),import.meta.url)),_e=h.lazy(()=>_(()=>import("./GalleryCard-DFHjdTsD.js"),__vite__mapDeps([5,1,2,6,3,7,8,9]),import.meta.url));function Te(e){return!e.includes("redgifs")&&(e.endsWith(".jpg")||e.endsWith(".jpeg")||e.endsWith(".webp")||e.endsWith(".png")||e.endsWith(".gif")||e.endsWith(".webp"))}function Me({post:e}){const{title:n,url:s}=e;return t.jsxs("div",{children:[t.jsx(Se,{post:e}),s.startsWith("https://www.reddit.com/gallery")?t.jsx(_e,{post:e}):s.includes("redgifs")?t.jsx(Ee,{post:e}):Te(s)?t.jsx(ke,{title:n,url:s}):t.jsxs("div",{children:["We do not know how to embed this post type yet!"," ",t.jsxs("a",{href:s,children:[s," ",n]})]})]})}function Le({totalFiltered:e}){const n=w(),{redGifsOnly:s}=n;return t.jsxs(t.Fragment,{children:[t.jsx("h1",{children:"Check your filters in the settings or this may just have been a page of comments if you are browsing a user page"}),s?t.jsxs("div",{children:["Note: RedGifs only is on.",t.jsx(ce,{onClick:()=>{n.setRedGifsOnly(!s)},children:"Turn off RedGifs only"})]}):null,t.jsx("div",{children:e?t.jsxs("div",{children:["Total posts filtered out (non-image posts, not matching filters, etc): ",e]}):null}),t.jsx("div",{children:"Note that we are not able to embed v.redd.it videos from e.g. popular SFW reddits"})]})}function Ge({posts:e,stats:n}){const{fullscreen:s}=w();return t.jsx("div",{className:"flex justify-center overflow-hidden",children:t.jsx("div",{className:s?"lg:w-11/12":"lg:w-1/2",children:t.jsx("div",{className:"flex flex-col space-y-20",children:e.length>0?e.map(r=>t.jsx(Me,{post:r},r.id)):n?t.jsx(Le,{totalPosts:n.totalPosts,commentTypeFiltered:n.commentTypeFiltered,urlTypeFiltered:n.urlTypeFiltered,gifFiltered:n.gifFiltered,redGifsOnlyFiltered:n.redGifsOnlyFiltered,noRedGifsFiltered:n.noRedGifsFiltered,pinnedFiltered:n.pinnedFiltered,blockedFiltered:n.blockedFiltered,remainingPosts:n.remainingPosts,totalFiltered:n.totalPosts-n.remainingPosts}):null})})})}function Ve(){return t.jsx("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",style:{width:100,height:100},viewBox:"0 0 24 24",children:t.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})})}export{Ge as C,he as E,ke as I,Ve as L,Y as d};
//# sourceMappingURL=LoadingSpinner-GrT3aIsG.js.map
