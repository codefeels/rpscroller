import{r as S,l as se,u as X,e as ne,m as re,j as p,B as ie,a as le,o as ae}from"./index-CJ1xeFQK.js";import{w as oe,u as ce,a as de,c as fe,I as ue,b as _,i as C,s as he,d as pe,U as D,e as H,f as ge,m as me}from"./Sidebar-vtNO5HpB.js";import{C as ye,L as Y,E as Fe}from"./LoadingSpinner-nxb9egTP.js";import"./BaseDialog-C-DOVUfI.js";import"./Link-DMRvMitg.js";import"./formatDistanceToNowStrict-B7etE4jS.js";import"./en-US-DK8Z8mF7.js";const Re=()=>{},be=Re(),q=Object,K=e=>e===be,Se=e=>typeof e=="function",N=new WeakMap,U=(e,r)=>q.prototype.toString.call(e)===`[object ${r}]`;let Pe=0;const J=e=>{const r=typeof e,t=U(e,"Date"),u=U(e,"RegExp"),a=U(e,"Object");let s,o;if(q(e)===e&&!t&&!u){if(s=N.get(e),s)return s;if(s=++Pe+"~",N.set(e,s),Array.isArray(e)){for(s="@",o=0;o<e.length;o++)s+=J(e[o])+",";N.set(e,s)}if(a){s="#";const g=q.keys(e).sort();for(;!K(o=g.pop());)K(e[o])||(s+=o+":"+J(e[o])+",");N.set(e,s)}}else s=t?e.toJSON():r=="symbol"?e.toString():r=="string"?JSON.stringify(e):""+e;return s},je=e=>{if(Se(e))try{e=e()}catch{e=""}const r=e;return e=typeof e=="string"?e:(Array.isArray(e)?e.length:e)?J(e):"",[e,r]},Ee=e=>je(e?e(0,null):null)[0],B=Promise.resolve(),we=e=>(r,t,u)=>{const a=S.useRef(!1),{cache:s,initialSize:o=1,revalidateAll:g=!1,persistSize:P=!1,revalidateFirstPage:y=!0,revalidateOnMount:j=!1,parallel:h=!1}=u,[,,,n]=de.get(fe);let l;try{l=Ee(r),l&&(l=ue+l)}catch{}const[f,E,T]=_(s,l),z=S.useCallback(()=>C(f()._l)?o:f()._l,[s,l,o]);he.useSyncExternalStore(S.useCallback(i=>l?T(l,()=>{i()}):()=>{},[s,l]),z,z);const m=S.useCallback(()=>{const i=f()._l;return C(i)?o:i},[l,o]),O=S.useRef(m());pe(()=>{if(!a.current){a.current=!0;return}l&&E({_l:P?O.current:m()})},[l,s]);const A=j&&!a.current,F=e(l,async i=>{const v=f()._i,c=f()._r;E({_r:D});const R=[],L=m(),[$]=_(s,i),w=$().data,W=[];let M=null;for(let d=0;d<L;++d){const[G,k]=H(r(d,h?null:M));if(!G)break;const[Q,Z]=_(s,G);let b=Q().data;const ee=g||v||C(b)||y&&!d&&!C(w)||A||w&&!C(w[d])&&!u.compare(w[d],b);if(t&&(typeof c=="function"?c(b,k):ee)){const V=async()=>{if(!(G in n))b=await t(k);else{const te=n[G];delete n[G],b=await te}Z({data:b,_k:k}),R[d]=b};h?W.push(V):await V()}else R[d]=b;h||(M=b)}return h&&await Promise.all(W.map(d=>d())),E({_i:D}),R},u),x=S.useCallback(function(i,v){const c=typeof v=="boolean"?{revalidate:v}:v||{},R=c.revalidate!==!1;return l?(R&&(C(i)?E({_i:!0,_r:c.revalidate}):E({_i:!1,_r:c.revalidate})),arguments.length?F.mutate(i,{...c,revalidate:R}):F.mutate()):B},[l,s]),I=S.useCallback(i=>{if(!l)return B;const[,v]=_(s,l);let c;if(ge(i)?c=i(m()):typeof i=="number"&&(c=i),typeof c!="number")return B;v({_l:c}),O.current=c;const R=[],[L]=_(s,l);let $=null;for(let w=0;w<c;++w){const[W]=H(r(w,$)),[M]=_(s,W),d=W?M().data:D;if(C(d))return x(L().data);R.push(d),$=d}return x(R)},[l,s,x,m]);return{size:m(),setSize:I,mutate:x,get data(){return F.data},get error(){return F.error},get isValidating(){return F.isValidating},get isLoading(){return F.isLoading}}},xe=oe(ce,we);function ve(e,r){let t=e;const a={totalPosts:e.length,commentTypeFiltered:0,urlTypeFiltered:0,gifFiltered:0,redGifsOnlyFiltered:0,noRedGifsFiltered:0,pinnedFiltered:0,blockedFiltered:0,remainingPosts:0},s=t.filter(n=>!("comment_type"in n));a.commentTypeFiltered=t.length-s.length,t=s;const o=t.filter(({url:n})=>n.includes("redgifs")||n.endsWith(".jpg")||n.endsWith(".webp")||n.endsWith(".jpeg")||n.endsWith(".png")||n.endsWith(".gif")||n.endsWith(".webp")||n.startsWith("https://www.reddit.com/gallery"));a.urlTypeFiltered=t.length-o.length,t=o;const g=t.filter(n=>r.noGifs?!n.url.endsWith(".gif"):!0);a.gifFiltered=t.length-g.length,t=g;const P=t.filter(n=>r.redGifsOnly?n.url.includes("redgifs"):!0);a.redGifsOnlyFiltered=t.length-P.length,t=P;const y=t.filter(n=>r.noRedGifs?!n.url.includes("redgifs"):!0);a.noRedGifsFiltered=t.length-y.length,t=y;const j=t.filter(n=>r.skipPinned?!n.pinned:!0);a.pinnedFiltered=t.length-j.length,t=j;const h=t.filter(n=>!r.blocked.includes(n.author));return a.blockedFiltered=t.length-h.length,t=h,r.dedupe&&(t=se(t,n=>n.url)),a.remainingPosts=t.length,{filteredPosts:t,stats:a}}function Ce({data:e,setSize:r,size:t,isValidating:u,isLoading:a}){var x,I;const{noGifs:s,blocked:o,skipPinned:g,dedupe:P,noRedGifs:y,redGifsOnly:j}=X(),h=ne(),{isIntersecting:n,ref:l}=re({threshold:h?.5:.8}),f=S.useRef(!1),E=e.flatMap(i=>i.children).map(i=>i.data),T=a||t>0&&e[t-1]===void 0,m=(((x=e[0])==null?void 0:x.children.length)??0)===0||(((I=e.at(-1))==null?void 0:I.children.length)??0)<25,O=u&&e.length===t;S.useEffect(()=>{n&&!f.current&&!a&&!O&&!m&&(f.current=!0,setTimeout(()=>{r(t+1).then(()=>{f.current=!1}).catch(i=>{console.error(i)})},400))},[n,r,t,m,O,a]);const{filteredPosts:A,stats:F}=ve(E,{noGifs:s,blocked:o,skipPinned:g,dedupe:P,noRedGifs:y,redGifsOnly:j});return p.jsxs("div",{children:[p.jsx(ye,{posts:A,stats:F}),p.jsx("div",{ref:l,style:{height:400},className:"flex justify-center mt-10",children:T?p.jsx(Y,{}):m?"End of feed!":p.jsxs("div",{children:["(Loaded ",E.length," posts ",F.commentTypeFiltered," of those were comments) ... Scroll all the way down or"," ",p.jsx(ie,{onClick:()=>{!f.current&&!O&&(f.current=!0,setTimeout(()=>{r(t+1).then(()=>{f.current=!1}).catch(i=>{console.error(i)})},400))},children:"Click here"})," ","to load more"]})})]})}function Oe(e){return(r,t)=>t&&!t.after?null:r===0?`${e}${e.includes("?")?"&":"?"}limit=25`:`${e}${e.includes("?")?"&":"?"}after=${t==null?void 0:t.after}&limit=25`}function ze(){var n;const e=X(),{defaultPage:r,mode:t}=e,u=le(r),a=(n=ae.get(t))==null?void 0:n.url,s=`https://www.reddit.com/${u.startsWith("/")?u.slice(1):u}${a??""}`,{data:o,size:g,setSize:P,error:y,isValidating:j,isLoading:h}=xe(Oe(s),async l=>(await me(l)).data);return p.jsx("div",{children:h?p.jsx("div",{className:"flex justify-center",children:p.jsx(Y,{})}):y?p.jsx(Fe,{error:y}):o?p.jsx(Ce,{data:o,setSize:P,size:g,isValidating:j,isLoading:h}):null})}export{ze as default};
//# sourceMappingURL=RedditPostFeed-d0CI9g8v.js.map
