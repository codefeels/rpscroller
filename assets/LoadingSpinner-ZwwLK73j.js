const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./AddToFeedDialog-4QsKJ5no.js","./index-DA__Vl02.js","./index-4Dlsw4Xn.css","./BaseDialog-BGZLSXYT.js","./RedGifsCard-BOdTUg3X.js","./GalleryCard-B4CVEwzc.js","./Sidebar-CXBXIimu.js","./Link-BuRFmrPy.js","./formatDistanceToNowStrict-B7etE4jS.js","./en-US-DK8Z8mF7.js"])))=>i.map(i=>d[i]);
import{G as se,j as t,u as v,o as w,r as u,p as R,q as b,s as re,t as p,M as ie,_ as B,v as oe,B as ae}from"./index-DA__Vl02.js";import{g as W,h as z}from"./Sidebar-CXBXIimu.js";import{d as F,a as G}from"./BaseDialog-BGZLSXYT.js";import{L as g}from"./Link-BuRFmrPy.js";import{f as de}from"./formatDistanceToNowStrict-B7etE4jS.js";function ce(e){return se({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M4 14h4v7a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-7h4a1.001 1.001 0 0 0 .781-1.625l-8-10c-.381-.475-1.181-.475-1.562 0l-8 10A1.001 1.001 0 0 0 4 14z"},child:[]}]})(e)}function le({error:e}){return t.jsxs("div",{className:"text-red-600 m-20",children:[t.jsx("div",{children:`${e}`}),t.jsxs("div",{children:[`${e}`=="TypeError: NetworkError when attempting to fetch resource."?"If you are on firefox then you can disable 'Enhanced Tracking Protection' (at your own risk) to fix this error":""," "]})]})}const P=(e,n)=>n.some(s=>e instanceof s);let V,$;function ue(){return V||(V=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function he(){return $||($=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const C=new WeakMap,D=new WeakMap,y=new WeakMap;function fe(e){const n=new Promise((s,r)=>{const o=()=>{e.removeEventListener("success",a),e.removeEventListener("error",i)},a=()=>{s(x(e.result)),o()},i=()=>{r(e.error),o()};e.addEventListener("success",a),e.addEventListener("error",i)});return y.set(n,e),n}function me(e){if(C.has(e))return;const n=new Promise((s,r)=>{const o=()=>{e.removeEventListener("complete",a),e.removeEventListener("error",i),e.removeEventListener("abort",i)},a=()=>{s(),o()},i=()=>{r(e.error||new DOMException("AbortError","AbortError")),o()};e.addEventListener("complete",a),e.addEventListener("error",i),e.addEventListener("abort",i)});C.set(e,n)}let N={get(e,n,s){if(e instanceof IDBTransaction){if(n==="done")return C.get(e);if(n==="store")return s.objectStoreNames[1]?void 0:s.objectStore(s.objectStoreNames[0])}return x(e[n])},set(e,n,s){return e[n]=s,!0},has(e,n){return e instanceof IDBTransaction&&(n==="done"||n==="store")?!0:n in e}};function J(e){N=e(N)}function xe(e){return he().includes(e)?function(...n){return e.apply(S(this),n),x(this.request)}:function(...n){return x(e.apply(S(this),n))}}function je(e){return typeof e=="function"?xe(e):(e instanceof IDBTransaction&&me(e),P(e,ue())?new Proxy(e,N):e)}function x(e){if(e instanceof IDBRequest)return fe(e);if(D.has(e))return D.get(e);const n=je(e);return n!==e&&(D.set(e,n),y.set(n,e)),n}const S=e=>y.get(e);function be(e,n,{blocked:s,upgrade:r,blocking:o,terminated:a}={}){const i=indexedDB.open(e,n),l=x(i);return r&&i.addEventListener("upgradeneeded",d=>{r(x(i.result),d.oldVersion,d.newVersion,x(i.transaction),d)}),s&&i.addEventListener("blocked",d=>s(d.oldVersion,d.newVersion,d)),l.then(d=>{a&&d.addEventListener("close",()=>a()),o&&d.addEventListener("versionchange",c=>o(c.oldVersion,c.newVersion,c))}).catch(()=>{}),l}const ge=["get","getKey","getAll","getAllKeys","count"],ve=["put","add","delete","clear"],I=new Map;function H(e,n){if(!(e instanceof IDBDatabase&&!(n in e)&&typeof n=="string"))return;if(I.get(n))return I.get(n);const s=n.replace(/FromIndex$/,""),r=n!==s,o=ve.includes(s);if(!(s in(r?IDBIndex:IDBObjectStore).prototype)||!(o||ge.includes(s)))return;const a=async function(i,...l){const d=this.transaction(i,o?"readwrite":"readonly");let c=d.store;return r&&(c=c.index(l.shift())),(await Promise.all([c[s](...l),o&&d.done]))[0]};return I.set(n,a),a}J(e=>({...e,get:(n,s,r)=>H(n,s)||e.get(n,s,r),has:(n,s)=>!!H(n,s)||e.has(n,s)}));const ye=["continue","continuePrimaryKey","advance"],K={},k=new WeakMap,Q=new WeakMap,we={get(e,n){if(!ye.includes(n))return e[n];let s=K[n];return s||(s=K[n]=function(...r){k.set(this,Q.get(this)[n](...r))}),s}};async function*pe(...e){let n=this;if(n instanceof IDBCursor||(n=await n.openCursor(...e)),!n)return;n=n;const s=new Proxy(n,we);for(Q.set(s,n),y.set(s,S(n));n;)yield s,n=await(k.get(s)||n.continue()),k.delete(s)}function U(e,n){return n===Symbol.asyncIterator&&P(e,[IDBIndex,IDBObjectStore,IDBCursor])||n==="iterate"&&P(e,[IDBIndex,IDBObjectStore])}J(e=>({...e,get(n,s,r){return U(n,s)?pe:e.get(n,s,r)},has(n,s){return U(n,s)||e.has(n,s)}}));const X=be("test",2,{upgrade(e){e.createObjectStore("savedPosts")}}),Fe=u.lazy(()=>B(()=>import("./AddToFeedDialog-4QsKJ5no.js"),__vite__mapDeps([0,1,2,3]),import.meta.url));async function De(e){await(await X).put("savedPosts",e,e.id)}async function Ie(e){await(await X).delete("savedPosts",e.id)}function Pe({post:e}){var O;const n=v(),{author:s,subreddit:r,subreddit_name_prefixed:o,crosspost_parent_list:a}=e,{val:i,favorites:l,blocked:d}=n,c=`/u/${s}`,E=w(`/user/${s}`,l),f=((O=a==null?void 0:a[0])==null?void 0:O.subreddit_name_prefixed)??"",h=o,Y=w(f,l),Z=w(h,l),[q,T]=u.useState(!1),[_,j]=u.useState(),[ee,M]=u.useState(!1),[ne,te]=u.useState(""),L=m=>{te(m),M(!0)},A=R(c)===R(o);return t.jsxs("div",{className:"inline",children:[t.jsxs(b,{children:[t.jsx(F,{className:"inline"})," ",c]}),f?t.jsxs(b,{children:[t.jsx(F,{className:"inline"})," ",f]}):null,A?null:t.jsxs(b,{children:[t.jsx(F,{className:"inline"})," ",h]}),t.jsxs("div",{className:"dropdown",children:[_?t.jsx(le,{error:_}):null,t.jsx(b,{className:"inline",children:t.jsx(re,{})}),t.jsxs("ul",{tabIndex:0,className:"dropdown-content menu bg-base-300 z-1 w-80 shadow-sm",children:[t.jsxs("li",{className:"menu-title",children:["User (",c,")"]}),!E&&t.jsx("li",{children:t.jsxs("button",{onClick:()=>n.addFavorite(`/user/${s}`),children:[t.jsx(p,{className:"inline"})," Favorite user"]})}),!E&&!d.includes(s)&&t.jsx("li",{children:t.jsxs("button",{onClick:()=>n.setBlocked(s),children:[t.jsx(ie,{className:"inline"})," Block user"]})}),t.jsx("li",{children:t.jsxs("button",{onClick:()=>L(`u_${s}`),children:[t.jsx(G,{className:"inline"})," Add user to feed"]})}),t.jsx("li",{children:t.jsxs("button",{onClick:()=>n.setDefaultPage(c),children:[t.jsx(W,{className:"inline"})," Set user as home"]})}),A?null:t.jsxs(t.Fragment,{children:[t.jsxs("li",{className:"menu-title",children:["Subreddit ",f]}),f&&t.jsx(t.Fragment,{children:!Y&&t.jsx("li",{children:t.jsxs("button",{onClick:()=>n.addFavorite(f),children:[t.jsx(p,{className:"inline"})," Favorite"," ",f]})})}),h!==c&&t.jsxs(t.Fragment,{children:[!Z&&t.jsx("li",{children:t.jsxs("button",{onClick:()=>n.addFavorite(h),children:[t.jsx(p,{className:"inline"})," Favorite"," ",h]})}),t.jsx("li",{children:t.jsxs("button",{onClick:()=>L(r),children:[t.jsx(G,{className:"inline"})," Add ",h," to feed"]})}),t.jsx("li",{children:t.jsxs("button",{onClick:()=>n.setDefaultPage(h),children:[t.jsx(W,{className:"inline"})," Set ",h," as home"]})})]})]}),t.jsx("li",{children:i==="savedposts"?t.jsxs("button",{onClick:()=>{(async()=>{try{j(void 0),await Ie(e),n.forceRerender()}catch(m){j(m),console.error(m)}})()},children:[t.jsx(z,{className:"inline"})," Remove from saved"]}):t.jsxs("button",{onClick:()=>{(async()=>{try{j(void 0),await De(e)}catch(m){j(m),console.error(m)}})(),T(!0),setTimeout(()=>{T(!1)},400)},children:[t.jsx(z,{className:"inline"})," ",q?"Saved!":"Save post"]})})]}),ee?t.jsx(u.Suspense,{fallback:null,children:t.jsx(Fe,{subreddit:ne,onClose:()=>{M(!1)}})}):null]})]})}function Ce({post:e}){return t.jsx("div",{children:t.jsx(Pe,{post:e})})}function Ne({post:e}){const{hideButtons:n}=v(),{author:s,subreddit_name_prefixed:r,title:o,permalink:a,url:i}=e;return t.jsxs("div",{children:[t.jsxs("h4",{className:"inline",children:[oe(o)," (",de(new Date(e.created*1e3),{addSuffix:!0}),") [",e.score," ",t.jsx(ce,{className:"inline"}),"]"]})," ","(",t.jsx(g,{href:`https://reddit.com/u/${s}`,target:"_blank",rel:"noreferrer",children:"user"}),") (",t.jsx(g,{href:i,target:"_blank",rel:"noreferrer",children:"url"}),") (",t.jsx(g,{href:`https://reddit.com/${r}`,target:"_blank",rel:"noreferrer",children:"subreddit"}),") (",t.jsx(g,{href:`https://reddit.com${a}`,target:"_blank",rel:"noreferrer",children:"comments"}),")",n?null:t.jsx(Ce,{post:e})]})}function Se({title:e,url:n}){const[s,r]=u.useState(!1);return t.jsx("img",{alt:e,loading:"lazy",onClick:()=>{r(!s)},className:s?"m-auto":"w-full max-h-[80vh] object-contain",src:n})}const ke=u.lazy(()=>B(()=>import("./RedGifsCard-BOdTUg3X.js"),__vite__mapDeps([4,1,2]),import.meta.url)),Be=u.lazy(()=>B(()=>import("./GalleryCard-B4CVEwzc.js"),__vite__mapDeps([5,1,2,6,3,7,8,9]),import.meta.url));function Ee(e){return!e.includes("redgifs")&&(e.endsWith(".jpg")||e.endsWith(".jpeg")||e.endsWith(".webp")||e.endsWith(".png")||e.endsWith(".gif")||e.endsWith(".webp"))}function Te({post:e}){const{title:n,url:s}=e;return t.jsxs("div",{children:[t.jsx(Ne,{post:e}),s.startsWith("https://www.reddit.com/gallery")?t.jsx(Be,{post:e}):s.includes("redgifs")?t.jsx(ke,{post:e}):Ee(s)?t.jsx(Se,{title:n,url:s}):t.jsxs("div",{children:["We do not know how to embed this post type yet!"," ",t.jsxs("a",{href:s,children:[s," ",n]})]})]})}function _e({totalFiltered:e}){const n=v(),{redGifsOnly:s}=n;return t.jsxs(t.Fragment,{children:[t.jsx("h1",{children:"Check your filters in the settings or this may just have been a page of comments if you are browsing a user page"}),s?t.jsxs("div",{children:["Note: RedGifs only is on.",t.jsx(ae,{onClick:()=>{n.setRedGifsOnly(!s)},children:"Turn off RedGifs only"})]}):null,t.jsx("div",{children:e?t.jsxs("div",{children:["Total posts filtered out (non-image posts, not matching filters, etc): ",e]}):null}),t.jsx("div",{children:"Note that we are not able to embed v.redd.it videos from e.g. popular SFW reddits"})]})}function We({posts:e,stats:n}){const{fullscreen:s}=v();return t.jsx("div",{className:"flex justify-center overflow-hidden",children:t.jsx("div",{className:s?"lg:w-11/12":"lg:w-1/2",children:t.jsx("div",{className:"flex flex-col space-y-20",children:e.length>0?e.map(r=>t.jsx(Te,{post:r},r.id)):n?t.jsx(_e,{totalPosts:n.totalPosts,commentTypeFiltered:n.commentTypeFiltered,urlTypeFiltered:n.urlTypeFiltered,gifFiltered:n.gifFiltered,redGifsOnlyFiltered:n.redGifsOnlyFiltered,noRedGifsFiltered:n.noRedGifsFiltered,pinnedFiltered:n.pinnedFiltered,blockedFiltered:n.blockedFiltered,remainingPosts:n.remainingPosts,totalFiltered:n.totalPosts-n.remainingPosts}):null})})})}function ze(){return t.jsx("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",style:{width:100,height:100},viewBox:"0 0 24 24",children:t.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})})}export{We as C,le as E,Se as I,ze as L,X as d};
//# sourceMappingURL=LoadingSpinner-ZwwLK73j.js.map
