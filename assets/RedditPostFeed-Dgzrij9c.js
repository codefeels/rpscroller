import{r as P,l as se,u as X,e as ne,m as re,j as h,B as ie,a as le,o as oe}from"./index-CtXPi8iy.js";import{w as ae,u as ce,a as de,c as fe,I as ue,b as _,i as C,s as he,d as pe,U as D,e as H,f as ge,m as me}from"./Sidebar-DmTG1qm_.js";import{C as ye,L as Y,E as Fe}from"./LoadingSpinner-jh6JD2mF.js";import"./BaseDialog-DMAPSbwp.js";import"./Link-DGsGiNCV.js";import"./formatDistanceToNowStrict-B7etE4jS.js";import"./en-US-DK8Z8mF7.js";const Re=()=>{},be=Re(),q=Object,K=e=>e===be,Se=e=>typeof e=="function",N=new WeakMap,U=(e,r)=>q.prototype.toString.call(e)===`[object ${r}]`;let Pe=0;const J=e=>{const r=typeof e,t=U(e,"Date"),p=U(e,"RegExp"),o=U(e,"Object");let s,a;if(q(e)===e&&!t&&!p){if(s=N.get(e),s)return s;if(s=++Pe+"~",N.set(e,s),Array.isArray(e)){for(s="@",a=0;a<e.length;a++)s+=J(e[a])+",";N.set(e,s)}if(o){s="#";const g=q.keys(e).sort();for(;!K(a=g.pop());)K(e[a])||(s+=a+":"+J(e[a])+",");N.set(e,s)}}else s=t?e.toJSON():r=="symbol"?e.toString():r=="string"?JSON.stringify(e):""+e;return s},je=e=>{if(Se(e))try{e=e()}catch{e=""}const r=e;return e=typeof e=="string"?e:(Array.isArray(e)?e.length:e)?J(e):"",[e,r]},Ee=e=>je(e?e(0,null):null)[0],B=Promise.resolve(),we=e=>(r,t,p)=>{const o=P.useRef(!1),{cache:s,initialSize:a=1,revalidateAll:g=!1,persistSize:y=!1,revalidateFirstPage:j=!0,revalidateOnMount:F=!1,parallel:f=!1}=p,[,,,n]=de.get(fe);let l;try{l=Ee(r),l&&(l=ue+l)}catch{}const[u,E,T]=_(s,l),z=P.useCallback(()=>C(u()._l)?a:u()._l,[s,l,a]);he.useSyncExternalStore(P.useCallback(i=>l?T(l,()=>{i()}):()=>{},[s,l]),z,z);const m=P.useCallback(()=>{const i=u()._l;return C(i)?a:i},[l,a]),O=P.useRef(m());pe(()=>{if(!o.current){o.current=!0;return}l&&E({_l:y?O.current:m()})},[l,s]);const A=F&&!o.current,R=e(l,async i=>{const v=u()._i,c=u()._r;E({_r:D});const b=[],L=m(),[$]=_(s,i),w=$().data,W=[];let M=null;for(let d=0;d<L;++d){const[G,k]=H(r(d,f?null:M));if(!G)break;const[Q,Z]=_(s,G);let S=Q().data;const ee=g||v||C(S)||j&&!d&&!C(w)||A||w&&!C(w[d])&&!p.compare(w[d],S);if(t&&(typeof c=="function"?c(S,k):ee)){const V=async()=>{if(!(G in n))S=await t(k);else{const te=n[G];delete n[G],S=await te}Z({data:S,_k:k}),b[d]=S};f?W.push(V):await V()}else b[d]=S;f||(M=S)}return f&&await Promise.all(W.map(d=>d())),E({_i:D}),b},p),x=P.useCallback(function(i,v){const c=typeof v=="boolean"?{revalidate:v}:v||{},b=c.revalidate!==!1;return l?(b&&(C(i)?E({_i:!0,_r:c.revalidate}):E({_i:!1,_r:c.revalidate})),arguments.length?R.mutate(i,{...c,revalidate:b}):R.mutate()):B},[l,s]),I=P.useCallback(i=>{if(!l)return B;const[,v]=_(s,l);let c;if(ge(i)?c=i(m()):typeof i=="number"&&(c=i),typeof c!="number")return B;v({_l:c}),O.current=c;const b=[],[L]=_(s,l);let $=null;for(let w=0;w<c;++w){const[W]=H(r(w,$)),[M]=_(s,W),d=W?M().data:D;if(C(d))return x(L().data);b.push(d),$=d}return x(b)},[l,s,x,m]);return{size:m(),setSize:I,mutate:x,get data(){return R.data},get error(){return R.error},get isValidating(){return R.isValidating},get isLoading(){return R.isLoading}}},xe=ae(ce,we);function ve(e,r){let t=e;const o={totalPosts:e.length,commentTypeFiltered:0,urlTypeFiltered:0,gifFiltered:0,redGifsOnlyFiltered:0,noRedGifsFiltered:0,pinnedFiltered:0,blockedFiltered:0,remainingPosts:0},s=t.filter(n=>!("comment_type"in n));o.commentTypeFiltered=t.length-s.length,t=s;const a=t.filter(({url:n})=>n.includes("redgifs")||n.endsWith(".jpg")||n.endsWith(".webp")||n.endsWith(".jpeg")||n.endsWith(".png")||n.endsWith(".gif")||n.endsWith(".webp")||n.startsWith("https://www.reddit.com/gallery"));o.urlTypeFiltered=t.length-a.length,t=a;const g=t.filter(n=>r.noGifs?!n.url.endsWith(".gif"):!0);o.gifFiltered=t.length-g.length,t=g;const y=t.filter(n=>r.redGifsOnly?n.url.includes("redgifs"):!0);o.redGifsOnlyFiltered=t.length-y.length,t=y;const j=t.filter(n=>r.noRedGifs?!n.url.includes("redgifs"):!0);o.noRedGifsFiltered=t.length-j.length,t=j;const F=t.filter(n=>r.skipPinned?!n.pinned:!0);o.pinnedFiltered=t.length-F.length,t=F;const f=t.filter(n=>!r.blocked.includes(n.author));return o.blockedFiltered=t.length-f.length,t=f,r.dedupe&&(t=se(t,n=>n.url)),o.remainingPosts=t.length,{filteredPosts:t,stats:o}}function Ce({data:e,setSize:r,size:t,isValidating:p,isLoading:o}){var x,I;const{noGifs:s,blocked:a,skipPinned:g,dedupe:y,noRedGifs:j,redGifsOnly:F}=X(),f=ne(),{isIntersecting:n,ref:l}=re({threshold:f?.5:.8}),u=P.useRef(!1),E=e.flatMap(i=>i.children).map(i=>i.data),T=o||t>0&&e[t-1]===void 0,m=(((x=e[0])==null?void 0:x.children.length)??0)===0||(((I=e.at(-1))==null?void 0:I.children.length)??0)<25,O=p&&e.length===t;P.useEffect(()=>{n&&!u.current&&!o&&!O&&!m&&(u.current=!0,setTimeout(()=>{r(t+1).then(()=>{u.current=!1}).catch(i=>{console.error(i)})},400))},[n,r,t,m,O,o]);const{filteredPosts:A,stats:R}=ve(E,{noGifs:s,blocked:a,skipPinned:g,dedupe:y,noRedGifs:j,redGifsOnly:F});return h.jsxs("div",{children:[h.jsx(ye,{posts:A,stats:R}),h.jsx("div",{ref:l,style:{height:400},className:"flex justify-center mt-10",children:T?h.jsx(Y,{}):m?"End of feed!":h.jsxs("div",{children:["(Loaded ",E.length," posts ",R.commentTypeFiltered," of those were comments) ... Scroll all the way down or"," ",h.jsx(ie,{onClick:()=>{!u.current&&!O&&(u.current=!0,setTimeout(()=>{r(t+1).then(()=>{u.current=!1}).catch(i=>{console.error(i)})},400))},children:"Click here"})," ","to load more"]})})]})}function Oe(e){return(r,t)=>t&&!t.after?null:r===0?`${e}${e.includes("?")?"&":"?"}limit=25`:`${e}${e.includes("?")?"&":"?"}after=${t==null?void 0:t.after}&limit=25`}function ze(){var f;const e=X(),{mode:r}=e,t=le(),p=(f=oe.get(r))==null?void 0:f.url,o=`https://www.reddit.com/${t.startsWith("/")?t.slice(1):t}${p??""}`,{data:s,size:a,setSize:g,error:y,isValidating:j,isLoading:F}=xe(Oe(o),async n=>(await me(n)).data);return h.jsx("div",{children:F?h.jsx("div",{className:"flex justify-center",children:h.jsx(Y,{})}):y?h.jsx(Fe,{error:y}):s?h.jsx(Ce,{data:s,setSize:g,size:a,isValidating:j,isLoading:F}):null})}export{ze as default};
//# sourceMappingURL=RedditPostFeed-Dgzrij9c.js.map
