import{r as E,R as It,u as re,a as oe,m as ie,j as J}from"./index-0H0E7AWI.js";import{L as zt,E as ae,C as ce}from"./CardList-CnvvVrAl.js";import"./Link-pslCgTli.js";import"./formatDistanceToNowStrict-DGPDrA_T.js";import"./en-US-Ckk-QizZ.js";var Ht={exports:{}},Kt={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ot=E;function ue(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var le=typeof Object.is=="function"?Object.is:ue,fe=ot.useState,de=ot.useEffect,Ee=ot.useLayoutEffect,he=ot.useDebugValue;function Re(t,e){var n=e(),i=fe({inst:{value:n,getSnapshot:e}}),s=i[0].inst,r=i[1];return Ee(function(){s.value=n,s.getSnapshot=e,wt(s)&&r({inst:s})},[t,n,e]),de(function(){return wt(s)&&r({inst:s}),t(function(){wt(s)&&r({inst:s})})},[t]),he(n),n}function wt(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!le(t,n)}catch{return!0}}function ge(t,e){return e()}var pe=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?ge:Re;Kt.useSyncExternalStore=ot.useSyncExternalStore!==void 0?ot.useSyncExternalStore:pe;Ht.exports=Kt;var Bt=Ht.exports;const X=()=>{},D=X(),_t=Object,c=t=>t===D,q=t=>typeof t=="function",Q=(t,e)=>({...t,...e}),me=t=>q(t.then),ht=new WeakMap;let ve=0;const ft=t=>{const e=typeof t,n=t&&t.constructor,i=n==Date;let s,r;if(_t(t)===t&&!i&&n!=RegExp){if(s=ht.get(t),s)return s;if(s=++ve+"~",ht.set(t,s),n==Array){for(s="@",r=0;r<t.length;r++)s+=ft(t[r])+",";ht.set(t,s)}if(n==_t){s="#";const f=_t.keys(t).sort();for(;!c(r=f.pop());)c(t[r])||(s+=r+":"+ft(t[r])+",");ht.set(t,s)}}else s=i?t.toJSON():e=="symbol"?t.toString():e=="string"?JSON.stringify(t):""+t;return s},H=new WeakMap,Tt={},Rt={},xt="undefined",pt=typeof window!=xt,bt=typeof document!=xt,Se=()=>pt&&typeof window.requestAnimationFrame!=xt,G=(t,e)=>{const n=H.get(t);return[()=>!c(e)&&t.get(e)||Tt,i=>{if(!c(e)){const s=t.get(e);e in Rt||(Rt[e]=s),n[5](e,Q(s,i),s||Tt)}},n[6],()=>!c(e)&&e in Rt?Rt[e]:!c(e)&&t.get(e)||Tt]};let Dt=!0;const we=()=>Dt,[At,Lt]=pt&&window.addEventListener?[window.addEventListener.bind(window),window.removeEventListener.bind(window)]:[X,X],_e=()=>{const t=bt&&document.visibilityState;return c(t)||t!=="hidden"},Te=t=>(bt&&document.addEventListener("visibilitychange",t),At("focus",t),()=>{bt&&document.removeEventListener("visibilitychange",t),Lt("focus",t)}),Ce=t=>{const e=()=>{Dt=!0,t()},n=()=>{Dt=!1};return At("online",e),At("offline",n),()=>{Lt("online",e),Lt("offline",n)}},Oe={isOnline:we,isVisible:_e},ye={initFocus:Te,initReconnect:Ce},Ut=!It.useId,dt=!pt||"Deno"in window,be=t=>Se()?window.requestAnimationFrame(t):setTimeout(t,1),gt=dt?E.useEffect:E.useLayoutEffect,Ct=typeof navigator<"u"&&navigator.connection,$t=!dt&&Ct&&(["slow-2g","2g"].includes(Ct.effectiveType)||Ct.saveData),it=t=>{if(q(t))try{t=t()}catch{t=""}const e=t;return t=typeof t=="string"?t:(Array.isArray(t)?t.length:t)?ft(t):"",[t,e]};let De=0;const Vt=()=>++De,Jt=0,Yt=1,Gt=2,Ae=3;var lt={__proto__:null,ERROR_REVALIDATE_EVENT:Ae,FOCUS_EVENT:Jt,MUTATE_EVENT:Gt,RECONNECT_EVENT:Yt};async function Xt(...t){const[e,n,i,s]=t,r=Q({populateCache:!0,throwOnError:!0},typeof s=="boolean"?{revalidate:s}:s||{});let f=r.populateCache;const S=r.rollbackOnError;let l=r.optimisticData;const C=_=>typeof S=="function"?S(_):S!==!1,w=r.throwOnError;if(q(n)){const _=n,a=[],O=e.keys();for(const g of O)!/^\$(inf|sub)\$/.test(g)&&_(e.get(g)._k)&&a.push(g);return Promise.all(a.map(R))}return R(n);async function R(_){const[a]=it(_);if(!a)return;const[O,g]=G(e,a),[et,o,P,U]=H.get(e),W=()=>{const V=et[a];return(q(r.revalidate)?r.revalidate(O().data,_):r.revalidate!==!1)&&(delete P[a],delete U[a],V&&V[0])?V[0](Gt).then(()=>O().data):O().data};if(t.length<3)return W();let h=i,d;const A=Vt();o[a]=[A,0];const u=!c(l),M=O(),p=M.data,L=M._c,$=c(L)?p:L;if(u&&(l=q(l)?l($,p):l,g({data:l,_c:$})),q(h))try{h=h($)}catch(V){d=V}if(h&&me(h))if(h=await h.catch(V=>{d=V}),A!==o[a][0]){if(d)throw d;return h}else d&&u&&C(d)&&(f=!0,g({data:$,_c:D}));if(f&&!d)if(q(f)){const V=f(h,$);g({data:V,error:D,_c:D})}else g({data:h,error:D,_c:D});if(o[a][1]=Vt(),Promise.resolve(W()).then(()=>{g({_c:D})}),d){if(w)throw d;return}return h}}const qt=(t,e)=>{for(const n in t)t[n][0]&&t[n][0](e)},Le=(t,e)=>{if(!H.has(t)){const n=Q(ye,e),i={},s=Xt.bind(D,t);let r=X;const f={},S=(w,R)=>{const _=f[w]||[];return f[w]=_,_.push(R),()=>_.splice(_.indexOf(R),1)},l=(w,R,_)=>{t.set(w,R);const a=f[w];if(a)for(const O of a)O(R,_)},C=()=>{if(!H.has(t)&&(H.set(t,[i,{},{},{},s,l,S]),!dt)){const w=n.initFocus(setTimeout.bind(D,qt.bind(D,i,Jt))),R=n.initReconnect(setTimeout.bind(D,qt.bind(D,i,Yt)));r=()=>{w&&w(),R&&R(),H.delete(t)}}};return C(),[t,s,C,r]}return[t,H.get(t)[4]]},Ve=(t,e,n,i,s)=>{const r=n.errorRetryCount,f=s.retryCount,S=~~((Math.random()+.5)*(1<<(f<8?f:8)))*n.errorRetryInterval;!c(r)&&f>r||setTimeout(i,S,s)},Ie=(t,e)=>ft(t)==ft(e),[Nt,xe]=Le(new Map),Ne=Q({onLoadingSlow:X,onSuccess:X,onError:X,onErrorRetry:Ve,onDiscarded:X,revalidateOnFocus:!0,revalidateOnReconnect:!0,revalidateIfStale:!0,shouldRetryOnError:!0,errorRetryInterval:$t?1e4:5e3,focusThrottleInterval:5*1e3,dedupingInterval:2*1e3,loadingTimeout:$t?5e3:3e3,compare:Ie,isPaused:()=>!1,cache:Nt,mutate:xe,fallback:{}},Oe),Fe=(t,e)=>{const n=Q(t,e);if(e){const{use:i,fallback:s}=t,{use:r,fallback:f}=e;i&&r&&(n.use=i.concat(r)),s&&f&&(n.fallback=Q(s,f))}return n},Pe=E.createContext({}),Qt="$inf$",Zt=pt&&window.__SWR_DEVTOOLS_USE__,Me=Zt?window.__SWR_DEVTOOLS_USE__:[],We=()=>{Zt&&(window.__SWR_DEVTOOLS_REACT__=It)},te=t=>q(t[1])?[t[0],t[1],t[2]||{}]:[t[0],null,(t[1]===null?t[2]:t[1])||{}],je=()=>Q(Ne,E.useContext(Pe)),ze=t=>(e,n,i)=>t(e,n&&((...r)=>{const[f]=it(e),[,,,S]=H.get(Nt);if(f.startsWith(Qt))return n(...r);const l=S[f];return c(l)?n(...r):(delete S[f],l)}),i),Ue=Me.concat(ze),$e=t=>function(...n){const i=je(),[s,r,f]=te(n),S=Fe(i,f);let l=t;const{use:C}=S,w=(C||[]).concat(Ue);for(let R=w.length;R--;)l=w[R](l);return l(s,r||S.fetcher||null,S)},qe=(t,e,n)=>{const i=e[t]||(e[t]=[]);return i.push(n),()=>{const s=i.indexOf(n);s>=0&&(i[s]=i[i.length-1],i.pop())}},ke=(t,e)=>(...n)=>{const[i,s,r]=te(n),f=(r.use||[]).concat(e);return t(i,s,{...r,use:f})};We();const kt=It.use||(t=>{if(t.status==="pending")throw t;if(t.status==="fulfilled")return t.value;throw t.status==="rejected"?t.reason:(t.status="pending",t.then(e=>{t.status="fulfilled",t.value=e},e=>{t.status="rejected",t.reason=e}),t)}),Ot={dedupe:!0},He=(t,e,n)=>{const{cache:i,compare:s,suspense:r,fallbackData:f,revalidateOnMount:S,revalidateIfStale:l,refreshInterval:C,refreshWhenHidden:w,refreshWhenOffline:R,keepPreviousData:_}=n,[a,O,g,et]=H.get(i),[o,P]=it(t),U=E.useRef(!1),W=E.useRef(!1),h=E.useRef(o),d=E.useRef(e),A=E.useRef(n),u=()=>A.current,M=()=>u().isVisible()&&u().isOnline(),[p,L,$,V]=G(i,o),N=E.useRef({}).current,Z=c(f)?n.fallback[o]:f,tt=(m,v)=>{for(const x in N){const T=x;if(T==="data"){if(!s(m[T],v[T])&&(!c(m[T])||!s(ct,v[T])))return!1}else if(v[T]!==m[T])return!1}return!0},y=E.useMemo(()=>{const m=!o||!e?!1:c(S)?u().isPaused()||r?!1:c(l)?!0:l:S,v=F=>{const K=Q(F);return delete K._k,m?{isValidating:!0,isLoading:!0,...K}:K},x=p(),T=V(),k=v(x),rt=x===T?k:v(T);let b=k;return[()=>{const F=v(p());return tt(F,b)?(b.data=F.data,b.isLoading=F.isLoading,b.isValidating=F.isValidating,b.error=F.error,b):(b=F,F)},()=>rt]},[i,o]),j=Bt.useSyncExternalStore(E.useCallback(m=>$(o,(v,x)=>{tt(x,v)||m()}),[i,o]),y[0],y[1]),nt=!U.current,mt=a[o]&&a[o].length>0,Y=j.data,I=c(Y)?Z:Y,st=j.error,at=E.useRef(I),ct=_?c(Y)?at.current:Y:I,Et=mt&&!c(st)?!1:nt&&!c(S)?S:u().isPaused()?!1:r?c(I)?!1:l:c(I)||l,Ft=!!(o&&e&&nt&&Et),ee=c(j.isValidating)?Ft:j.isValidating,ne=c(j.isLoading)?Ft:j.isLoading,ut=E.useCallback(async m=>{const v=d.current;if(!o||!v||W.current||u().isPaused())return!1;let x,T,k=!0;const rt=m||{},b=!g[o]||!rt.dedupe,F=()=>Ut?!W.current&&o===h.current&&U.current:o===h.current,K={isValidating:!1,isLoading:!1},Mt=()=>{L(K)},Wt=()=>{const z=g[o];z&&z[1]===T&&delete g[o]},jt={isValidating:!0};c(p().data)&&(jt.isLoading=!0);try{if(b&&(L(jt),n.loadingTimeout&&c(p().data)&&setTimeout(()=>{k&&F()&&u().onLoadingSlow(o,n)},n.loadingTimeout),g[o]=[v(P),Vt()]),[x,T]=g[o],x=await x,b&&setTimeout(Wt,n.dedupingInterval),!g[o]||g[o][1]!==T)return b&&F()&&u().onDiscarded(o),!1;K.error=D;const z=O[o];if(!c(z)&&(T<=z[0]||T<=z[1]||z[1]===0))return Mt(),b&&F()&&u().onDiscarded(o),!1;const B=p().data;K.data=s(B,x)?B:x,b&&F()&&u().onSuccess(x,o,n)}catch(z){Wt();const B=u(),{shouldRetryOnError:vt}=B;B.isPaused()||(K.error=z,b&&F()&&(B.onError(z,o,B),(vt===!0||q(vt)&&vt(z))&&(!u().revalidateOnFocus||!u().revalidateOnReconnect||M())&&B.onErrorRetry(z,o,B,se=>{const St=a[o];St&&St[0]&&St[0](lt.ERROR_REVALIDATE_EVENT,se)},{retryCount:(rt.retryCount||0)+1,dedupe:!0})))}return k=!1,Mt(),!0},[o,i]),Pt=E.useCallback((...m)=>Xt(i,h.current,...m),[]);if(gt(()=>{d.current=e,A.current=n,c(Y)||(at.current=Y)}),gt(()=>{if(!o)return;const m=ut.bind(D,Ot);let v=0;const T=qe(o,a,(k,rt={})=>{if(k==lt.FOCUS_EVENT){const b=Date.now();u().revalidateOnFocus&&b>v&&M()&&(v=b+u().focusThrottleInterval,m())}else if(k==lt.RECONNECT_EVENT)u().revalidateOnReconnect&&M()&&m();else{if(k==lt.MUTATE_EVENT)return ut();if(k==lt.ERROR_REVALIDATE_EVENT)return ut(rt)}});return W.current=!1,h.current=o,U.current=!0,L({_k:P}),Et&&(c(I)||dt?m():be(m)),()=>{W.current=!0,T()}},[o]),gt(()=>{let m;function v(){const T=q(C)?C(p().data):C;T&&m!==-1&&(m=setTimeout(x,T))}function x(){!p().error&&(w||u().isVisible())&&(R||u().isOnline())?ut(Ot).then(v):v()}return v(),()=>{m&&(clearTimeout(m),m=-1)}},[C,w,R,o]),E.useDebugValue(ct),r&&c(I)&&o){if(!Ut&&dt)throw new Error("Fallback data is required when using suspense in SSR.");d.current=e,A.current=n,W.current=!1;const m=et[o];if(!c(m)){const v=Pt(m);kt(v)}if(c(st)){const v=ut(Ot);c(ct)||(v.status="fulfilled",v.value=!0),kt(v)}else throw st}return{mutate:Pt,get data(){return N.data=!0,ct},get error(){return N.error=!0,st},get isValidating(){return N.isValidating=!0,ee},get isLoading(){return N.isLoading=!0,ne}}},Ke=$e(He),Be=t=>it(t?t(0,null):null)[0],yt=Promise.resolve(),Je=t=>(e,n,i)=>{const s=E.useRef(!1),{cache:r,initialSize:f=1,revalidateAll:S=!1,persistSize:l=!1,revalidateFirstPage:C=!0,revalidateOnMount:w=!1,parallel:R=!1}=i,[,,,_]=H.get(Nt);let a;try{a=Be(e),a&&(a=Qt+a)}catch{}const[O,g,et]=G(r,a),o=E.useCallback(()=>c(O()._l)?f:O()._l,[r,a,f]);Bt.useSyncExternalStore(E.useCallback(u=>a?et(a,()=>{u()}):()=>{},[r,a]),o,o);const P=E.useCallback(()=>{const u=O()._l;return c(u)?f:u},[a,f]),U=E.useRef(P());gt(()=>{if(!s.current){s.current=!0;return}a&&g({_l:l?U.current:P()})},[a,r]);const W=w&&!s.current,h=t(a,async u=>{const M=O()._i,p=O()._r;g({_r:D});const L=[],$=P(),[V]=G(r,u),N=V().data,Z=[];let tt=null;for(let y=0;y<$;++y){const[j,nt]=it(e(y,R?null:tt));if(!j)break;const[mt,Y]=G(r,j);let I=mt().data;const st=S||M||c(I)||C&&!y&&!c(N)||W||N&&!c(N[y])&&!i.compare(N[y],I);if(n&&(typeof p=="function"?p(I,nt):st)){const at=async()=>{if(!(j in _))I=await n(nt);else{const Et=_[j];delete _[j],I=await Et}Y({data:I,_k:nt}),L[y]=I};R?Z.push(at):await at()}else L[y]=I;R||(tt=I)}return R&&await Promise.all(Z.map(y=>y())),g({_i:D}),L},i),d=E.useCallback(function(u,M){const p=typeof M=="boolean"?{revalidate:M}:M||{},L=p.revalidate!==!1;return a?(L&&(c(u)?g({_i:!0,_r:p.revalidate}):g({_i:!1,_r:p.revalidate})),arguments.length?h.mutate(u,{...p,revalidate:L}):h.mutate()):yt},[a,r]),A=E.useCallback(u=>{if(!a)return yt;const[,M]=G(r,a);let p;if(q(u)?p=u(P()):typeof u=="number"&&(p=u),typeof p!="number")return yt;M({_l:p}),U.current=p;const L=[],[$]=G(r,a);let V=null;for(let N=0;N<p;++N){const[Z]=it(e(N,V)),[tt]=G(r,Z),y=Z?tt().data:D;if(c(y))return d($().data);L.push(y),V=y}return d(L)},[a,r,d,P]);return{size:P(),setSize:A,mutate:d,get data(){return h.data},get error(){return h.error},get isValidating(){return h.isValidating},get isLoading(){return h.isLoading}}},Ye=ke(Ke,Je),Ge=t=>(e,n)=>n&&!n.after?null:e===0?`${t}${t.includes("?")?"&":"?"}limit=25`:`${t}${t.includes("?")?"&":"?"}after=${n==null?void 0:n.after}&limit=25`;function nn(){var U,W,h;const t=re(),{mode:e,val:n}=t,{isIntersecting:i,ref:s}=oe({threshold:.9});E.useEffect(()=>{function d(A){A.state&&t.setVal(A.state.val)}return window.addEventListener("popstate",d),()=>{window.removeEventListener("popstate",d)}},[t]);const r=E.useRef(!1),f=(U=ie.get(e))==null?void 0:U.url,S=`https://www.reddit.com/${n.startsWith("/")?n.slice(1):n}${f??""}`,{data:l,size:C,setSize:w,error:R,isValidating:_,isLoading:a}=Ye(Ge(S),async d=>{const A=await fetch(d);if(!A.ok)throw new Error(`HTTP ${A.status} fetching ${d} ${await A.text()}`);return(await A.json()).data}),O=l==null?void 0:l.flatMap(d=>d.children).map(d=>d.data),g=a||C>0&&(l==null?void 0:l[C-1])===void 0,o=(((W=l==null?void 0:l[0])==null?void 0:W.children.length)??0)===0||(((h=l==null?void 0:l.at(-1))==null?void 0:h.children.length)??0)<25,P=_&&l&&l.length===C;return E.useEffect(()=>{i&&!r.current&&!a&&!P&&!o&&(r.current=!0,setTimeout(()=>{w(C+1).then(()=>{r.current=!1}).catch(d=>{console.error(d)})},400))},[i,w,C,o,P,a]),J.jsx("div",{children:a?J.jsx("div",{className:"flex justify-center",children:J.jsx(zt,{})}):R?J.jsx(ae,{error:R}):O?J.jsxs(J.Fragment,{children:[J.jsx(ce,{posts:O}),J.jsx("div",{ref:s,style:{height:400},className:"flex justify-center mt-10",children:g?J.jsx(zt,{}):o?"End of feed!":"Scroll all the way down to load more..."})]}):null})}export{nn as default};
//# sourceMappingURL=RedditPostFeed-DaaIMXxP.js.map
