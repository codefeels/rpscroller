const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./AddToFeedDialog-4_AoQxwS.js","./index-DSVefJmr.js","./index-Dg3Z-6lJ.css","./BaseDialog-C3WvXZjo.js","./RedGifsCard-zmAZbsgK.js","./GalleryCard-CcZCvtqH.js","./Sidebar-CtHrPZlm.js","./Link-BES5aBpZ.js","./formatDistanceToNowStrict-B7etE4jS.js","./en-US-DK8Z8mF7.js"])))=>i.map(i=>d[i]);
import{j as s,u as v,o as S,r as f,L as T,B as m,p as N,_ as C,q as I,M as ee,s as te,t as ne}from"./index-DSVefJmr.js";import{g as z,B as se}from"./Sidebar-CtHrPZlm.js";import{b as X}from"./BaseDialog-C3WvXZjo.js";import{L as k}from"./Link-BES5aBpZ.js";import{f as re}from"./formatDistanceToNowStrict-B7etE4jS.js";function ie({error:e}){return s.jsxs("div",{className:"text-red-600 m-20",children:[s.jsx("div",{children:`${e}`}),s.jsxs("div",{children:[`${e}`=="TypeError: NetworkError when attempting to fetch resource."?"If you are on firefox then you can disable 'Enhanced Tracking Protection' (at your own risk) to fix this error":""," "]})]})}const L=(e,t)=>t.some(n=>e instanceof n);let K,U;function oe(){return K||(K=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function ae(){return U||(U=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const M=new WeakMap,P=new WeakMap,_=new WeakMap;function de(e){const t=new Promise((n,i)=>{const d=()=>{e.removeEventListener("success",c),e.removeEventListener("error",a)},c=()=>{n(g(e.result)),d()},a=()=>{i(e.error),d()};e.addEventListener("success",c),e.addEventListener("error",a)});return _.set(t,e),t}function ce(e){if(M.has(e))return;const t=new Promise((n,i)=>{const d=()=>{e.removeEventListener("complete",c),e.removeEventListener("error",a),e.removeEventListener("abort",a)},c=()=>{n(),d()},a=()=>{i(e.error||new DOMException("AbortError","AbortError")),d()};e.addEventListener("complete",c),e.addEventListener("error",a),e.addEventListener("abort",a)});M.set(e,t)}let O={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return M.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return g(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function Y(e){O=e(O)}function le(e){return ae().includes(e)?function(...t){return e.apply(W(this),t),g(this.request)}:function(...t){return g(e.apply(W(this),t))}}function ue(e){return typeof e=="function"?le(e):(e instanceof IDBTransaction&&ce(e),L(e,oe())?new Proxy(e,O):e)}function g(e){if(e instanceof IDBRequest)return de(e);if(P.has(e))return P.get(e);const t=ue(e);return t!==e&&(P.set(e,t),_.set(t,e)),t}const W=e=>_.get(e);function fe(e,t,{blocked:n,upgrade:i,blocking:d,terminated:c}={}){const a=indexedDB.open(e,t),l=g(a);return i&&a.addEventListener("upgradeneeded",r=>{i(g(a.result),r.oldVersion,r.newVersion,g(a.transaction),r)}),n&&a.addEventListener("blocked",r=>n(r.oldVersion,r.newVersion,r)),l.then(r=>{c&&r.addEventListener("close",()=>c()),d&&r.addEventListener("versionchange",u=>d(u.oldVersion,u.newVersion,u))}).catch(()=>{}),l}const he=["get","getKey","getAll","getAllKeys","count"],me=["put","add","delete","clear"],E=new Map;function H(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(E.get(t))return E.get(t);const n=t.replace(/FromIndex$/,""),i=t!==n,d=me.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!(d||he.includes(n)))return;const c=async function(a,...l){const r=this.transaction(a,d?"readwrite":"readonly");let u=r.store;return i&&(u=u.index(l.shift())),(await Promise.all([u[n](...l),d&&r.done]))[0]};return E.set(t,c),c}Y(e=>({...e,get:(t,n,i)=>H(t,n)||e.get(t,n,i),has:(t,n)=>!!H(t,n)||e.has(t,n)}));const xe=["continue","continuePrimaryKey","advance"],J={},A=new WeakMap,Z=new WeakMap,ge={get(e,t){if(!xe.includes(t))return e[t];let n=J[t];return n||(n=J[t]=function(...i){A.set(this,Z.get(this)[t](...i))}),n}};async function*je(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;t=t;const n=new Proxy(t,ge);for(Z.set(n,t),_.set(n,W(t));t;)yield n,t=await(A.get(n)||t.continue()),A.delete(n)}function Q(e,t){return t===Symbol.asyncIterator&&L(e,[IDBIndex,IDBObjectStore,IDBCursor])||t==="iterate"&&L(e,[IDBIndex,IDBObjectStore])}Y(e=>({...e,get(t,n,i){return Q(t,n)?je:e.get(t,n,i)},has(t,n){return Q(t,n)||e.has(t,n)}}));const q=fe("test",2,{upgrade(e){e.createObjectStore("savedPosts")}}),ye=f.lazy(()=>C(()=>import("./AddToFeedDialog-4_AoQxwS.js"),__vite__mapDeps([0,1,2,3]),import.meta.url));async function pe(e){await(await q).put("savedPosts",e,e.id)}async function we(e){await(await q).delete("savedPosts",e.id)}function ve({post:e}){var w;const t=v(),{author:n,subreddit:i,subreddit_name_prefixed:d,crosspost_parent_list:c}=e,{val:a}=t,l=((w=c==null?void 0:c[0])==null?void 0:w.subreddit_name_prefixed)??"",r=d,u=S(d,t.favorites),b=S(d,t.favorites),[B,j]=f.useState(!1),[y,x]=f.useState(),[D,p]=f.useState(!1),F=`/u/${n}`;return s.jsxs("div",{children:[y?s.jsx(ie,{error:y}):null,l?s.jsxs(s.Fragment,{children:[s.jsx(T,{to:l,children:s.jsxs(m,{children:["Browse ",l]})}),u?null:s.jsxs(m,{onClick:()=>{t.addFavorite(l)},children:[s.jsx(N,{className:"inline"})," ",l]})]}):null,r===F?null:s.jsxs(s.Fragment,{children:[s.jsx(T,{to:r,children:s.jsxs(m,{children:["Browse ",r]})}),b?null:s.jsxs(m,{onClick:()=>{t.addFavorite(r)},children:[s.jsx(N,{className:"inline"})," ",r]})]}),a==="savedposts"?s.jsxs(m,{onClick:()=>{(async()=>{try{x(void 0),await we(e),t.forceRerender()}catch(h){x(h),console.error(h)}})()},children:[s.jsx(z,{className:"inline"})," Remove from saved"]}):s.jsxs(m,{onClick:()=>{(async()=>{try{x(void 0),await pe(e)}catch(h){x(h),console.error(h)}})(),j(!0),setTimeout(()=>{j(!1)},400)},children:[s.jsx(z,{className:"inline"})," ",B?"Saved!":"Save post"]}),s.jsxs(m,{onClick:()=>{p(!0)},children:[s.jsx(X,{className:"inline"})," Add ",d," to feed"]}),D?s.jsx(f.Suspense,{fallback:null,children:s.jsx(ye,{subreddit:i,onClose:()=>{p(!1)}})}):null]})}const be=f.lazy(()=>C(()=>import("./AddToFeedDialog-4_AoQxwS.js"),__vite__mapDeps([0,1,2,3]),import.meta.url));function Be({post:e}){const t=v(),{author:n}=e,{favorites:i,blocked:d}=t,[c,a]=f.useState(!1),l=S(`/user/${n}`,i),r=`/u/${n}`;return s.jsxs("div",{children:[s.jsx(T,{to:`/user/${n}`,children:s.jsxs(I,{children:["Browse ",`/u/${n}`]})}),l?null:s.jsxs(I,{onClick:()=>{t.addFavorite(`/user/${n}`)},children:[s.jsx(N,{className:"inline"})," ",r]}),l||d.includes(n)?null:s.jsxs(I,{onClick:()=>{t.setBlocked(n)},children:[s.jsx(ee,{className:"inline"})," Block ",r]}),s.jsxs(I,{onClick:()=>{a(!0)},children:[s.jsx(X,{className:"inline"})," Add ",r," to feed"]}),c?s.jsx(f.Suspense,{fallback:null,children:s.jsx(be,{subreddit:`u_${n}`,onClose:()=>{a(!1)}})}):null]})}function De({post:e}){const{subreddit_name_prefixed:t,author:n}=e,i=`u/${n}`;return s.jsxs("div",{children:[s.jsx(Be,{post:e}),i===t?null:s.jsx(ve,{post:e})]})}function Fe({post:e}){const{hideButtons:t}=v(),{author:n,subreddit_name_prefixed:i,title:d,permalink:c,url:a}=e;return s.jsxs("div",{children:[s.jsxs("h4",{className:"inline",children:[te(d)," (",re(new Date(e.created*1e3),{addSuffix:!0}),") [",e.score," ",s.jsx(se,{className:"inline"}),"]"]})," ","(",s.jsx(k,{href:`https://reddit.com/u/${n}`,target:"_blank",rel:"noreferrer",children:"user"}),") (",s.jsx(k,{href:a,target:"_blank",rel:"noreferrer",children:"url"}),") (",s.jsx(k,{href:`https://reddit.com/${i}`,target:"_blank",rel:"noreferrer",children:"subreddit"}),") (",s.jsx(k,{href:`https://reddit.com${c}`,target:"_blank",rel:"noreferrer",children:"comments"}),")",t?null:s.jsx(De,{post:e})]})}function Ie({title:e,url:t}){const[n,i]=f.useState(!1);return s.jsx("img",{alt:e,loading:"lazy",onClick:()=>{i(!n)},className:n?"m-auto":"w-full max-h-[80vh] object-contain",src:t})}const ke=f.lazy(()=>C(()=>import("./RedGifsCard-zmAZbsgK.js"),__vite__mapDeps([4,1,2]),import.meta.url)),Ce=f.lazy(()=>C(()=>import("./GalleryCard-CcZCvtqH.js"),__vite__mapDeps([5,1,2,6,3,7,8,9]),import.meta.url));function _e(e){return!e.includes("redgifs")&&(e.endsWith(".jpg")||e.endsWith(".jpeg")||e.endsWith(".webp")||e.endsWith(".png")||e.endsWith(".gif")||e.endsWith(".webp"))}function Pe({post:e}){const{title:t,url:n}=e;return s.jsxs("div",{children:[s.jsx(Fe,{post:e}),n.startsWith("https://www.reddit.com/gallery")?s.jsx(Ce,{post:e}):n.includes("redgifs")?s.jsx(ke,{post:e}):_e(n)?s.jsx(Ie,{title:t,url:n}):s.jsxs("div",{children:["We do not know how to embed this post type yet!"," ",s.jsxs("a",{href:n,children:[n," ",t]})]})]})}function Ee({totalFiltered:e}){const t=v(),{redGifsOnly:n}=t;return s.jsxs(s.Fragment,{children:[s.jsx("h1",{children:"No results on this page, check your filters in the settings or this may just have been a page of comments if you are browsing a user page"}),n?s.jsxs("div",{children:["Note: RedGifs only is on.",s.jsx(m,{onClick:()=>{t.setRedGifsOnly(!n)},children:"Turn off RedGifs only"})]}):null,s.jsx("div",{children:e?s.jsxs("div",{children:["Total posts filtered out (non-image posts, not matching filters, etc): ",e]}):null})]})}function Oe({posts:e}){const{noGifs:t,blocked:n,skipPinned:i,dedupe:d,fullscreen:c,noRedGifs:a,redGifsOnly:l}=v();let r=e;const u=e.length;let b=0,B=0,j=0,y=0,x=0,D=0,p=0;const F=r.filter(o=>!("comment_type"in o));b=r.length-F.length,r=F;const w=r.filter(({url:o})=>o.includes("redgifs")||o.endsWith(".jpg")||o.endsWith(".webp")||o.endsWith(".jpeg")||o.endsWith(".png")||o.endsWith(".gif")||o.endsWith(".webp")||o.startsWith("https://www.reddit.com/gallery"));B=r.length-w.length,r=w;const h=r.filter(o=>t?!o.url.endsWith(".gif"):!0);j=r.length-h.length,r=h;const R=r.filter(o=>l?o.url.includes("redgifs"):!0);y=r.length-R.length,r=R;const $=r.filter(o=>a?!o.url.includes("redgifs"):!0);x=r.length-$.length,r=$;const G=r.filter(o=>i?!o.pinned:!0);D=r.length-G.length,r=G;const V=r.filter(o=>!n.includes(o.author));return p=r.length-V.length,r=V,d&&(r=ne(r,o=>o.url)),s.jsx("div",{className:"flex justify-center overflow-hidden",children:s.jsx("div",{className:c?"lg:w-11/12":"lg:w-1/2",children:s.jsx("div",{className:"flex flex-col space-y-20",children:r.length>0?r.map(o=>s.jsx(Pe,{post:o},o.id)):s.jsx(Ee,{totalPosts:u,commentTypeFiltered:b,urlTypeFiltered:B,gifFiltered:j,redGifsOnlyFiltered:y,noRedGifsFiltered:x,pinnedFiltered:D,blockedFiltered:p,remainingPosts:r.length,totalFiltered:u-r.length})})})})}function We(){return s.jsx("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",style:{width:100,height:100},viewBox:"0 0 24 24",children:s.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})})}export{Oe as C,ie as E,Ie as I,We as L,q as d};
//# sourceMappingURL=LoadingSpinner-BHaij4cp.js.map
