const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./AddToFeedDialog-DLGiRTD1.js","./index-Bz7-O_C8.js","./index-Dg3Z-6lJ.css","./BaseDialog-Bnk5YqMW.js","./RedGifsCard-Cdet2OtZ.js","./GalleryCard-BlufFIE_.js","./Sidebar-CO_pDxL4.js","./Link-BB0uYDRy.js","./formatDistanceToNowStrict-B7etE4jS.js","./en-US-DK8Z8mF7.js"])))=>i.map(i=>d[i]);
import{j as s,u as x,o as D,r as u,B as f,p as B,_ as y,q as g,M as J,s as Q,t as X}from"./index-Bz7-O_C8.js";import{g as T,B as Y}from"./Sidebar-CO_pDxL4.js";import{b as R}from"./BaseDialog-Bnk5YqMW.js";import{L as w}from"./Link-BB0uYDRy.js";import{f as Z}from"./formatDistanceToNowStrict-B7etE4jS.js";function q({error:e}){return s.jsxs("div",{className:"text-red-600 m-20",children:[s.jsx("div",{children:`${e}`}),s.jsxs("div",{children:[`${e}`=="TypeError: NetworkError when attempting to fetch resource."?"If you are on firefox then you can disable 'Enhanced Tracking Protection' (at your own risk) to fix this error":""," "]})]})}const C=(e,t)=>t.some(n=>e instanceof n);let L,M;function ee(){return L||(L=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function te(){return M||(M=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const I=new WeakMap,v=new WeakMap,p=new WeakMap;function ne(e){const t=new Promise((n,o)=>{const c=()=>{e.removeEventListener("success",d),e.removeEventListener("error",a)},d=()=>{n(h(e.result)),c()},a=()=>{o(e.error),c()};e.addEventListener("success",d),e.addEventListener("error",a)});return p.set(t,e),t}function se(e){if(I.has(e))return;const t=new Promise((n,o)=>{const c=()=>{e.removeEventListener("complete",d),e.removeEventListener("error",a),e.removeEventListener("abort",a)},d=()=>{n(),c()},a=()=>{o(e.error||new DOMException("AbortError","AbortError")),c()};e.addEventListener("complete",d),e.addEventListener("error",a),e.addEventListener("abort",a)});I.set(e,t)}let k={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return I.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return h(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function V(e){k=e(k)}function re(e){return te().includes(e)?function(...t){return e.apply(_(this),t),h(this.request)}:function(...t){return h(e.apply(_(this),t))}}function ie(e){return typeof e=="function"?re(e):(e instanceof IDBTransaction&&se(e),C(e,ee())?new Proxy(e,k):e)}function h(e){if(e instanceof IDBRequest)return ne(e);if(v.has(e))return v.get(e);const t=ie(e);return t!==e&&(v.set(e,t),p.set(t,e)),t}const _=e=>p.get(e);function oe(e,t,{blocked:n,upgrade:o,blocking:c,terminated:d}={}){const a=indexedDB.open(e,t),l=h(a);return o&&a.addEventListener("upgradeneeded",i=>{o(h(a.result),i.oldVersion,i.newVersion,h(a.transaction),i)}),n&&a.addEventListener("blocked",i=>n(i.oldVersion,i.newVersion,i)),l.then(i=>{d&&i.addEventListener("close",()=>d()),c&&i.addEventListener("versionchange",r=>c(r.oldVersion,r.newVersion,r))}).catch(()=>{}),l}const ae=["get","getKey","getAll","getAllKeys","count"],ce=["put","add","delete","clear"],b=new Map;function W(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(b.get(t))return b.get(t);const n=t.replace(/FromIndex$/,""),o=t!==n,c=ce.includes(n);if(!(n in(o?IDBIndex:IDBObjectStore).prototype)||!(c||ae.includes(n)))return;const d=async function(a,...l){const i=this.transaction(a,c?"readwrite":"readonly");let r=i.store;return o&&(r=r.index(l.shift())),(await Promise.all([r[n](...l),c&&i.done]))[0]};return b.set(t,d),d}V(e=>({...e,get:(t,n,o)=>W(t,n)||e.get(t,n,o),has:(t,n)=>!!W(t,n)||e.has(t,n)}));const de=["continue","continuePrimaryKey","advance"],O={},E=new WeakMap,$=new WeakMap,le={get(e,t){if(!de.includes(t))return e[t];let n=O[t];return n||(n=O[t]=function(...o){E.set(this,$.get(this)[t](...o))}),n}};async function*ue(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;t=t;const n=new Proxy(t,le);for($.set(n,t),p.set(n,_(t));t;)yield n,t=await(E.get(n)||t.continue()),E.delete(n)}function A(e,t){return t===Symbol.asyncIterator&&C(e,[IDBIndex,IDBObjectStore,IDBCursor])||t==="iterate"&&C(e,[IDBIndex,IDBObjectStore])}V(e=>({...e,get(t,n,o){return A(t,n)?ue:e.get(t,n,o)},has(t,n){return A(t,n)||e.has(t,n)}}));const z=oe("test",2,{upgrade(e){e.createObjectStore("savedPosts")}}),fe=u.lazy(()=>y(()=>import("./AddToFeedDialog-DLGiRTD1.js"),__vite__mapDeps([0,1,2,3]),import.meta.url));async function he(e){await(await z).put("savedPosts",e,e.id)}async function me(e){await(await z).delete("savedPosts",e.id)}function xe({post:e}){var N;const t=x(),{author:n,subreddit:o,subreddit_name_prefixed:c,crosspost_parent_list:d}=e,{val:a}=t,l=((N=d==null?void 0:d[0])==null?void 0:N.subreddit_name_prefixed)??"",i=c,r=D(c,t.favorites),G=D(c,t.favorites),[K,P]=u.useState(!1),[S,j]=u.useState(),[U,F]=u.useState(!1),H=`/u/${n}`;return s.jsxs("div",{children:[S?s.jsx(q,{error:S}):null,l?s.jsxs(s.Fragment,{children:[s.jsxs(f,{onClick:()=>{t.setVal(l)},children:["Browse ",l]}),r?null:s.jsxs(f,{onClick:()=>{t.addFavorite(l)},children:[s.jsx(B,{className:"inline"})," ",l]})]}):null,i===H?null:s.jsxs(s.Fragment,{children:[s.jsxs(f,{onClick:()=>{t.setVal(i)},children:["Browse ",i]}),G?null:s.jsxs(f,{onClick:()=>{t.addFavorite(i)},children:[s.jsx(B,{className:"inline"})," ",i]})]}),a==="savedposts"?s.jsxs(f,{onClick:()=>{(async()=>{try{j(void 0),await me(e),t.forceRerender()}catch(m){j(m),console.error(m)}})()},children:[s.jsx(T,{className:"inline"})," Remove from saved"]}):s.jsxs(f,{onClick:()=>{(async()=>{try{j(void 0),await he(e)}catch(m){j(m),console.error(m)}})(),P(!0),setTimeout(()=>{P(!1)},400)},children:[s.jsx(T,{className:"inline"})," ",K?"Saved!":"Save post"]}),s.jsxs(f,{onClick:()=>{F(!0)},children:[s.jsx(R,{className:"inline"})," Add ",c," to feed"]}),U?s.jsx(u.Suspense,{fallback:null,children:s.jsx(fe,{subreddit:o,onClose:()=>{F(!1)}})}):null]})}const je=u.lazy(()=>y(()=>import("./AddToFeedDialog-DLGiRTD1.js"),__vite__mapDeps([0,1,2,3]),import.meta.url));function ge({post:e}){const t=x(),{author:n}=e,{favorites:o,blocked:c}=t,[d,a]=u.useState(!1),l=D(`/user/${n}`,o),i=`/u/${n}`;return s.jsxs("div",{children:[s.jsxs(g,{onClick:()=>{t.setVal(`/user/${n}`)},children:["Browse ",`/u/${n}`]}),l?null:s.jsxs(g,{onClick:()=>{t.addFavorite(`/user/${n}`)},children:[s.jsx(B,{className:"inline"})," ",i]}),l||c.includes(n)?null:s.jsxs(g,{onClick:()=>{t.setBlocked(n)},children:[s.jsx(J,{className:"inline"})," Block ",i]}),s.jsxs(g,{onClick:()=>{a(!0)},children:[s.jsx(R,{className:"inline"})," Add ",i," to feed"]}),d?s.jsx(u.Suspense,{fallback:null,children:s.jsx(je,{subreddit:`u_${n}`,onClose:()=>{a(!1)}})}):null]})}function we({post:e}){const{subreddit_name_prefixed:t,author:n}=e,o=`u/${n}`;return s.jsxs("div",{children:[s.jsx(ge,{post:e}),o===t?null:s.jsx(xe,{post:e})]})}function ye({post:e}){const{hideButtons:t}=x(),{author:n,subreddit_name_prefixed:o,title:c,permalink:d,url:a}=e;return s.jsxs("div",{children:[s.jsxs("h4",{className:"inline",children:[Q(c)," (",Z(new Date(e.created*1e3),{addSuffix:!0}),") [",e.score," ",s.jsx(Y,{className:"inline"}),"]"]})," ","(",s.jsx(w,{href:`https://reddit.com/u/${n}`,target:"_blank",rel:"noreferrer",children:"user"}),") (",s.jsx(w,{href:a,target:"_blank",rel:"noreferrer",children:"url"}),") (",s.jsx(w,{href:`https://reddit.com/${o}`,target:"_blank",rel:"noreferrer",children:"subreddit"}),") (",s.jsx(w,{href:`https://reddit.com${d}`,target:"_blank",rel:"noreferrer",children:"comments"}),")",t?null:s.jsx(we,{post:e})]})}function pe({title:e,url:t}){const[n,o]=u.useState(!1);return s.jsx("img",{alt:e,loading:"lazy",onClick:()=>{o(!n)},className:n?"m-auto":"w-full max-h-[80vh] object-contain",src:t})}const ve=u.lazy(()=>y(()=>import("./RedGifsCard-Cdet2OtZ.js"),__vite__mapDeps([4,1,2]),import.meta.url)),be=u.lazy(()=>y(()=>import("./GalleryCard-BlufFIE_.js"),__vite__mapDeps([5,1,2,6,3,7,8,9]),import.meta.url));function De(e){return!e.includes("redgifs")&&(e.endsWith(".jpg")||e.endsWith(".jpeg")||e.endsWith(".webp")||e.endsWith(".png")||e.endsWith(".gif")||e.endsWith(".webp"))}function Be({post:e}){const{title:t,url:n}=e;return s.jsxs("div",{children:[s.jsx(ye,{post:e}),n.startsWith("https://www.reddit.com/gallery")?s.jsx(be,{post:e}):n.includes("redgifs")?s.jsx(ve,{post:e}):De(n)?s.jsx(pe,{title:t,url:n}):s.jsxs("div",{children:["We do not know how to embed this post type yet!"," ",s.jsxs("a",{href:n,children:[n," ",t]})]})]})}function Ce(){const e=x(),{redGifsOnly:t}=e;return s.jsxs(s.Fragment,{children:[s.jsx("h1",{children:"No results on this page, check your filters in the settings or this may just have been a page of comments if you are browsing a user page"}),t?s.jsxs("div",{children:["Note: RedGifs only is on.",s.jsx(f,{onClick:()=>{e.setRedGifsOnly(!t)},children:"Turn off RedGifs only"})]}):null]})}function Se({posts:e}){const{noGifs:t,blocked:n,skipPinned:o,dedupe:c,fullscreen:d,noRedGifs:a,redGifsOnly:l}=x();let i=e.filter(r=>!("comment_type"in r)).filter(({url:r})=>r.includes("redgifs")||r.endsWith(".jpg")||r.endsWith(".webp")||r.endsWith(".jpeg")||r.endsWith(".png")||r.endsWith(".gif")||r.endsWith(".webp")||r.startsWith("https://www.reddit.com/gallery")).filter(r=>t?!r.url.endsWith(".gif"):!0).filter(r=>l?r.url.includes("redgifs"):!0).filter(r=>a?!r.url.includes("redgifs"):!0).filter(r=>o?!r.pinned:!0).filter(r=>!n.includes(r.author));return c&&(i=X(i,r=>r.url)),s.jsx("div",{className:"flex justify-center overflow-hidden",children:s.jsx("div",{className:d?"lg:w-11/12":"lg:w-1/2",children:s.jsx("div",{className:"flex flex-col space-y-20",children:i.length>0?i.map(r=>s.jsx(Be,{post:r},r.id)):s.jsx(Ce,{})})})})}function Fe(){return s.jsx("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",style:{width:100,height:100},viewBox:"0 0 24 24",children:s.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})})}export{Se as C,q as E,pe as I,Fe as L,z as d};
//# sourceMappingURL=LoadingSpinner-Baj4dE_O.js.map
