import{r as re,R as It,a as S,u as oe,b as ie,m as ae,j as J}from"./index-D3HimFrP.js";import{L as qt,E as ce,C as ue}from"./LoadingSpinner-V0amWt7j.js";import"./Link-Cznesh33.js";import"./formatDistanceToNowStrict-DGPDrA_T.js";import"./en-US-Ckk-QizZ.js";var vt={exports:{}},_t={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ut;function le(){if(Ut)return _t;Ut=1;var t=re();function e(u,E){return u===E&&(u!==0||1/u===1/E)||u!==u&&E!==E}var n=typeof Object.is=="function"?Object.is:e,a=t.useState,o=t.useEffect,s=t.useLayoutEffect,d=t.useDebugValue;function g(u,E){var r=E(),T=a({inst:{value:r,getSnapshot:E}}),h=T[0].inst,k=T[1];return s(function(){h.value=r,h.getSnapshot=E,c(h)&&k({inst:h})},[u,r,E]),o(function(){return c(h)&&k({inst:h}),u(function(){c(h)&&k({inst:h})})},[u]),d(r),r}function c(u){var E=u.getSnapshot;u=u.value;try{var r=E();return!n(u,r)}catch{return!0}}function C(u,E){return E()}var w=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?C:g;return _t.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:w,_t}var $t;function fe(){return $t||($t=1,vt.exports=le()),vt.exports}var Bt=fe();const Q=()=>{},D=Q(),wt=Object,l=t=>t===D,z=t=>typeof t=="function",Z=(t,e)=>({...t,...e}),de=t=>z(t.then),Et=new WeakMap;let Ee=0;const lt=t=>{const e=typeof t,n=t&&t.constructor,a=n==Date;let o,s;if(wt(t)===t&&!a&&n!=RegExp){if(o=Et.get(t),o)return o;if(o=++Ee+"~",Et.set(t,o),n==Array){for(o="@",s=0;s<t.length;s++)o+=lt(t[s])+",";Et.set(t,o)}if(n==wt){o="#";const d=wt.keys(t).sort();for(;!l(s=d.pop());)l(t[s])||(o+=s+":"+lt(t[s])+",");Et.set(t,o)}}else o=a?t.toJSON():e=="symbol"?t.toString():e=="string"?JSON.stringify(t):""+t;return o},K=new WeakMap,Tt={},ht={},xt="undefined",pt=typeof window!=xt,yt=typeof document!=xt,he=()=>pt&&typeof window.requestAnimationFrame!=xt,X=(t,e)=>{const n=K.get(t);return[()=>!l(e)&&t.get(e)||Tt,a=>{if(!l(e)){const o=t.get(e);e in ht||(ht[e]=o),n[5](e,Z(o,a),o||Tt)}},n[6],()=>!l(e)&&e in ht?ht[e]:!l(e)&&t.get(e)||Tt]};let Dt=!0;const Re=()=>Dt,[At,Lt]=pt&&window.addEventListener?[window.addEventListener.bind(window),window.removeEventListener.bind(window)]:[Q,Q],pe=()=>{const t=yt&&document.visibilityState;return l(t)||t!=="hidden"},Se=t=>(yt&&document.addEventListener("visibilitychange",t),At("focus",t),()=>{yt&&document.removeEventListener("visibilitychange",t),Lt("focus",t)}),ge=t=>{const e=()=>{Dt=!0,t()},n=()=>{Dt=!1};return At("online",e),At("offline",n),()=>{Lt("online",e),Lt("offline",n)}},me={isOnline:Re,isVisible:pe},ve={initFocus:Se,initReconnect:ge},zt=!It.useId,ft=!pt||"Deno"in window,_e=t=>he()?window.requestAnimationFrame(t):setTimeout(t,1),Rt=ft?S.useEffect:S.useLayoutEffect,Ct=typeof navigator<"u"&&navigator.connection,kt=!ft&&Ct&&(["slow-2g","2g"].includes(Ct.effectiveType)||Ct.saveData),ot=t=>{if(z(t))try{t=t()}catch{t=""}const e=t;return t=typeof t=="string"?t:(Array.isArray(t)?t.length:t)?lt(t):"",[t,e]};let we=0;const Vt=()=>++we,Gt=0,Jt=1,Yt=2,Te=3;var ut={__proto__:null,ERROR_REVALIDATE_EVENT:Te,FOCUS_EVENT:Gt,MUTATE_EVENT:Yt,RECONNECT_EVENT:Jt};async function Xt(...t){const[e,n,a,o]=t,s=Z({populateCache:!0,throwOnError:!0},typeof o=="boolean"?{revalidate:o}:o||{});let d=s.populateCache;const g=s.rollbackOnError;let c=s.optimisticData;const C=E=>typeof g=="function"?g(E):g!==!1,w=s.throwOnError;if(z(n)){const E=n,r=[],T=e.keys();for(const h of T)!/^\$(inf|sub)\$/.test(h)&&E(e.get(h)._k)&&r.push(h);return Promise.all(r.map(u))}return u(n);async function u(E){const[r]=ot(E);if(!r)return;const[T,h]=X(e,r),[k,i,P,U]=K.get(e),W=()=>{const V=k[r];return(z(s.revalidate)?s.revalidate(T().data,E):s.revalidate!==!1)&&(delete P[r],delete U[r],V&&V[0])?V[0](Yt).then(()=>T().data):T().data};if(t.length<3)return W();let p=a,R;const A=Vt();i[r]=[A,0];const f=!l(c),M=T(),m=M.data,L=M._c,$=l(L)?m:L;if(f&&(c=z(c)?c($,m):c,h({data:c,_c:$})),z(p))try{p=p($)}catch(V){R=V}if(p&&de(p))if(p=await p.catch(V=>{R=V}),A!==i[r][0]){if(R)throw R;return p}else R&&f&&C(R)&&(d=!0,h({data:$,_c:D}));if(d&&!R)if(z(d)){const V=d(p,$);h({data:V,error:D,_c:D})}else h({data:p,error:D,_c:D});if(i[r][1]=Vt(),Promise.resolve(W()).then(()=>{h({_c:D})}),R){if(w)throw R;return}return p}}const Ht=(t,e)=>{for(const n in t)t[n][0]&&t[n][0](e)},Ce=(t,e)=>{if(!K.has(t)){const n=Z(ve,e),a={},o=Xt.bind(D,t);let s=Q;const d={},g=(w,u)=>{const E=d[w]||[];return d[w]=E,E.push(u),()=>E.splice(E.indexOf(u),1)},c=(w,u,E)=>{t.set(w,u);const r=d[w];if(r)for(const T of r)T(u,E)},C=()=>{if(!K.has(t)&&(K.set(t,[a,{},{},{},o,c,g]),!ft)){const w=n.initFocus(setTimeout.bind(D,Ht.bind(D,a,Gt))),u=n.initReconnect(setTimeout.bind(D,Ht.bind(D,a,Jt)));s=()=>{w&&w(),u&&u(),K.delete(t)}}};return C(),[t,o,C,s]}return[t,K.get(t)[4]]},be=(t,e,n,a,o)=>{const s=n.errorRetryCount,d=o.retryCount,g=~~((Math.random()+.5)*(1<<(d<8?d:8)))*n.errorRetryInterval;!l(s)&&d>s||setTimeout(a,g,o)},Oe=(t,e)=>lt(t)==lt(e),[Nt,ye]=Ce(new Map),De=Z({onLoadingSlow:Q,onSuccess:Q,onError:Q,onErrorRetry:be,onDiscarded:Q,revalidateOnFocus:!0,revalidateOnReconnect:!0,revalidateIfStale:!0,shouldRetryOnError:!0,errorRetryInterval:kt?1e4:5e3,focusThrottleInterval:5*1e3,dedupingInterval:2*1e3,loadingTimeout:kt?5e3:3e3,compare:Oe,isPaused:()=>!1,cache:Nt,mutate:ye,fallback:{}},me),Ae=(t,e)=>{const n=Z(t,e);if(e){const{use:a,fallback:o}=t,{use:s,fallback:d}=e;a&&s&&(n.use=a.concat(s)),o&&d&&(n.fallback=Z(o,d))}return n},Le=S.createContext({}),Qt="$inf$",Zt=pt&&window.__SWR_DEVTOOLS_USE__,Ve=Zt?window.__SWR_DEVTOOLS_USE__:[],Ie=()=>{Zt&&(window.__SWR_DEVTOOLS_REACT__=It)},te=t=>z(t[1])?[t[0],t[1],t[2]||{}]:[t[0],null,(t[1]===null?t[2]:t[1])||{}],xe=()=>Z(De,S.useContext(Le)),Ne=t=>(e,n,a)=>t(e,n&&((...s)=>{const[d]=ot(e),[,,,g]=K.get(Nt);if(d.startsWith(Qt))return n(...s);const c=g[d];return l(c)?n(...s):(delete g[d],c)}),a),Fe=Ve.concat(Ne),Pe=t=>function(...n){const a=xe(),[o,s,d]=te(n),g=Ae(a,d);let c=t;const{use:C}=g,w=(C||[]).concat(Fe);for(let u=w.length;u--;)c=w[u](c);return c(o,s||g.fetcher||null,g)},Me=(t,e,n)=>{const a=e[t]||(e[t]=[]);return a.push(n),()=>{const o=a.indexOf(n);o>=0&&(a[o]=a[a.length-1],a.pop())}},We=(t,e)=>(...n)=>{const[a,o,s]=te(n),d=(s.use||[]).concat(e);return t(a,o,{...s,use:d})};Ie();const Kt=It.use||(t=>{if(t.status==="pending")throw t;if(t.status==="fulfilled")return t.value;throw t.status==="rejected"?t.reason:(t.status="pending",t.then(e=>{t.status="fulfilled",t.value=e},e=>{t.status="rejected",t.reason=e}),t)}),bt={dedupe:!0},je=(t,e,n)=>{const{cache:a,compare:o,suspense:s,fallbackData:d,revalidateOnMount:g,revalidateIfStale:c,refreshInterval:C,refreshWhenHidden:w,refreshWhenOffline:u,keepPreviousData:E}=n,[r,T,h,k]=K.get(a),[i,P]=ot(t),U=S.useRef(!1),W=S.useRef(!1),p=S.useRef(i),R=S.useRef(e),A=S.useRef(n),f=()=>A.current,M=()=>f().isVisible()&&f().isOnline(),[m,L,$,V]=X(a,i),N=S.useRef({}).current,tt=l(d)?n.fallback[i]:d,et=(v,_)=>{for(const x in N){const b=x;if(b==="data"){if(!o(v[b],_[b])&&(!l(v[b])||!o(at,_[b])))return!1}else if(_[b]!==v[b])return!1}return!0},O=S.useMemo(()=>{const v=!i||!e?!1:l(g)?f().isPaused()||s?!1:l(c)?!0:c:g,_=F=>{const B=Z(F);return delete B._k,v?{isValidating:!0,isLoading:!0,...B}:B},x=m(),b=V(),H=_(x),rt=x===b?H:_(b);let y=H;return[()=>{const F=_(m());return et(F,y)?(y.data=F.data,y.isLoading=F.isLoading,y.isValidating=F.isValidating,y.error=F.error,y):(y=F,F)},()=>rt]},[a,i]),j=Bt.useSyncExternalStore(S.useCallback(v=>$(i,(_,x)=>{et(x,_)||v()}),[a,i]),O[0],O[1]),nt=!U.current,St=r[i]&&r[i].length>0,Y=j.data,I=l(Y)?tt:Y,st=j.error,it=S.useRef(I),at=E?l(Y)?it.current:Y:I,dt=St&&!l(st)?!1:nt&&!l(g)?g:f().isPaused()?!1:s?l(I)?!1:c:l(I)||c,Ft=!!(i&&e&&nt&&dt),ee=l(j.isValidating)?Ft:j.isValidating,ne=l(j.isLoading)?Ft:j.isLoading,ct=S.useCallback(async v=>{const _=R.current;if(!i||!_||W.current||f().isPaused())return!1;let x,b,H=!0;const rt=v||{},y=!h[i]||!rt.dedupe,F=()=>zt?!W.current&&i===p.current&&U.current:i===p.current,B={isValidating:!1,isLoading:!1},Mt=()=>{L(B)},Wt=()=>{const q=h[i];q&&q[1]===b&&delete h[i]},jt={isValidating:!0};l(m().data)&&(jt.isLoading=!0);try{if(y&&(L(jt),n.loadingTimeout&&l(m().data)&&setTimeout(()=>{H&&F()&&f().onLoadingSlow(i,n)},n.loadingTimeout),h[i]=[_(P),Vt()]),[x,b]=h[i],x=await x,y&&setTimeout(Wt,n.dedupingInterval),!h[i]||h[i][1]!==b)return y&&F()&&f().onDiscarded(i),!1;B.error=D;const q=T[i];if(!l(q)&&(b<=q[0]||b<=q[1]||q[1]===0))return Mt(),y&&F()&&f().onDiscarded(i),!1;const G=m().data;B.data=o(G,x)?G:x,y&&F()&&f().onSuccess(x,i,n)}catch(q){Wt();const G=f(),{shouldRetryOnError:gt}=G;G.isPaused()||(B.error=q,y&&F()&&(G.onError(q,i,G),(gt===!0||z(gt)&&gt(q))&&(!f().revalidateOnFocus||!f().revalidateOnReconnect||M())&&G.onErrorRetry(q,i,G,se=>{const mt=r[i];mt&&mt[0]&&mt[0](ut.ERROR_REVALIDATE_EVENT,se)},{retryCount:(rt.retryCount||0)+1,dedupe:!0})))}return H=!1,Mt(),!0},[i,a]),Pt=S.useCallback((...v)=>Xt(a,p.current,...v),[]);if(Rt(()=>{R.current=e,A.current=n,l(Y)||(it.current=Y)}),Rt(()=>{if(!i)return;const v=ct.bind(D,bt);let _=0;const b=Me(i,r,(H,rt={})=>{if(H==ut.FOCUS_EVENT){const y=Date.now();f().revalidateOnFocus&&y>_&&M()&&(_=y+f().focusThrottleInterval,v())}else if(H==ut.RECONNECT_EVENT)f().revalidateOnReconnect&&M()&&v();else{if(H==ut.MUTATE_EVENT)return ct();if(H==ut.ERROR_REVALIDATE_EVENT)return ct(rt)}});return W.current=!1,p.current=i,U.current=!0,L({_k:P}),dt&&(l(I)||ft?v():_e(v)),()=>{W.current=!0,b()}},[i]),Rt(()=>{let v;function _(){const b=z(C)?C(m().data):C;b&&v!==-1&&(v=setTimeout(x,b))}function x(){!m().error&&(w||f().isVisible())&&(u||f().isOnline())?ct(bt).then(_):_()}return _(),()=>{v&&(clearTimeout(v),v=-1)}},[C,w,u,i]),S.useDebugValue(at),s&&l(I)&&i){if(!zt&&ft)throw new Error("Fallback data is required when using suspense in SSR.");R.current=e,A.current=n,W.current=!1;const v=k[i];if(!l(v)){const _=Pt(v);Kt(_)}if(l(st)){const _=ct(bt);l(at)||(_.status="fulfilled",_.value=!0),Kt(_)}else throw st}return{mutate:Pt,get data(){return N.data=!0,at},get error(){return N.error=!0,st},get isValidating(){return N.isValidating=!0,ee},get isLoading(){return N.isLoading=!0,ne}}},qe=Pe(je),Ue=t=>ot(t?t(0,null):null)[0],Ot=Promise.resolve(),$e=t=>(e,n,a)=>{const o=S.useRef(!1),{cache:s,initialSize:d=1,revalidateAll:g=!1,persistSize:c=!1,revalidateFirstPage:C=!0,revalidateOnMount:w=!1,parallel:u=!1}=a,[,,,E]=K.get(Nt);let r;try{r=Ue(e),r&&(r=Qt+r)}catch{}const[T,h,k]=X(s,r),i=S.useCallback(()=>l(T()._l)?d:T()._l,[s,r,d]);Bt.useSyncExternalStore(S.useCallback(f=>r?k(r,()=>{f()}):()=>{},[s,r]),i,i);const P=S.useCallback(()=>{const f=T()._l;return l(f)?d:f},[r,d]),U=S.useRef(P());Rt(()=>{if(!o.current){o.current=!0;return}r&&h({_l:c?U.current:P()})},[r,s]);const W=w&&!o.current,p=t(r,async f=>{const M=T()._i,m=T()._r;h({_r:D});const L=[],$=P(),[V]=X(s,f),N=V().data,tt=[];let et=null;for(let O=0;O<$;++O){const[j,nt]=ot(e(O,u?null:et));if(!j)break;const[St,Y]=X(s,j);let I=St().data;const st=g||M||l(I)||C&&!O&&!l(N)||W||N&&!l(N[O])&&!a.compare(N[O],I);if(n&&(typeof m=="function"?m(I,nt):st)){const it=async()=>{if(!(j in E))I=await n(nt);else{const dt=E[j];delete E[j],I=await dt}Y({data:I,_k:nt}),L[O]=I};u?tt.push(it):await it()}else L[O]=I;u||(et=I)}return u&&await Promise.all(tt.map(O=>O())),h({_i:D}),L},a),R=S.useCallback(function(f,M){const m=typeof M=="boolean"?{revalidate:M}:M||{},L=m.revalidate!==!1;return r?(L&&(l(f)?h({_i:!0,_r:m.revalidate}):h({_i:!1,_r:m.revalidate})),arguments.length?p.mutate(f,{...m,revalidate:L}):p.mutate()):Ot},[r,s]),A=S.useCallback(f=>{if(!r)return Ot;const[,M]=X(s,r);let m;if(z(f)?m=f(P()):typeof f=="number"&&(m=f),typeof m!="number")return Ot;M({_l:m}),U.current=m;const L=[],[$]=X(s,r);let V=null;for(let N=0;N<m;++N){const[tt]=ot(e(N,V)),[et]=X(s,tt),O=tt?et().data:D;if(l(O))return R($().data);L.push(O),V=O}return R(L)},[r,s,R,P]);return{size:P(),setSize:A,mutate:R,get data(){return p.data},get error(){return p.error},get isValidating(){return p.isValidating},get isLoading(){return p.isLoading}}},ze=We(qe,$e),ke=t=>(e,n)=>n&&!n.after?null:e===0?`${t}${t.includes("?")?"&":"?"}limit=25`:`${t}${t.includes("?")?"&":"?"}after=${n==null?void 0:n.after}&limit=25`;function Ye(){var U,W,p;const t=oe(),{mode:e,val:n}=t,{isIntersecting:a,ref:o}=ie({threshold:.9});S.useEffect(()=>{function R(A){A.state&&t.setVal(A.state.val)}return window.addEventListener("popstate",R),()=>{window.removeEventListener("popstate",R)}},[t]);const s=S.useRef(!1),d=(U=ae.get(e))==null?void 0:U.url,g=`https://www.reddit.com/${n.startsWith("/")?n.slice(1):n}${d??""}`,{data:c,size:C,setSize:w,error:u,isValidating:E,isLoading:r}=ze(ke(g),async R=>{const A=await fetch(R);if(!A.ok)throw new Error(`HTTP ${A.status} fetching ${R} ${await A.text()}`);return(await A.json()).data}),T=c==null?void 0:c.flatMap(R=>R.children).map(R=>R.data),h=r||C>0&&(c==null?void 0:c[C-1])===void 0,i=(((W=c==null?void 0:c[0])==null?void 0:W.children.length)??0)===0||(((p=c==null?void 0:c.at(-1))==null?void 0:p.children.length)??0)<25,P=E&&c&&c.length===C;return S.useEffect(()=>{a&&!s.current&&!r&&!P&&!i&&(s.current=!0,setTimeout(()=>{w(C+1).then(()=>{s.current=!1}).catch(R=>{console.error(R)})},400))},[a,w,C,i,P,r]),J.jsx("div",{children:r?J.jsx("div",{className:"flex justify-center",children:J.jsx(qt,{})}):u?J.jsx(ce,{error:u}):T?J.jsxs(J.Fragment,{children:[J.jsx(ue,{posts:T}),J.jsx("div",{ref:o,style:{height:400},className:"flex justify-center mt-10",children:h?J.jsx(qt,{}):i?"End of feed!":"Scroll all the way down to load more..."})]}):null})}export{Ye as default};
//# sourceMappingURL=RedditPostFeed-B9wLUwXY.js.map
