const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./AddToFeedDialog-uOSZ_04H.js","./index-CwIPAeqK.js","./index-4Dlsw4Xn.css","./BaseDialog-qaawN0uD.js","./RedGifsCard-C1Xmr4T-.js","./GalleryCard-BUhEHq7I.js","./Sidebar-B3NGmnY7.js","./Link-ftBKSUxN.js","./formatDistanceToNowStrict-B7etE4jS.js","./en-US-DK8Z8mF7.js"])))=>i.map(i=>d[i]);
import{G as re,j as t,u as v,o as w,r as h,p as W,L as p,q as b,s as ie,t as F,M as oe,_ as E,v as ae,B as de}from"./index-CwIPAeqK.js";import{g as z,h as G}from"./Sidebar-B3NGmnY7.js";import{d as D,a as V}from"./BaseDialog-qaawN0uD.js";import{L as g}from"./Link-ftBKSUxN.js";import{f as ce}from"./formatDistanceToNowStrict-B7etE4jS.js";function le(e){return re({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M4 14h4v7a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-7h4a1.001 1.001 0 0 0 .781-1.625l-8-10c-.381-.475-1.181-.475-1.562 0l-8 10A1.001 1.001 0 0 0 4 14z"},child:[]}]})(e)}function ue({error:e}){return t.jsxs("div",{className:"text-red-600 m-20",children:[t.jsx("div",{children:`${e}`}),t.jsxs("div",{children:[`${e}`=="TypeError: NetworkError when attempting to fetch resource."?"If you are on firefox then you can disable 'Enhanced Tracking Protection' (at your own risk) to fix this error":""," "]})]})}const C=(e,n)=>n.some(s=>e instanceof s);let $,H;function he(){return $||($=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function fe(){return H||(H=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const B=new WeakMap,I=new WeakMap,y=new WeakMap;function me(e){const n=new Promise((s,r)=>{const o=()=>{e.removeEventListener("success",a),e.removeEventListener("error",i)},a=()=>{s(x(e.result)),o()},i=()=>{r(e.error),o()};e.addEventListener("success",a),e.addEventListener("error",i)});return y.set(n,e),n}function xe(e){if(B.has(e))return;const n=new Promise((s,r)=>{const o=()=>{e.removeEventListener("complete",a),e.removeEventListener("error",i),e.removeEventListener("abort",i)},a=()=>{s(),o()},i=()=>{r(e.error||new DOMException("AbortError","AbortError")),o()};e.addEventListener("complete",a),e.addEventListener("error",i),e.addEventListener("abort",i)});B.set(e,n)}let N={get(e,n,s){if(e instanceof IDBTransaction){if(n==="done")return B.get(e);if(n==="store")return s.objectStoreNames[1]?void 0:s.objectStore(s.objectStoreNames[0])}return x(e[n])},set(e,n,s){return e[n]=s,!0},has(e,n){return e instanceof IDBTransaction&&(n==="done"||n==="store")?!0:n in e}};function Q(e){N=e(N)}function je(e){return fe().includes(e)?function(...n){return e.apply(S(this),n),x(this.request)}:function(...n){return x(e.apply(S(this),n))}}function be(e){return typeof e=="function"?je(e):(e instanceof IDBTransaction&&xe(e),C(e,he())?new Proxy(e,N):e)}function x(e){if(e instanceof IDBRequest)return me(e);if(I.has(e))return I.get(e);const n=be(e);return n!==e&&(I.set(e,n),y.set(n,e)),n}const S=e=>y.get(e);function ge(e,n,{blocked:s,upgrade:r,blocking:o,terminated:a}={}){const i=indexedDB.open(e,n),l=x(i);return r&&i.addEventListener("upgradeneeded",d=>{r(x(i.result),d.oldVersion,d.newVersion,x(i.transaction),d)}),s&&i.addEventListener("blocked",d=>s(d.oldVersion,d.newVersion,d)),l.then(d=>{a&&d.addEventListener("close",()=>a()),o&&d.addEventListener("versionchange",c=>o(c.oldVersion,c.newVersion,c))}).catch(()=>{}),l}const ve=["get","getKey","getAll","getAllKeys","count"],ye=["put","add","delete","clear"],P=new Map;function K(e,n){if(!(e instanceof IDBDatabase&&!(n in e)&&typeof n=="string"))return;if(P.get(n))return P.get(n);const s=n.replace(/FromIndex$/,""),r=n!==s,o=ye.includes(s);if(!(s in(r?IDBIndex:IDBObjectStore).prototype)||!(o||ve.includes(s)))return;const a=async function(i,...l){const d=this.transaction(i,o?"readwrite":"readonly");let c=d.store;return r&&(c=c.index(l.shift())),(await Promise.all([c[s](...l),o&&d.done]))[0]};return P.set(n,a),a}Q(e=>({...e,get:(n,s,r)=>K(n,s)||e.get(n,s,r),has:(n,s)=>!!K(n,s)||e.has(n,s)}));const we=["continue","continuePrimaryKey","advance"],U={},k=new WeakMap,X=new WeakMap,pe={get(e,n){if(!we.includes(n))return e[n];let s=U[n];return s||(s=U[n]=function(...r){k.set(this,X.get(this)[n](...r))}),s}};async function*Fe(...e){let n=this;if(n instanceof IDBCursor||(n=await n.openCursor(...e)),!n)return;n=n;const s=new Proxy(n,pe);for(X.set(s,n),y.set(s,S(n));n;)yield s,n=await(k.get(s)||n.continue()),k.delete(s)}function J(e,n){return n===Symbol.asyncIterator&&C(e,[IDBIndex,IDBObjectStore,IDBCursor])||n==="iterate"&&C(e,[IDBIndex,IDBObjectStore])}Q(e=>({...e,get(n,s,r){return J(n,s)?Fe:e.get(n,s,r)},has(n,s){return J(n,s)||e.has(n,s)}}));const Y=ge("test",2,{upgrade(e){e.createObjectStore("savedPosts")}}),De=h.lazy(()=>E(()=>import("./AddToFeedDialog-uOSZ_04H.js"),__vite__mapDeps([0,1,2,3]),import.meta.url));async function Ie(e){await(await Y).put("savedPosts",e,e.id)}async function Pe(e){await(await Y).delete("savedPosts",e.id)}function Ce({post:e}){var R;const n=v(),{author:s,subreddit:r,subreddit_name_prefixed:o,crosspost_parent_list:a}=e,{val:i,favorites:l,blocked:d}=n,c=`/u/${s}`,T=w(`/user/${s}`,l),f=((R=a==null?void 0:a[0])==null?void 0:R.subreddit_name_prefixed)??"",u=o,Z=w(f,l),q=w(u,l),[ee,M]=h.useState(!1),[_,j]=h.useState(),[ne,L]=h.useState(!1),[te,se]=h.useState(""),A=m=>{se(m),L(!0)},O=W(c)===W(o);return t.jsxs("div",{className:"inline",children:[t.jsx(p,{to:c,children:t.jsxs(b,{children:[t.jsx(D,{className:"inline"})," Browse ",c]})}),f?t.jsx(p,{to:f,children:t.jsxs(b,{children:[t.jsx(D,{className:"inline"})," Browse ",f]})}):null,O?null:t.jsx(p,{to:u,children:t.jsxs(b,{children:[t.jsx(D,{className:"inline"})," Browse ",u]})}),t.jsxs("div",{className:"dropdown",children:[_?t.jsx(ue,{error:_}):null,t.jsxs(b,{className:"inline",children:["More options ",t.jsx(ie,{})]}),t.jsxs("ul",{tabIndex:0,className:"dropdown-content menu bg-base-300 z-1 w-80 shadow-sm",children:[t.jsxs("li",{className:"menu-title",children:["User (",c,")"]}),!T&&t.jsx("li",{children:t.jsxs("button",{onClick:()=>n.addFavorite(`/user/${s}`),children:[t.jsx(F,{className:"inline"})," Favorite user"]})}),!T&&!d.includes(s)&&t.jsx("li",{children:t.jsxs("button",{onClick:()=>n.setBlocked(s),children:[t.jsx(oe,{className:"inline"})," Block user"]})}),t.jsx("li",{children:t.jsxs("button",{onClick:()=>A(`u_${s}`),children:[t.jsx(V,{className:"inline"})," Add user to feed"]})}),t.jsx("li",{children:t.jsxs("button",{onClick:()=>n.setDefaultPage(c),children:[t.jsx(z,{className:"inline"})," Set user as home"]})}),O?null:t.jsxs(t.Fragment,{children:[t.jsxs("li",{className:"menu-title",children:["Subreddit ",f]}),f&&t.jsx(t.Fragment,{children:!Z&&t.jsx("li",{children:t.jsxs("button",{onClick:()=>n.addFavorite(f),children:[t.jsx(F,{className:"inline"})," Favorite"," ",f]})})}),u!==c&&t.jsxs(t.Fragment,{children:[!q&&t.jsx("li",{children:t.jsxs("button",{onClick:()=>n.addFavorite(u),children:[t.jsx(F,{className:"inline"})," Favorite"," ",u]})}),t.jsx("li",{children:t.jsxs("button",{onClick:()=>A(r),children:[t.jsx(V,{className:"inline"})," Add ",u," to feed"]})}),t.jsx("li",{children:t.jsxs("button",{onClick:()=>n.setDefaultPage(u),children:[t.jsx(z,{className:"inline"})," Set ",u," as home"]})})]})]}),t.jsx("li",{children:i==="savedposts"?t.jsxs("button",{onClick:()=>{(async()=>{try{j(void 0),await Pe(e),n.forceRerender()}catch(m){j(m),console.error(m)}})()},children:[t.jsx(G,{className:"inline"})," Remove from saved"]}):t.jsxs("button",{onClick:()=>{(async()=>{try{j(void 0),await Ie(e)}catch(m){j(m),console.error(m)}})(),M(!0),setTimeout(()=>{M(!1)},400)},children:[t.jsx(G,{className:"inline"})," ",ee?"Saved!":"Save post"]})})]}),ne?t.jsx(h.Suspense,{fallback:null,children:t.jsx(De,{subreddit:te,onClose:()=>{L(!1)}})}):null]})]})}function Be({post:e}){return t.jsx("div",{children:t.jsx(Ce,{post:e})})}function Ne({post:e}){const{hideButtons:n}=v(),{author:s,subreddit_name_prefixed:r,title:o,permalink:a,url:i}=e;return t.jsxs("div",{children:[t.jsxs("h4",{className:"inline",children:[ae(o)," (",ce(new Date(e.created*1e3),{addSuffix:!0}),") [",e.score," ",t.jsx(le,{className:"inline"}),"]"]})," ","(",t.jsx(g,{href:`https://reddit.com/u/${s}`,target:"_blank",rel:"noreferrer",children:"user"}),") (",t.jsx(g,{href:i,target:"_blank",rel:"noreferrer",children:"url"}),") (",t.jsx(g,{href:`https://reddit.com/${r}`,target:"_blank",rel:"noreferrer",children:"subreddit"}),") (",t.jsx(g,{href:`https://reddit.com${a}`,target:"_blank",rel:"noreferrer",children:"comments"}),")",n?null:t.jsx(Be,{post:e})]})}function Se({title:e,url:n}){const[s,r]=h.useState(!1);return t.jsx("img",{alt:e,loading:"lazy",onClick:()=>{r(!s)},className:s?"m-auto":"w-full max-h-[80vh] object-contain",src:n})}const ke=h.lazy(()=>E(()=>import("./RedGifsCard-C1Xmr4T-.js"),__vite__mapDeps([4,1,2]),import.meta.url)),Ee=h.lazy(()=>E(()=>import("./GalleryCard-BUhEHq7I.js"),__vite__mapDeps([5,1,2,6,3,7,8,9]),import.meta.url));function Te(e){return!e.includes("redgifs")&&(e.endsWith(".jpg")||e.endsWith(".jpeg")||e.endsWith(".webp")||e.endsWith(".png")||e.endsWith(".gif")||e.endsWith(".webp"))}function Me({post:e}){const{title:n,url:s}=e;return t.jsxs("div",{children:[t.jsx(Ne,{post:e}),s.startsWith("https://www.reddit.com/gallery")?t.jsx(Ee,{post:e}):s.includes("redgifs")?t.jsx(ke,{post:e}):Te(s)?t.jsx(Se,{title:n,url:s}):t.jsxs("div",{children:["We do not know how to embed this post type yet!"," ",t.jsxs("a",{href:s,children:[s," ",n]})]})]})}function _e({totalFiltered:e}){const n=v(),{redGifsOnly:s}=n;return t.jsxs(t.Fragment,{children:[t.jsx("h1",{children:"Check your filters in the settings or this may just have been a page of comments if you are browsing a user page"}),s?t.jsxs("div",{children:["Note: RedGifs only is on.",t.jsx(de,{onClick:()=>{n.setRedGifsOnly(!s)},children:"Turn off RedGifs only"})]}):null,t.jsx("div",{children:e?t.jsxs("div",{children:["Total posts filtered out (non-image posts, not matching filters, etc): ",e]}):null}),t.jsx("div",{children:"Note that we are not able to embed v.redd.it videos from e.g. popular SFW reddits"})]})}function ze({posts:e,stats:n}){const{fullscreen:s}=v();return t.jsx("div",{className:"flex justify-center overflow-hidden",children:t.jsx("div",{className:s?"lg:w-11/12":"lg:w-1/2",children:t.jsx("div",{className:"flex flex-col space-y-20",children:e.length>0?e.map(r=>t.jsx(Me,{post:r},r.id)):n?t.jsx(_e,{totalPosts:n.totalPosts,commentTypeFiltered:n.commentTypeFiltered,urlTypeFiltered:n.urlTypeFiltered,gifFiltered:n.gifFiltered,redGifsOnlyFiltered:n.redGifsOnlyFiltered,noRedGifsFiltered:n.noRedGifsFiltered,pinnedFiltered:n.pinnedFiltered,blockedFiltered:n.blockedFiltered,remainingPosts:n.remainingPosts,totalFiltered:n.totalPosts-n.remainingPosts}):null})})})}function Ge(){return t.jsx("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",style:{width:100,height:100},viewBox:"0 0 24 24",children:t.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})})}export{ze as C,ue as E,Se as I,Ge as L,Y as d};
//# sourceMappingURL=LoadingSpinner-D21VyinD.js.map
